{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "qr_code_scanner",
    "name" : "QR code scanner",
    "deprecated" : false,
    "image" : "tb-image;/api/images/tenant/qr_code_scanner_widget_image.gif",
    "description" : "Use web or phone camera to scan QR code",
    "descriptor" : {
      "type" : "static",
      "sizeX" : 5,
      "sizeY" : 5,
      "resources" : [ ],
      "templateHtml" : "<div id=\"qr-container\">\r\n    <video id=\"qr-video\"></video>\r\n</div>",
      "templateCss" : "",
      "controllerScript" : "const SCRIPT_URL = 'https://cdn.jsdelivr.net/gh/nimiq/qr-scanner/qr-scanner.min.js';\n\nself.onInit = function() {\n    let $injector = self.ctx.$scope.$injector;\n    let utils = $injector.get(self.ctx.servicesMap.get('utils'));\n    \n    self.ctx.video = $('#qr-video', self.ctx.$container);\n    \n    let styleClass = '';\n    let styles = '';\n    \n    switch (self.ctx.settings.style) {\n        case 'shadow':\n            styleClass = 'qr-shadow-style';\n            styles = self.ctx.settings.shadowStyle;\n            break;\n        case 'stroke':\n            styleClass = 'qr-stroke-style';\n            styles = self.ctx.settings.strokeStyle;\n            break;\n        case 'custom':\n            styles = self.ctx.settings.customStyle;\n            break;\n        default:\n           styleClass = 'qr-shadow-style';\n           break;\n    }\n    \n    if (styleClass !== '') {\n        $('#qr-container', self.ctx.$container).addClass(styleClass);\n    }\n    \n    var cssParser = new cssjs();\n    cssParser.testMode = false;\n    var namespace = 'qr-code-scanner-' + hashCode(styles);\n    cssParser.cssPreviewNamespace = namespace;\n    cssParser.createStyleElement(namespace, styles);\n    self.ctx.$container.addClass(namespace);\n    \n    let onScanSuccess = onScanSuccessDefault;\n    if (typeof self.ctx.settings.onScanSuccess !== 'undefined' && \n                         self.ctx.settings.onScanSuccess.length > 0) {\n        let customCallback = new Function('qrCode', 'ctx', self.ctx.settings.onScanSuccess);\n        onScanSuccess = function(result) {\n            customCallback(result.data, self.ctx);\n        }\n    }\n    \n    \n    import(SCRIPT_URL)\n        .then((module) => {\n            console.debug('[QR scanner] Script imported from ', SCRIPT_URL);\n\n            const QrScanner = module.default;\n            \n            let options = {\n                onDecodeError: onScanFailureDefault,\n                highlightScanRegion: true,\n                highlightCodeOutline: true\n            };\n            \n            self.ctx.qrScanner = new QrScanner(self.ctx.video[0], onScanSuccess, options);\n            self.ctx.qrScanner.start()\n            .then(() => {\n                console.debug('[QR scanner] Initialized');\n            })\n            .catch(error => {\n                console.debug('[QR scanner] Initialization error: ', error);\n                \n                self.ctx.$container.html('<div style=\"margin: 0;position: absolute;top: 50%;left: 50%;-ms-transform: translate(-50%, -50%);transform: translate(-50%, -50%);text-align: justify;text-align-last: center;\"><p style=\"font-size: 1em;font-weight: bold;color: #DC143C;\">No camera on device or no access to camera has been granted!</p></div>');\n                self.ctx.$container.css(\"border\", \"3px solid #DC143C\");\n            });\n            \n            self.ctx.overlayContainer = $(self.ctx.qrScanner.$overlay);\n            \n            self.onResize();\n        })\n        .catch(err => {\n            console.error('[QR scanner] failed to import script: ', err.message);\n        });\n}\n\nfunction onScanSuccessDefault(result) {\n    alert('Default callback: scan result is ' + result.data);\n}\n\nfunction onScanFailureDefault(error) {\n    // NOTE: This function is being called very often\n    // console.error('[QR scanner] scan error: ', error);\n}\n\n\nself.onResize = function() {\n    self.ctx.video.width(self.ctx.width).height(self.ctx.height);\n\n    if (self.ctx.qrScanner) {\n        self.ctx.qrScanner._updateOverlay();\n    }\n}\n\nself.onDestroy = function() {\n    if (self.ctx.qrScanner) {\n        self.ctx.qrScanner.stop();\n        self.ctx.qrScanner.destroy();\n        self.ctx.qrScanner = null;\n    }\n}\n\nfunction hashCode(str) {\n    var hash = 0;\n    var i, char;\n    if (str.length === 0) return hash;\n    for (i = 0; i < str.length; i++) {\n        char = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + char;\n        hash = hash & hash;\n    }\n    return hash;\n}",
      "settingsSchema" : "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"QR code scanner settings\",\n        \"properties\": {\n            \"style\": {\n                \"title\": \"Style of scanning region\",\n                \"type\": \"string\",\n                \"default\": \"stroke\"\n            },\n            \"strokeStyle\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \"#qr-container.qr-stroke-style .scan-region-highlight-svg,\\n#qr-container.qr-stroke-style .code-outline-highlight {\\n    stroke: #FFFFFF !important;\\n}\\n#qr-video{\\n    object-fit: cover;\\n}\\n\"\n            },\n            \"shadowStyle\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \"#qr-video{\\n    object-fit: cover;\\n}\\n#qr-container.qr-shadow-style {\\n    position: relative;\\n    width: max-content;\\n    height: max-content;\\n    overflow: hidden;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight {\\n    border-radius: 30px;\\n    outline: rgba(0, 0, 0, .25) solid 50vmax;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight-svg {\\n    display: none;\\n}\\n#qr-container.qr-shadow-style .code-outline-highlight {\\n    stroke: rgba(255, 255, 255, .5) !important;\\n    stroke-width: 15 !important;\\n    stroke-dasharray: none !important;\\n}\\n\"\n            },\n            \"customStyle\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \"#qr-container {\\n\\n}\\n#qr-video{\\n    object-fit: cover;\\n}\\n#qr-container.scan-region-highlight-svg {\\n\\n}\\n#qr-container.code-outline-highlight{\\n\\n}\"\n            },\n            \"onScanSuccess\": {\n                \"title\": \"function (qrCode, ctx)\",\n                \"type\": \"string\",\n                \"default\": \"console.log('QR code: ', qrCode);\\nalert('QR code: ' + qrCode)\"\n            }\n        },\n        \"required\": [\n            \"style\",\n            \"onScanSuccess\"\n        ]\n    },\n    \"form\": [\n        {\n            \"key\": \"style\",\n            \"type\": \"rc-select\",\n            \"multiple\": false,\n            \"items\": [\n                {\n                    \"value\": \"stroke\",\n                    \"label\": \"Stroke\"\n                },\n                {\n                    \"value\": \"shadow\",\n                    \"label\": \"Shadow\"\n                },\n                {\n                    \"value\": \"custom\",\n                    \"label\": \"Custom\"\n                }\n            ]\n        },\n        {\n            \"key\": \"strokeStyle\",\n            \"type\": \"css\",\n            \"condition\": \"model.style === 'stroke'\"\n        },\n        {\n            \"key\": \"shadowStyle\",\n            \"type\": \"css\",\n            \"condition\": \"model.style === 'shadow'\"\n        },\n        {\n            \"key\": \"customStyle\",\n            \"type\": \"css\",\n            \"condition\": \"model.style === 'custom'\"\n        },\n        {\n            \"key\": \"onScanSuccess\",\n            \"type\": \"javascript\"\n        }\n    ]\n}",
      "dataKeySettingsSchema" : "{}\n",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"static\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"style\":\"stroke\",\"onScanSuccess\":\"console.log('QR code: ', qrCode);\\nalert('QR code: ' + qrCode)\",\"strokeStyle\":\"#qr-video {\\n    object-fit: cover;\\n}\\n#qr-container.qr-stroke-style .scan-region-highlight-svg,\\n#qr-container.qr-stroke-style .code-outline-highlight {\\n    stroke: #FFFFFF !important;\\n}\",\"shadowStyle\":\"#qr-video {\\n    object-fit: cover;\\n}\\n#qr-container.qr-shadow-style {\\n    position: relative;\\n    width: max-content;\\n    height: max-content;\\n    overflow: hidden;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight {\\n    border-radius: 30px;\\n    outline: rgba(0, 0, 0, .25) solid 50vmax;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight-svg {\\n    display: none;\\n}\\n#qr-container.qr-shadow-style .code-outline-highlight {\\n    stroke: rgba(255, 255, 255, .5) !important;\\n    stroke-width: 15 !important;\\n    stroke-dasharray: none !important;\\n}\\n\",\"customStyle\":\"#qr-container {\\n\\n}\\n#qr-video{\\n    object-fit: cover;\\n}\\n#qr-container.scan-region-highlight-svg {\\n\\n}\\n#qr-container.code-outline-highlight{\\n\\n}\"},\"title\":\"QR code scanner\",\"dropShadow\":true}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "4b14ee20-b9fe-11f0-b045-c1dbc0c3e378"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}