{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "eran.image_map",
    "name" : "TimeseriesPolygonImageMap",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 9,
      "sizeY" : 9,
      "resources" : [ {
        "url" : ""
      } ],
      "templateHtml" : "<div flex layout=\"column\" style=\"height: 500px;\">\n    <!--<div>Timeseries Polygon Map</div>-->\n    <table style=\"width: 100%;\">\n        <tbody>\n            <tr>\n                <td style=\"width: 60%\">\n                    <input type=\"range\" name=\"TimeFrame\" id=\"TimeFrame\"\n                        style=\"width: 100%\" value=\"0\"\n                        onchange=\"TimeseriesPolygonImageMapSelf.onDataUpdated()\" />\n                </td>\n                <td style=\"width: 20%\">\n                    <input type=\"text\" name=\"TimeFrameLabel\"\n                        style=\"width: 100%\" id=\"TimeFrameLabel\"\n                        value=\"0\" />\n                </td>\n                <td style=\"width: 10%\">\n                    <button type=\"button\" style=\"float: right\"\n                        onClick=\"TimeseriesPolygonImageMapSelf.setNext()\">Next</button>\n                </td>\n                <td style=\"width: 10%\">\n                    <button type=\"button\" style=\"float: right\"\n                        id=\"PlayButton\" onclick=\"TimeseriesPolygonImageMapSelf.Play()\">Play</button>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <table style=\"width: 100%;\">\n        <tbody>\n            <tr>\n                <td id=\"TimeseriesPolygonImageMap\" style=\"height: 150px\"></td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n",
      "templateCss" : ".leaflet-zoom-box {\n\tz-index: 9;\n}\n\n.leaflet-pane         { z-index: 4; }\n\n.leaflet-tile-pane    { z-index: 2; }\n.leaflet-overlay-pane { z-index: 4; }\n.leaflet-shadow-pane  { z-index: 5; }\n.leaflet-marker-pane  { z-index: 6; }\n.leaflet-tooltip-pane   { z-index: 7; }\n.leaflet-popup-pane   { z-index: 8; }\n\n.leaflet-map-pane canvas { z-index: 1; }\n.leaflet-map-pane svg    { z-index: 2; }\n\n.leaflet-control {\n\tz-index: 9;\n}\n.leaflet-top,\n.leaflet-bottom {\n\tz-index: 11;\n}\n\n.tb-marker-label {\n    border: none;\n    background: none;\n    box-shadow: none;\n}\n\n.tb-marker-label:before {\n    border: none;\n    background: none;\n}\n",
      "controllerScript" : "self.onInit = function () {\n    var elemap = $('#TimeseriesPolygonImageMap');\n    self.ctx.map = new TbMapWidgetV2('image-map', false, self.ctx, undefined, elemap);\n    self.posFunc = self.ctx.map.map.posFunction;\n    setTimeout(() => {\n        self.mapleaflet = self.ctx.map.map.map;\n        window.TimeseriesPolygonImageMapSelf = self;\n        self.onResize();\n        self.onDataUpdated();\n\n        console.log(self);\n    }, 10);\n};\n\nself.resizeMap = function () {\n    if (!self.mapleaflet || !self.mapleaflet._container) {\n        return;\n    }\n    self.mapleaflet._container.style.height = (self.ctx.height - 30) + \"px\";\n    self.mapleaflet.invalidateSize();\n};\n\nself.clearPolygons = function () {\n    if (!self.mapleaflet || !self.mapleaflet._layers) {\n        return;\n    }\n    for (var i in self.mapleaflet._layers) {\n        if (self.mapleaflet._layers[i]._path !== undefined) {\n            try {\n                self.mapleaflet.removeLayer(self.mapleaflet._layers[i]);\n            } catch (e) {\n                console.log(\"problem with \" + e + self.mapleaflet._layers[i]);\n            }\n        }\n    }\n};\n\nfunction parseJson(json) {\n    var value = String(json).replace(/'/g, '\\\"');\n    return JSON.parse(value);\n}\n\nfunction lerp(a, b, f) {\n    return a + f * (b - a);\n}\n\nself.posOnMap = function (v) {\n    const bounds = self.ctx.map.map.imageOverlay._bounds;\n    var ne = bounds._northEast,\n        sw = bounds._southWest;\n    var pos = self.posFunc(v[0], v[1]);\n    pos.y = lerp(ne.lat, sw.lat, pos.y);\n    pos.x = lerp(sw.lng, ne.lng, pos.x);\n    return [pos.x, pos.y];\n};\n\nself.posFuncGeoJson = function (geojson) {\n    geojson.forEach((g) => {\n        g.geometry.coordinates = g.geometry.coordinates.map(shape => shape.map(self.posOnMap));\n    });\n    return geojson;\n};\n\nself.showPolygons = function (parsed, color) {\n    try {\n        var geojsonFeature = self.posFuncGeoJson(parsed.features);\n        L.geoJSON(geojsonFeature, {\n            style: { \"color\": color, \"opacity\": 0.8 }\n        }).addTo(self.mapleaflet);\n    } catch (e) {\n        console.log(e);\n    }\n};\n\nself.getCurrIndex = function () {\n    return parseInt($('#TimeFrame')[0].value);\n};\n\nself.setCurrIndex = function (val) {\n    $('#TimeFrame')[0].value = val;\n    self.onDataUpdated();\n};\n\nself.getPolygonFrames = function () {\n    const jsons = self.ctx.data.filter(prop => prop.data.length > 0 && typeof prop.data[0][1] === \"string\");\n    var maxRange = 0;\n    const polygonFrames = jsons.map(prop => {\n        const frames = parseJson(prop.data[0][1]);\n        maxRange = Math.max(Math.max.apply(this, frames.map(b => b.index)));\n        return { frames: frames, color: prop.dataKey.color };\n    });\n    return [polygonFrames, maxRange];\n};\n\nself.showPolygonFrame = function (polygonFrames, index) {\n    let valueName = '';\n    self.clearPolygons();\n    polygonFrames.forEach(polys => {\n        const poly = polys.frames.find(frame => parseInt(frame.index) === index);\n        if (poly) {\n            valueName = poly.name;\n            self.showPolygons(poly.value, polys.color);\n        }\n    });\n    self.ctx.map.update();\n    return valueName ? valueName : '';\n};\n\nself.getDirectionTelemetry = function () {\n    // console.log(self.ctx.data);\n    const nonJsons = self.ctx.data.filter(prop => prop.data.length > 0 && typeof prop.data[0][1] !== \"string\");\n    let ret = {};\n    nonJsons.forEach(prop => {\n        const t = prop.datasource.name;\n        ret[t] = ret[t] || {};\n        const kind = prop.dataKey.name;\n        ret[t][kind] = prop.data[0][1];\n    });\n    return Object.values(ret);\n};\n\nself.showDirectionMarker = function (s) {\n    if (s.latitude === undefined || s.longitude === undefined) return undefined;\n    let dir = s[self.ctx.settings.keyNameDir];\n    if (dir === undefined) return undefined;\n    let power = s[self.ctx.settings.keyNamePower];\n    if (power === undefined) power = 4;\n    const powerSize = parseFloat(power) * self.ctx.settings.ArrowLenAt4 / 4;\n    if (/(Win32|Win64)/i.test(navigator.platform)) dir = (dir + 180) % 360;\n\n    const pos = self.posOnMap([s.latitude, s.longitude]);\n    var marker = L.marker([pos[1], pos[0]], {\n        icon: L.icon({\n            iconUrl: self.ctx.settings.arrowImageUrl,\n            iconSize: [powerSize, parseFloat(self.ctx.settings.ArrowWidth)]\n        }),\n        rotationAngle: 360 - dir % 360, // counter clockwise\n        rotationOrigin: 'center'\n    }).addTo(self.mapleaflet);\n\n    return marker;\n};\n\nself.onDataUpdated = function () {\n    try {\n        const index = self.getCurrIndex();\n        [polygonFrames, maxRange] = self.getPolygonFrames();\n        $('#TimeFrame')[0].max = maxRange;\n        $('#TimeFrameLabel')[0].value = self.showPolygonFrame(polygonFrames, index);\n    } catch (err) {\n        // console.log(\"JSON error:\", self.ctx.data, err);\n        // return;\n    }\n\n    (self.windMarkers || []).forEach(m => m.removeFrom(self.mapleaflet));\n    const dirs = self.getDirectionTelemetry();\n    self.windMarkers = dirs.map(self.showDirectionMarker);\n    self.windMarkers = self.windMarkers.filter(a => a);\n};\n\nself.setNext = function () {\n    var maxRange = parseInt($('#TimeFrame')[0].max);\n    if (maxRange >= 1) {\n        self.setCurrIndex((self.getCurrIndex() + 1) % (maxRange + 1));\n    } else {\n        self.setCurrIndex(0);\n    }\n};\n\nself.Play = function () {\n    self.playing = !self.playing;\n    $('#PlayButton').text(self.playing ? 'Stop' : 'Play');\n    if (self.playing) {\n        var cont = () => {\n            self.setNext();\n            if (self.playing) {\n                setTimeout(cont, self.ctx.settings.playDelay);\n            }\n        };\n        cont();\n    }\n};\n\nself.onResize = function () {\n    self.ctx.map.resize();\n    self.resizeMap();\n};\n\nself.getSettingsSchema = function () {\n    var tbScheme = JSON.parse(JSON.stringify(TbMapWidgetV2.settingsSchema('image-map')));\n    // console.log(tbScheme);\n    tbScheme.form.unshift(\n        \"playDelay\",\n        \"keyNameDir\",\n        \"keyNamePower\",\n        \"ArrowLenAt4\",\n        \"ArrowWidth\",\n        {\n            \"key\": \"arrowImageUrl\",\n            \"type\": \"image\"\n        }\n    );\n    Object.assign(tbScheme.schema.properties,\n        {\n            \"playDelay\": {\n                \"title\": \"Play delay\",\n                \"type\": \"number\",\n                \"default\": 500\n            },\n            \"keyNameDir\": {\n                \"title\": \"Direction key name\",\n                \"type\": \"string\",\n                \"default\": \"wind_dir\"\n            },\n            \"keyNamePower\": {\n                \"title\": \"Power key name\",\n                \"type\": \"string\",\n                \"default\": \"wind_speed\"\n            },\n            \"ArrowLenAt4\": {\n                \"title\": \"Arrow length in pixels when power/speed is 4\",\n                \"type\": \"number\",\n                \"default\": 40\n            },\n            \"ArrowWidth\": {\n                \"title\": \"Arrow width in pixels\",\n                \"type\": \"number\",\n                \"default\": 40\n            },\n            \"arrowImageUrl\": {\n                \"title\": \"Arrow image\",\n                \"type\": \"string\",\n                \"default\": \"data:image/png;base64,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\"\n            }\n        });\n    return tbScheme;\n};\nself.getDataKeySettingsSchema = function () {\n    return TbMapWidgetV2.dataKeySettingsSchema('image-map');\n};\n\nself.actionSources = function () {\n    return TbMapWidgetV2.actionSources();\n};\n\nself.onDestroy = function () { };\n\n(function () {\n    // save these original methods before they are overwritten\n    var proto_initIcon = L.Marker.prototype._initIcon;\n    var proto_setPos = L.Marker.prototype._setPos;\n\n    var oldIE = (L.DomUtil.TRANSFORM === 'msTransform');\n\n    L.Marker.addInitHook(function () {\n        var iconOptions = this.options.icon && this.options.icon.options;\n        var iconAnchor = iconOptions && this.options.icon.options.iconAnchor;\n        if (iconAnchor) {\n            iconAnchor = (iconAnchor[0] + 'px ' + iconAnchor[1] + 'px');\n        }\n        this.options.rotationOrigin = this.options.rotationOrigin || iconAnchor || 'center bottom';\n        this.options.rotationAngle = this.options.rotationAngle || 0;\n\n        // Ensure marker keeps rotated during dragging\n        this.on('drag', function (e) { e.target._applyRotation(); });\n    });\n\n    L.Marker.include({\n        _initIcon: function () {\n            proto_initIcon.call(this);\n        },\n\n        _setPos: function (pos) {\n            proto_setPos.call(this, pos);\n            this._applyRotation();\n        },\n\n        _applyRotation: function () {\n            if (this.options.rotationAngle) {\n                this._icon.style[L.DomUtil.TRANSFORM + 'Origin'] = this.options.rotationOrigin;\n\n                // console.log(this.options.rotationAngle);\n                // if(oldIE) {\n                //     // for IE 9, use the 2D rotation\n                // this._icon.style[L.DomUtil.TRANSFORM] = 'rotate(' + this.options.rotationAngle + 'deg)';\n                // } else {\n                //     // for modern browsers, prefer the 3D accelerated version\n                this._icon.style[L.DomUtil.TRANSFORM] =\n                    this._icon.style[L.DomUtil.TRANSFORM].replace(/ rotateZ\\(\\d+deg\\)/g, '')\n                    + ' rotateZ(' + this.options.rotationAngle + 'deg)';\n                // }\n            }\n        },\n\n        setRotationAngle: function (angle) {\n            this.options.rotationAngle = angle;\n            this.update();\n            return this;\n        },\n\n        setRotationOrigin: function (origin) {\n            this.options.rotationOrigin = origin;\n            this.update();\n            return this;\n        }\n    });\n})();\n",
      "settingsSchema" : "{}",
      "dataKeySettingsSchema" : "{}\n",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"First point\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"xPos\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.05427416942713381,\"funcBody\":\"var value = prevValue || 0.2;\\nif (time % 5000 < 500) {\\n    value += Math.random() * 0.05 - 0.025;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"yPos\",\"color\":\"#4caf50\",\"settings\":{},\"_hash\":0.680594833308841,\"funcBody\":\"var value = prevValue || 0.3;\\nif (time % 5000 < 500) {\\n    value += Math.random() * 0.05 - 0.025;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"temperature\",\"color\":\"#9c27b0\",\"settings\":{},\"_hash\":0.9430343126300238,\"funcBody\":\"var value = prevValue + Math.random() * 40 - 20;\\nif (value < -60) {\\n\\tvalue = -60;\\n} else if (value > 60) {\\n\\tvalue = 60;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"type\",\"color\":\"#8bc34a\",\"settings\":{},\"_hash\":0.1784452363910778,\"funcBody\":\"return \\\"colorpin\\\";\"}]},{\"type\":\"function\",\"name\":\"Second point\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"xPos\",\"color\":\"#f44336\",\"settings\":{},\"_hash\":0.05012157428742059,\"funcBody\":\"var value = prevValue || 0.6;\\nif (time % 4000 < 500) {\\n    value += Math.random() * 0.05 - 0.025;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"yPos\",\"color\":\"#ffc107\",\"settings\":{},\"_hash\":0.6742359401617628,\"funcBody\":\"var value = prevValue || 0.7;\\nif (time % 4000 < 500) {\\n    value += Math.random() * 0.05 - 0.025;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"temperature\",\"color\":\"#8bc34a\",\"settings\":{},\"_hash\":0.773875863339494,\"funcBody\":\"var value = prevValue + Math.random() * 40 - 20;\\nif (value < -60) {\\n\\tvalue = -60;\\n} else if (value > 60) {\\n\\tvalue = 60;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"type\",\"color\":\"#3f51b5\",\"settings\":{},\"_hash\":0.405822538899673,\"funcBody\":\"return \\\"thermomether\\\";\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"showLabel\":true,\"label\":\"${entityName}\",\"tooltipPattern\":\"<b>${entityName}</b><br/><br/><b>X Pos:</b> ${xPos:2}<br/><b>Y Pos:</b> ${yPos:2}<br/><b>Temperature:</b> ${temperature} °C<br/><small>See advanced settings for details</small>\",\"markerImageSize\":34,\"useColorFunction\":true,\"markerImages\":[\"tb-image;/api/images/system/map_marker_image_0.png\",\"tb-image;/api/images/system/map_marker_image_1.png\",\"tb-image;/api/images/system/map_marker_image_2.png\",\"tb-image;/api/images/system/map_marker_image_3.png\"],\"useMarkerImageFunction\":true,\"colorFunction\":\"var type = dsData[dsIndex]['type'];\\nif (type == 'colorpin') {\\n\\tvar temperature = dsData[dsIndex]['temperature'];\\n\\tif (typeof temperature !== undefined) {\\n\\t    var percent = (temperature + 60)/120 * 100;\\n\\t    return tinycolor.mix('blue', 'red', amount = percent).toHexString();\\n\\t}\\n\\treturn 'blue';\\n}\\n\",\"markerImageFunction\":\"var type = dsData[dsIndex]['type'];\\nif (type == 'thermomether') {\\n\\tvar res = {\\n\\t    url: images[0],\\n\\t    size: 40\\n\\t}\\n\\tvar temperature = dsData[dsIndex]['temperature'];\\n\\tif (typeof temperature !== undefined) {\\n\\t    var percent = (temperature + 60)/120;\\n\\t    var index = Math.min(3, Math.floor(4 * percent));\\n\\t    res.url = images[index];\\n\\t}\\n\\treturn res;\\n}\",\"color\":\"#fe7569\",\"mapImageUrl\":\"tb-image;/api/images/tenant/timeseriespolygonimagemap_widget_map_image.svg\",\"xPosKeyName\":\"xPos\",\"yPosKeyName\":\"yPos\",\"posFunction\":\"return {x: origXPos, y: origYPos};\",\"markerOffsetX\":0.5,\"markerOffsetY\":1,\"showTooltip\":true,\"autocloseTooltip\":true,\"labelFunction\":\"var deviceType = dsData[dsIndex]['deviceType'];\\r\\nif (typeof deviceType !== undefined) {\\r\\n    if (deviceType == \\\"energy meter\\\") {\\r\\n        return '<span style=\\\"color:orange;\\\">${entityName}, ${energy:2} kWt</span>';\\r\\n    } else if (deviceType == \\\"thermometer\\\") {\\r\\n        return '<span style=\\\"color:blue;\\\">${entityName}, ${temperature:2} °C</span>';\\r\\n    }\\r\\n}\",\"tooltipFunction\":\"var deviceType = dsData[dsIndex]['deviceType'];\\r\\nif (typeof deviceType !== undefined) {\\r\\n    if (deviceType == \\\"energy meter\\\") {\\r\\n        return '<b>${entityName}</b><br/><b>Energy:</b> ${energy:2} kWt<br/>';\\r\\n    } else if (deviceType == \\\"thermometer\\\") {\\r\\n        return '<b>${entityName}</b><br/><b>Temperature:</b> ${temperature:2} °C<br/>';\\r\\n    }\\r\\n}\",\"playDelay\":500,\"keyNameDir\":\"wind_dir\",\"keyNamePower\":\"wind_speed\",\"arrowImageUrl\":\"data:image/png;base64,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\",\"ArrowLenAt4\":40,\"ArrowWidth\":40},\"title\":\"TimeseriesPolygonImageMap\",\"dropShadow\":true,\"enableFullscreen\":true,\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"useDashboardTimewindow\":true,\"showLegend\":false,\"widgetStyle\":{},\"actions\":{},\"legendConfig\":{\"position\":\"bottom\",\"showMin\":false,\"showMax\":false,\"showAvg\":true,\"showTotal\":false}}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "a08e2c70-8c5b-11f0-8d0c-9de3d92fa448"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}