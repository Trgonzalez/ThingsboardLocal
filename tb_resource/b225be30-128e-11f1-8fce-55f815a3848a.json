{
  "entityType" : "TB_RESOURCE",
  "entity" : {
    "data" : "ZXhwb3J0IGZ1bmN0aW9uIGFkZE1hY2hpbmVUb01pbmVTaXRlKCRldmVudCwgd2lkZ2V0Q29udGV4dCwgYWRkaXRpb25hbFBhcmFtcykgewogICAgbGV0ICRpbmplY3RvciA9IHdpZGdldENvbnRleHQuJHNjb3BlLiRpbmplY3RvcjsKICAgIGxldCBjdXN0b21EaWFsb2cgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdjdXN0b21EaWFsb2cnKSk7CiAgICBsZXQgZGV2aWNlU2VydmljZSA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2RldmljZVNlcnZpY2UnKSk7CiAgICBsZXQgZW50aXR5R3JvdXBTZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZW50aXR5R3JvdXBTZXJ2aWNlJykpOwogICAgbGV0IGF0dHJpYnV0ZVNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdhdHRyaWJ1dGVTZXJ2aWNlJykpOwogICAgbGV0IGVudGl0eVJlbGF0aW9uU2VydmljZSA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2VudGl0eVJlbGF0aW9uU2VydmljZScpKTsKCiAgICBvcGVuQWRkTWFjaGluZURpYWxvZygpOwoKICAgIGZ1bmN0aW9uIG9wZW5BZGRNYWNoaW5lRGlhbG9nKCkgewoKICAgICAgICBjb25zdCBhZGRNYWNoaW5lSHRtbFRlbXBsYXRlID0gJzxmb3JtICNhZGRFbnRpdHlGb3JtPSJuZ0Zvcm0iIFtmb3JtR3JvdXBdPSJhZGRNYWNoaW5lRm9ybUdyb3VwIlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAobmdTdWJtaXQpPSJzYXZlKCkiIGNsYXNzPSJhZGQtZW50aXR5LWZvcm0iIHN0eWxlPSJ3aWR0aDogNjAwcHgiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxtYXQtdG9vbGJhciBjbGFzcz0iZmxleCBmbGV4LXJvdyIgY29sb3I9InByaW1hcnkiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPGgyPkFkZCBuZXcgbWFjaGluZTwvaDI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8c3BhbiBjbGFzcz0iZmxleC0xIj48L3NwYW4+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1pY29uLWJ1dHRvbiAoY2xpY2spPSJjYW5jZWwoKSIgdHlwZT0iYnV0dG9uIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPG1hdC1pY29uIGNsYXNzPSJtYXRlcmlhbC1pY29ucyI+Y2xvc2U8L21hdC1pY29uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPC9idXR0b24+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9tYXQtdG9vbGJhcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8bWF0LXByb2dyZXNzLWJhciBjb2xvcj0id2FybiIgbW9kZT0iaW5kZXRlcm1pbmF0ZSIgKm5nSWY9ImlzTG9hZGluZyQgfCBhc3luYyI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9tYXQtcHJvZ3Jlc3MtYmFyPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgc3R5bGU9ImhlaWdodDogNHB4OyIgKm5nSWY9IiEoaXNMb2FkaW5nJCB8IGFzeW5jKSI+PC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPGRpdiBtYXQtZGlhbG9nLWNvbnRlbnQgY2xhc3M9ImZsZXggZmxleC1jb2wiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPG1hdC1mb3JtLWZpZWxkIGNsYXNzPSJtYXQtYmxvY2siIGFwcGVhcmFuY2U9Im91dGxpbmUiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWxhYmVsPk1hY2hpbmUgbmFtZTwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8aW5wdXQgbWF0SW5wdXQgZm9ybUNvbnRyb2xOYW1lPSJtYWNoaW5lTmFtZSIgcmVxdWlyZWQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZXJyb3IgKm5nSWY9ImFkZE1hY2hpbmVGb3JtR3JvdXAuZ2V0KFwnbWFjaGluZU5hbWVcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgTWFjaGluZSBuYW1lIGlzIHJlcXVpcmVkLlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8L21hdC1lcnJvcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9Im1hdC1ibG9jayIgYXBwZWFyYW5jZT0ib3V0bGluZSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtbGFiZWw+TWFjaGluZSB0eXBlPC9tYXQtbGFiZWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtc2VsZWN0IGZvcm1Db250cm9sTmFtZT0ibWFjaGluZVR5cGUiIHJlcXVpcmVkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj0ibGV0IHR5cGUgb2YgbWFjaGluZVR5cGVzIiBbdmFsdWVdPSJ0eXBlLnZhbHVlIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgIHt7dHlwZS5sYWJlbH19XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPC9tYXQtb3B0aW9uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8L21hdC1zZWxlY3Q+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZXJyb3IgKm5nSWY9ImFkZE1hY2hpbmVGb3JtR3JvdXAuZ2V0KFwnbWFjaGluZVR5cGVcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgTWFjaGluZSB0eXBlIGlzIHJlcXVpcmVkLlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8L21hdC1lcnJvcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtcm93IGdhcC0yIiAqbmdJZj0iYWRkTWFjaGluZUZvcm1Hcm91cC5nZXQoXCdtYWNoaW5lVHlwZVwnKS52YWx1ZSA9PT0gXCdFeGNhdmF0b3JcJyI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0iZmxleC0xIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8bWF0LWxhYmVsPldhcm5pbmcgcHJlc3N1cmUgbGltaXQ8L21hdC1sYWJlbD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8aW5wdXQgbWF0SW5wdXQgdHlwZT0ibnVtYmVyIiBmb3JtQ29udHJvbE5hbWU9Indhcm5pbmdUaHJlc2hvbGQiIHJlcXVpcmVkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxzcGFuIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDhweCIgbWF0U3VmZml4Pnt7cHJlc3N1cmVVbml0U3ltYm9sfX08L3NwYW4+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1lcnJvciAqbmdJZj0iYWRkTWFjaGluZUZvcm1Hcm91cC5nZXQoXCd3YXJuaW5nVGhyZXNob2xkXCcpLmhhc0Vycm9yKFwncmVxdWlyZWRcJykiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgUmVxdWlyZWQuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPC9tYXQtZXJyb3I+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0iZmxleC0xIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8bWF0LWxhYmVsPkNyaXRpY2FsIHByZXNzdXJlIGxpbWl0PC9tYXQtbGFiZWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPGlucHV0IG1hdElucHV0IHR5cGU9Im51bWJlciIgZm9ybUNvbnRyb2xOYW1lPSJjcml0aWNhbFRocmVzaG9sZCIgcmVxdWlyZWQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPHNwYW4gc3R5bGU9Im1hcmdpbi1yaWdodDogOHB4IiBtYXRTdWZmaXg+e3twcmVzc3VyZVVuaXRTeW1ib2x9fTwvc3Bhbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8bWF0LWVycm9yICpuZ0lmPSJhZGRNYWNoaW5lRm9ybUdyb3VwLmdldChcJ2NyaXRpY2FsVGhyZXNob2xkXCcpLmhhc0Vycm9yKFwncmVxdWlyZWRcJykiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgUmVxdWlyZWQuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPC9tYXQtZXJyb3I+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2Rpdj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1yb3cgZ2FwLTIiICpuZ0lmPSJhZGRNYWNoaW5lRm9ybUdyb3VwLmdldChcJ21hY2hpbmVUeXBlXCcpLnZhbHVlID09PSBcJ1RydWNrXCciPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9ImZsZXgtMSIgYXBwZWFyYW5jZT0ib3V0bGluZSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1sYWJlbD5XYXJuaW5nIHdlaWdodCBsaW1pdDwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxpbnB1dCBtYXRJbnB1dCB0eXBlPSJudW1iZXIiIGZvcm1Db250cm9sTmFtZT0id2FybmluZ1RocmVzaG9sZCIgcmVxdWlyZWQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPHNwYW4gc3R5bGU9Im1hcmdpbi1yaWdodDogOHB4IiBtYXRTdWZmaXg+e3t3ZWlnaHRVbml0U3ltYm9sfX08L3NwYW4+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1lcnJvciAqbmdJZj0iYWRkTWFjaGluZUZvcm1Hcm91cC5nZXQoXCd3YXJuaW5nVGhyZXNob2xkXCcpLmhhc0Vycm9yKFwncmVxdWlyZWRcJykiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgUmVxdWlyZWQuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPC9tYXQtZXJyb3I+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0iZmxleC0xIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8bWF0LWxhYmVsPkNyaXRpY2FsIHdlaWdodCBsaW1pdDwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxpbnB1dCBtYXRJbnB1dCB0eXBlPSJudW1iZXIiIGZvcm1Db250cm9sTmFtZT0iY3JpdGljYWxUaHJlc2hvbGQiIHJlcXVpcmVkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxzcGFuIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDhweCIgbWF0U3VmZml4Pnt7d2VpZ2h0VW5pdFN5bWJvbH19PC9zcGFuPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxtYXQtZXJyb3IgKm5nSWY9ImFkZE1hY2hpbmVGb3JtR3JvdXAuZ2V0KFwnY3JpdGljYWxUaHJlc2hvbGRcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICBSZXF1aXJlZC5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8L21hdC1lcnJvcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgbWF0LWRpYWxvZy1hY3Rpb25zIGNsYXNzPSJmbGV4IGZsZXgtcm93IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWVuZCI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIHR5cGU9ImJ1dHRvbiJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgW2Rpc2FibGVkXT0iKGlzTG9hZGluZyQgfCBhc3luYykiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIChjbGljayk9ImNhbmNlbCgpIiBjZGtGb2N1c0luaXRpYWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIENhbmNlbFxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPC9idXR0b24+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIHR5cGU9InN1Ym1pdCJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgW2Rpc2FibGVkXT0iKGlzTG9hZGluZyQgfCBhc3luYykgfHwgYWRkTWFjaGluZUZvcm1Hcm91cC5pbnZhbGlkIHx8ICFhZGRNYWNoaW5lRm9ybUdyb3VwLmRpcnR5Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgQWRkXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2J1dHRvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8L2Rpdj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9mb3JtPic7CgogICAgICAgIGN1c3RvbURpYWxvZy5jdXN0b21EaWFsb2coYWRkTWFjaGluZUh0bWxUZW1wbGF0ZSwgQWRkTWFjaGluZURpYWxvZ0NvbnRyb2xsZXIpLnN1YnNjcmliZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIEFkZE1hY2hpbmVEaWFsb2dDb250cm9sbGVyKGluc3RhbmNlKSB7CiAgICAgICAgbGV0IHZtID0gaW5zdGFuY2U7CgogICAgICAgIGNvbnN0IHByZXNzdXJlVW5pdCA9IHsKICAgICAgICAgICAgZnJvbTogJ3BzaScsCiAgICAgICAgICAgIE1FVFJJQzogJ2JhcicsCiAgICAgICAgICAgIElNUEVSSUFMOiAncHNpJywKICAgICAgICAgICAgSFlCUklEOiAnYmFyJwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGxvYWRXZWlnaHRVbml0ID0gewogICAgICAgICAgICBmcm9tOiAnbGInLAogICAgICAgICAgICBNRVRSSUM6ICd0JywKICAgICAgICAgICAgSU1QRVJJQUw6ICdsYicsCiAgICAgICAgICAgIEhZQlJJRDogJ3QnCiAgICAgICAgfTsKCiAgICAgICAgdm0ucHJlc3N1cmVVbml0U3ltYm9sID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5nZXRUYXJnZXRVbml0U3ltYm9sKHByZXNzdXJlVW5pdCk7CiAgICAgICAgdm0ud2VpZ2h0VW5pdFN5bWJvbCA9IHdpZGdldENvbnRleHQudW5pdFNlcnZpY2UuZ2V0VGFyZ2V0VW5pdFN5bWJvbChsb2FkV2VpZ2h0VW5pdCk7CgogICAgICAgIGNvbnN0IHByZXNzdXJlRnJvbU1ldHJpYyA9IHsKICAgICAgICAgICAgZnJvbTogJ2JhcicsCiAgICAgICAgICAgIE1FVFJJQzogJ2JhcicsCiAgICAgICAgICAgIElNUEVSSUFMOiAncHNpJywKICAgICAgICAgICAgSFlCUklEOiAnYmFyJwogICAgICAgIH07CgogICAgICAgIGNvbnN0IHdlaWdodEZyb21NZXRyaWMgPSB7CiAgICAgICAgICAgIGZyb206ICd0JywKICAgICAgICAgICAgTUVUUklDOiAndCcsCiAgICAgICAgICAgIElNUEVSSUFMOiAnbGInLAogICAgICAgICAgICBIWUJSSUQ6ICd0JwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGRlZmF1bHRQcmVzc3VyZVdhcm5pbmcgPSBNYXRoLnJvdW5kKHdpZGdldENvbnRleHQudW5pdFNlcnZpY2UuY29udmVydFVuaXRWYWx1ZSg1MTAwLCBwcmVzc3VyZUZyb21NZXRyaWMpKTsKICAgICAgICBjb25zdCBkZWZhdWx0UHJlc3N1cmVDcml0aWNhbCA9IE1hdGgucm91bmQod2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5jb252ZXJ0VW5pdFZhbHVlKDU1MDAsIHByZXNzdXJlRnJvbU1ldHJpYykpOwogICAgICAgIGNvbnN0IGRlZmF1bHRXZWlnaHRXYXJuaW5nID0gTWF0aC5yb3VuZCh3aWRnZXRDb250ZXh0LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUoMzIsIHdlaWdodEZyb21NZXRyaWMpKTsKICAgICAgICBjb25zdCBkZWZhdWx0V2VpZ2h0Q3JpdGljYWwgPSBNYXRoLnJvdW5kKHdpZGdldENvbnRleHQudW5pdFNlcnZpY2UuY29udmVydFVuaXRWYWx1ZSgzNSwgd2VpZ2h0RnJvbU1ldHJpYykpOwoKICAgICAgICB2bS5tYWNoaW5lVHlwZXMgPSBbCiAgICAgICAgICAgIHsgdmFsdWU6ICdFeGNhdmF0b3InLCBsYWJlbDogJ0V4Y2F2YXRvcicgfSwKICAgICAgICAgICAgeyB2YWx1ZTogJ1RydWNrJywgbGFiZWw6ICdUcnVjaycgfQogICAgICAgIF07CgogICAgICAgIHZtLmFkZE1hY2hpbmVGb3JtR3JvdXAgPSB2bS5mYi5ncm91cCh7CiAgICAgICAgICAgIG1hY2hpbmVOYW1lOiBbJycsIFt2bS52YWxpZGF0b3JzLnJlcXVpcmVkXV0sCiAgICAgICAgICAgIG1hY2hpbmVUeXBlOiBbbnVsbCwgW3ZtLnZhbGlkYXRvcnMucmVxdWlyZWRdXSwKICAgICAgICAgICAgd2FybmluZ1RocmVzaG9sZDogW251bGwsIFt2bS52YWxpZGF0b3JzLnJlcXVpcmVkXV0sCiAgICAgICAgICAgIGNyaXRpY2FsVGhyZXNob2xkOiBbbnVsbCwgW3ZtLnZhbGlkYXRvcnMucmVxdWlyZWRdXQogICAgICAgIH0pOwoKICAgICAgICB2bS5hZGRNYWNoaW5lRm9ybUdyb3VwLmdldCgnbWFjaGluZVR5cGUnKS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh0eXBlKSA9PiB7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAnRXhjYXZhdG9yJykgewogICAgICAgICAgICAgICAgdm0uYWRkTWFjaGluZUZvcm1Hcm91cC5wYXRjaFZhbHVlKHsKICAgICAgICAgICAgICAgICAgICB3YXJuaW5nVGhyZXNob2xkOiBkZWZhdWx0UHJlc3N1cmVXYXJuaW5nLAogICAgICAgICAgICAgICAgICAgIGNyaXRpY2FsVGhyZXNob2xkOiBkZWZhdWx0UHJlc3N1cmVDcml0aWNhbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ1RydWNrJykgewogICAgICAgICAgICAgICAgdm0uYWRkTWFjaGluZUZvcm1Hcm91cC5wYXRjaFZhbHVlKHsKICAgICAgICAgICAgICAgICAgICB3YXJuaW5nVGhyZXNob2xkOiBkZWZhdWx0V2VpZ2h0V2FybmluZywKICAgICAgICAgICAgICAgICAgICBjcml0aWNhbFRocmVzaG9sZDogZGVmYXVsdFdlaWdodENyaXRpY2FsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdm0uZGlhbG9nUmVmLmNsb3NlKG51bGwpOwogICAgICAgIH07CgogICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdm0uYWRkTWFjaGluZUZvcm1Hcm91cC5tYXJrQXNQcmlzdGluZSgpOwogICAgICAgICAgICBzYXZlRGV2aWNlT2JzZXJ2YWJsZSgpLnN1YnNjcmliZSgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRldmljZSkgewogICAgICAgICAgICAgICAgICAgIGdldE1pbmVTaXRlSWQoKS5waXBlKAogICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRDb250ZXh0LnJ4anMuc3dpdGNoTWFwKChtaW5lU2l0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5yeGpzLmZvcmtKb2luKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlTWluZVNpdGVUb01hY2hpbmVSZWxhdGlvbihtaW5lU2l0ZUlkLCBkZXZpY2UuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVBdHRyaWJ1dGVzKGRldmljZS5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldENvbnRleHQudXBkYXRlQWxpYXNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGlhbG9nUmVmLmNsb3NlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBzYXZlRGV2aWNlT2JzZXJ2YWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGdldE9yQ3JlYXRlTWFjaGluZXNEZXZpY2VHcm91cCgpLnBpcGUoCiAgICAgICAgICAgICAgICB3aWRnZXRDb250ZXh0LnJ4anMuc3dpdGNoTWFwKChtYWNoaW5lc0dyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHZtLmFkZE1hY2hpbmVGb3JtR3JvdXAudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlUHJvZmlsZSA9IGZvcm1WYWx1ZXMubWFjaGluZVR5cGUgPT09ICdUcnVjaycgPyAnSGF1bCB0cnVjaycgOiAnRXhjYXZhdG9yJzsKICAgICAgICAgICAgICAgICAgICBsZXQgbWFjaGluZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZm9ybVZhbHVlcy5tYWNoaW5lTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZvcm1WYWx1ZXMubWFjaGluZU5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGRldmljZVByb2ZpbGUKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2VTZXJ2aWNlLnNhdmVEZXZpY2UobWFjaGluZSwgbWFjaGluZXNHcm91cC5pZC5pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0T3JDcmVhdGVNYWNoaW5lc0RldmljZUdyb3VwKCkgewogICAgICAgICAgICByZXR1cm4gZ2V0RW50aXR5R3JvdXBCeU5hbWUoJ01hY2hpbmVzJywgJ0RFVklDRScpLnBpcGUoCiAgICAgICAgICAgICAgICB3aWRnZXRDb250ZXh0LnJ4anMuc3dpdGNoTWFwKChncm91cCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChncm91cCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5yeGpzLm9mKGdyb3VwKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWFjaGluZXNHcm91cCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdERVZJQ0UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ01hY2hpbmVzJwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZW50aXR5R3JvdXBTZXJ2aWNlLnNhdmVFbnRpdHlHcm91cChtYWNoaW5lc0dyb3VwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RW50aXR5R3JvdXBCeU5hbWUoZ3JvdXBOYW1lLCBncm91cFR5cGUpIHsKICAgICAgICAgICAgbGV0IGVudGl0eUdyb3Vwc1BhZ2VMaW5rID0gd2lkZ2V0Q29udGV4dC5wYWdlTGluaygxMCwgMCwgZ3JvdXBOYW1lKTsKICAgICAgICAgICAgcmV0dXJuIGVudGl0eUdyb3VwU2VydmljZS5nZXRFbnRpdHlHcm91cHNCeVBhZ2VMaW5rKGVudGl0eUdyb3Vwc1BhZ2VMaW5rLCBncm91cFR5cGUsIHsgaWdub3JlTG9hZGluZzogdHJ1ZSB9KS5waXBlKAogICAgICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLm1hcCgoZGF0YSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLmRhdGEuZmluZCgoZ3JvdXApID0+IGdyb3VwLm5hbWUgPT09IGdyb3VwTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldE1pbmVTaXRlSWQoKSB7CiAgICAgICAgICAgIGNvbnN0IG1pbmVTaXRlQWxpYXNJZCA9IHdpZGdldENvbnRleHQuYWxpYXNDb250cm9sbGVyLmdldEVudGl0eUFsaWFzSWQoJ01pbmUgc2l0ZScpOwogICAgICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5hbGlhc0NvbnRyb2xsZXIuZ2V0QWxpYXNJbmZvKG1pbmVTaXRlQWxpYXNJZCkucGlwZSgKICAgICAgICAgICAgICAgIHdpZGdldENvbnRleHQucnhqcy5tYXAoKGluZm8pID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBpZDogaW5mby5jdXJyZW50RW50aXR5LmlkLCBlbnRpdHlUeXBlOiBpbmZvLmN1cnJlbnRFbnRpdHkuZW50aXR5VHlwZSB9OwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNhdmVNaW5lU2l0ZVRvTWFjaGluZVJlbGF0aW9uKG1pbmVTaXRlSWQsIG1hY2hpbmVJZCkgewogICAgICAgICAgICBsZXQgcmVsYXRpb24gPSB7CiAgICAgICAgICAgICAgICBmcm9tOiBtaW5lU2l0ZUlkLAogICAgICAgICAgICAgICAgdG86IG1hY2hpbmVJZCwKICAgICAgICAgICAgICAgIHR5cGVHcm91cDogJ0NPTU1PTicsCiAgICAgICAgICAgICAgICB0eXBlOiAnTWluZVNpdGVUb01hY2hpbmUnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBlbnRpdHlSZWxhdGlvblNlcnZpY2Uuc2F2ZVJlbGF0aW9uKHJlbGF0aW9uKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNhdmVBdHRyaWJ1dGVzKGVudGl0eUlkKSB7CiAgICAgICAgICAgIGNvbnN0IGZvcm1WYWx1ZXMgPSB2bS5hZGRNYWNoaW5lRm9ybUdyb3VwLnZhbHVlOwogICAgICAgICAgICBjb25zdCBtYWNoaW5lVHlwZSA9IGZvcm1WYWx1ZXMubWFjaGluZVR5cGU7CiAgICAgICAgICAgIGNvbnN0IHdhcm5pbmdWYWx1ZSA9IGZvcm1WYWx1ZXMud2FybmluZ1RocmVzaG9sZDsKICAgICAgICAgICAgY29uc3QgY3JpdGljYWxWYWx1ZSA9IGZvcm1WYWx1ZXMuY3JpdGljYWxUaHJlc2hvbGQ7CgogICAgICAgICAgICBsZXQgYXR0cmlidXRlc0FycmF5ID0gW107CgogICAgICAgICAgICBpZiAobWFjaGluZVR5cGUgPT09ICdFeGNhdmF0b3InKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVzc3VyZVRvU3RvcmFnZSA9IHsKICAgICAgICAgICAgICAgICAgICBmcm9tOiB2bS5wcmVzc3VyZVVuaXRTeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgTUVUUklDOiAncHNpJywKICAgICAgICAgICAgICAgICAgICBJTVBFUklBTDogJ3BzaScsCiAgICAgICAgICAgICAgICAgICAgSFlCUklEOiAncHNpJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvbnN0IHdhcm5pbmdJblBzaSA9IHdpZGdldENvbnRleHQudW5pdFNlcnZpY2UuY29udmVydFVuaXRWYWx1ZSh3YXJuaW5nVmFsdWUsIHByZXNzdXJlVG9TdG9yYWdlKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNyaXRpY2FsSW5Qc2kgPSB3aWRnZXRDb250ZXh0LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUoY3JpdGljYWxWYWx1ZSwgcHJlc3N1cmVUb1N0b3JhZ2UpOwoKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNBcnJheS5wdXNoKHsga2V5OiAnaHlkcmF1bGljUHJlc3N1cmVXYXJuaW5nVGhyZXNob2xkJywgdmFsdWU6IHdhcm5pbmdJblBzaSB9KTsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNBcnJheS5wdXNoKHsga2V5OiAnaHlkcmF1bGljUHJlc3N1cmVDcml0aWNhbFRocmVzaG9sZCcsIHZhbHVlOiBjcml0aWNhbEluUHNpIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKG1hY2hpbmVUeXBlID09PSAnVHJ1Y2snKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3ZWlnaHRUb1N0b3JhZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgZnJvbTogdm0ud2VpZ2h0VW5pdFN5bWJvbCwKICAgICAgICAgICAgICAgICAgICBNRVRSSUM6ICdsYicsCiAgICAgICAgICAgICAgICAgICAgSU1QRVJJQUw6ICdsYicsCiAgICAgICAgICAgICAgICAgICAgSFlCUklEOiAnbGInCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29uc3Qgd2FybmluZ0luTGIgPSB3aWRnZXRDb250ZXh0LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUod2FybmluZ1ZhbHVlLCB3ZWlnaHRUb1N0b3JhZ2UpOwogICAgICAgICAgICAgICAgY29uc3QgY3JpdGljYWxJbkxiID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5jb252ZXJ0VW5pdFZhbHVlKGNyaXRpY2FsVmFsdWUsIHdlaWdodFRvU3RvcmFnZSk7CgogICAgICAgICAgICAgICAgYXR0cmlidXRlc0FycmF5LnB1c2goeyBrZXk6ICdsb2FkV2VpZ2h0V2FybmluZ1RocmVzaG9sZCcsIHZhbHVlOiB3YXJuaW5nSW5MYiB9KTsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNBcnJheS5wdXNoKHsga2V5OiAnbG9hZFdlaWdodENyaXRpY2FsVGhyZXNob2xkJywgdmFsdWU6IGNyaXRpY2FsSW5MYiB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IHRpbWVzZXJpZXNBcnJheSA9IGdldE1hcEl0ZW1Mb2NhdGlvblRpbWVzZXJpZXMoKTsKCiAgICAgICAgICAgIGxldCB0YXNrcyA9IFtdOwoKICAgICAgICAgICAgaWYgKHRpbWVzZXJpZXNBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0YXNrcy5wdXNoKGF0dHJpYnV0ZVNlcnZpY2Uuc2F2ZUVudGl0eVRpbWVzZXJpZXMoZW50aXR5SWQsICdMQVRFU1RfVEVMRU1FVFJZJywgdGltZXNlcmllc0FycmF5KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0YXNrcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5yeGpzLmZvcmtKb2luKHRhc2tzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5yeGpzLm9mKFtdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldE1hcEl0ZW1Mb2NhdGlvblRpbWVzZXJpZXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWVzZXJpZXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgbWFwSXRlbVR5cGUgPSAkZXZlbnQuc2hhcGU7CiAgICAgICAgICAgIGlmIChtYXBJdGVtVHlwZSA9PT0gJ01hcmtlcicpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1hcFR5cGUgPSB3aWRnZXRDb250ZXh0Lm1hcEluc3RhbmNlLnR5cGUoKTsKICAgICAgICAgICAgICAgIGlmIChtYXBUeXBlICE9PSAnaW1hZ2UnKSB7CiAgICAgICAgICAgICAgICAgICAgdGltZXNlcmllcy5wdXNoKHsga2V5OiAnbGF0aXR1ZGUnLCB2YWx1ZTogYWRkaXRpb25hbFBhcmFtcy5jb29yZGluYXRlcy54IH0pOwogICAgICAgICAgICAgICAgICAgIHRpbWVzZXJpZXMucHVzaCh7IGtleTogJ2xvbmdpdHVkZScsIHZhbHVlOiBhZGRpdGlvbmFsUGFyYW1zLmNvb3JkaW5hdGVzLnkgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRpbWVzZXJpZXM7CiAgICAgICAgfQogICAgfQp9CgpleHBvcnQgZnVuY3Rpb24gYWRkWm9uZVRvTWluZVNpdGUoJGV2ZW50LCB3aWRnZXRDb250ZXh0LCBhZGRpdGlvbmFsUGFyYW1zKSB7CiAgICBsZXQgJGluamVjdG9yID0gd2lkZ2V0Q29udGV4dC4kc2NvcGUuJGluamVjdG9yOwogICAgbGV0IGN1c3RvbURpYWxvZyA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2N1c3RvbURpYWxvZycpKTsKICAgIGxldCBhc3NldFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdhc3NldFNlcnZpY2UnKSk7CiAgICBsZXQgZW50aXR5R3JvdXBTZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZW50aXR5R3JvdXBTZXJ2aWNlJykpOwogICAgbGV0IGF0dHJpYnV0ZVNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdhdHRyaWJ1dGVTZXJ2aWNlJykpOwogICAgbGV0IGVudGl0eVJlbGF0aW9uU2VydmljZSA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2VudGl0eVJlbGF0aW9uU2VydmljZScpKTsKCiAgICBvcGVuQWRkWm9uZURpYWxvZygpOwoKICAgIGZ1bmN0aW9uIG9wZW5BZGRab25lRGlhbG9nKCkgewoKICAgICAgICBjb25zdCBhZGRab25lSHRtbFRlbXBsYXRlID0gJzxmb3JtICNhZGRFbnRpdHlGb3JtPSJuZ0Zvcm0iIFtmb3JtR3JvdXBdPSJhZGRab25lRm9ybUdyb3VwIlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAobmdTdWJtaXQpPSJzYXZlKCkiIGNsYXNzPSJhZGQtZW50aXR5LWZvcm0iIHN0eWxlPSJ3aWR0aDogNjAwcHg7Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8bWF0LXRvb2xiYXIgY2xhc3M9ImZsZXggZmxleC1yb3ciIGNvbG9yPSJwcmltYXJ5Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxoMj5BZGQgbmV3IHpvbmU8L2gyPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPHNwYW4gY2xhc3M9ImZsZXgtMSI+PC9zcGFuPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPGJ1dHRvbiBtYXQtaWNvbi1idXR0b24gKGNsaWNrKT0iY2FuY2VsKCkiIHR5cGU9ImJ1dHRvbiI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtaWNvbiBjbGFzcz0ibWF0ZXJpYWwtaWNvbnMiPmNsb3NlPC9tYXQtaWNvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvYnV0dG9uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvbWF0LXRvb2xiYXI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPG1hdC1wcm9ncmVzcy1iYXIgY29sb3I9Indhcm4iIG1vZGU9ImluZGV0ZXJtaW5hdGUiICpuZ0lmPSJpc0xvYWRpbmckIHwgYXN5bmMiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvbWF0LXByb2dyZXNzLWJhcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8ZGl2IHN0eWxlPSJoZWlnaHQ6IDRweDsiICpuZ0lmPSIhKGlzTG9hZGluZyQgfCBhc3luYykiPjwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgbWF0LWRpYWxvZy1jb250ZW50IGNsYXNzPSJmbGV4IGZsZXgtY29sIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0ibWF0LWJsb2NrIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPG1hdC1sYWJlbD5ab25lIG5hbWU8L21hdC1sYWJlbD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPGlucHV0IG1hdElucHV0IGZvcm1Db250cm9sTmFtZT0iem9uZU5hbWUiIHJlcXVpcmVkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWVycm9yICpuZ0lmPSJhZGRab25lRm9ybUdyb3VwLmdldChcJ3pvbmVOYW1lXCcpLmhhc0Vycm9yKFwncmVxdWlyZWRcJykiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIFpvbmUgbmFtZSBpcyByZXF1aXJlZC5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtZXJyb3I+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L21hdC1mb3JtLWZpZWxkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPG1hdC1mb3JtLWZpZWxkIGNsYXNzPSJtYXQtYmxvY2siIGFwcGVhcmFuY2U9Im91dGxpbmUiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWxhYmVsPlpvbmUgdHlwZTwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LXNlbGVjdCBmb3JtQ29udHJvbE5hbWU9InpvbmVUeXBlIiByZXF1aXJlZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8bWF0LW9wdGlvbiAqbmdGb3I9ImxldCB0eXBlIG9mIHpvbmVUeXBlcyIgW3ZhbHVlXT0idHlwZS52YWx1ZSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICB7e3R5cGUubGFiZWx9fVxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDwvbWF0LW9wdGlvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtc2VsZWN0PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWVycm9yICpuZ0lmPSJhZGRab25lRm9ybUdyb3VwLmdldChcJ3pvbmVUeXBlXCcpLmhhc0Vycm9yKFwncmVxdWlyZWRcJykiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIFpvbmUgdHlwZSBpcyByZXF1aXJlZC5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtZXJyb3I+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L21hdC1mb3JtLWZpZWxkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgbWF0LWRpYWxvZy1hY3Rpb25zIGNsYXNzPSJmbGV4IGZsZXgtcm93IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWVuZCI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIHR5cGU9ImJ1dHRvbiJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgW2Rpc2FibGVkXT0iKGlzTG9hZGluZyQgfCBhc3luYykiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIChjbGljayk9ImNhbmNlbCgpIiBjZGtGb2N1c0luaXRpYWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIENhbmNlbFxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPC9idXR0b24+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIHR5cGU9InN1Ym1pdCJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgW2Rpc2FibGVkXT0iKGlzTG9hZGluZyQgfCBhc3luYykgfHwgYWRkWm9uZUZvcm1Hcm91cC5pbnZhbGlkIHx8ICFhZGRab25lRm9ybUdyb3VwLmRpcnR5Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgQWRkXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2J1dHRvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8L2Rpdj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9mb3JtPic7CgogICAgICAgIGN1c3RvbURpYWxvZy5jdXN0b21EaWFsb2coYWRkWm9uZUh0bWxUZW1wbGF0ZSwgQWRkWm9uZURpYWxvZ0NvbnRyb2xsZXIpLnN1YnNjcmliZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIEFkZFpvbmVEaWFsb2dDb250cm9sbGVyKGluc3RhbmNlKSB7CiAgICAgICAgbGV0IHZtID0gaW5zdGFuY2U7CgogICAgICAgIHZtLnpvbmVUeXBlcyA9IFsKICAgICAgICAgICAgeyB2YWx1ZTogJ0xvYWRpbmcnLCBsYWJlbDogJ0xvYWRpbmcnIH0sCiAgICAgICAgICAgIHsgdmFsdWU6ICdVbmxvYWRpbmcnLCBsYWJlbDogJ1VubG9hZGluZycgfSwKICAgICAgICAgICAgeyB2YWx1ZTogJ1Jlc3RyaWN0ZWQnLCBsYWJlbDogJ1Jlc3RyaWN0ZWQnIH0KICAgICAgICBdOwoKICAgICAgICB2bS5hZGRab25lRm9ybUdyb3VwID0gdm0uZmIuZ3JvdXAoewogICAgICAgICAgICB6b25lTmFtZTogWycnLCBbdm0udmFsaWRhdG9ycy5yZXF1aXJlZF1dLAogICAgICAgICAgICB6b25lVHlwZTogW251bGwsIFt2bS52YWxpZGF0b3JzLnJlcXVpcmVkXV0KICAgICAgICB9KTsKCiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZtLmRpYWxvZ1JlZi5jbG9zZShudWxsKTsKICAgICAgICB9OwoKICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZtLmFkZFpvbmVGb3JtR3JvdXAubWFya0FzUHJpc3RpbmUoKTsKICAgICAgICAgICAgc2F2ZUFzc2V0T2JzZXJ2YWJsZSgpLnN1YnNjcmliZSgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGFzc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZ2V0TWluZVNpdGVJZCgpLnBpcGUoCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldENvbnRleHQucnhqcy5zd2l0Y2hNYXAoKG1pbmVTaXRlSWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3aWRnZXRDb250ZXh0LnJ4anMuZm9ya0pvaW4oWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVNaW5lU2l0ZVRvWm9uZVJlbGF0aW9uKG1pbmVTaXRlSWQsIGFzc2V0LmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQXR0cmlidXRlcyhhc3NldC5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldENvbnRleHQudXBkYXRlQWxpYXNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGlhbG9nUmVmLmNsb3NlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBzYXZlQXNzZXRPYnNlcnZhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gZ2V0T3JDcmVhdGVNaW5lU2l0ZVpvbmVzQXNzZXRHcm91cCgpLnBpcGUoCiAgICAgICAgICAgICAgICB3aWRnZXRDb250ZXh0LnJ4anMuc3dpdGNoTWFwKCh6b25lc0dyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHZtLmFkZFpvbmVGb3JtR3JvdXAudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgbGV0IHpvbmUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGZvcm1WYWx1ZXMuem9uZU5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBmb3JtVmFsdWVzLnpvbmVOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWluZSBzaXRlIHpvbmUnCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRTZXJ2aWNlLnNhdmVBc3NldCh6b25lLCB6b25lc0dyb3VwLmlkLmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRPckNyZWF0ZU1pbmVTaXRlWm9uZXNBc3NldEdyb3VwKCkgewogICAgICAgICAgICByZXR1cm4gZ2V0RW50aXR5R3JvdXBCeU5hbWUoJ01pbmVTaXRlWm9uZXMnLCAnQVNTRVQnKS5waXBlKAogICAgICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLnN3aXRjaE1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpZGdldENvbnRleHQucnhqcy5vZihncm91cCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHpvbmVzR3JvdXAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQVNTRVQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ01pbmVTaXRlWm9uZXMnCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbnRpdHlHcm91cFNlcnZpY2Uuc2F2ZUVudGl0eUdyb3VwKHpvbmVzR3JvdXApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRFbnRpdHlHcm91cEJ5TmFtZShncm91cE5hbWUsIGdyb3VwVHlwZSkgewogICAgICAgICAgICBsZXQgZW50aXR5R3JvdXBzUGFnZUxpbmsgPSB3aWRnZXRDb250ZXh0LnBhZ2VMaW5rKDEwLCAwLCBncm91cE5hbWUpOwogICAgICAgICAgICByZXR1cm4gZW50aXR5R3JvdXBTZXJ2aWNlLmdldEVudGl0eUdyb3Vwc0J5UGFnZUxpbmsoZW50aXR5R3JvdXBzUGFnZUxpbmssIGdyb3VwVHlwZSwgeyBpZ25vcmVMb2FkaW5nOiB0cnVlIH0pLnBpcGUoCiAgICAgICAgICAgICAgICB3aWRnZXRDb250ZXh0LnJ4anMubWFwKChkYXRhKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuZGF0YS5maW5kKChncm91cCkgPT4gZ3JvdXAubmFtZSA9PT0gZ3JvdXBOYW1lKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0TWluZVNpdGVJZCgpIHsKICAgICAgICAgICAgY29uc3QgbWluZVNpdGVBbGlhc0lkID0gd2lkZ2V0Q29udGV4dC5hbGlhc0NvbnRyb2xsZXIuZ2V0RW50aXR5QWxpYXNJZCgnTWluZSBzaXRlJyk7CiAgICAgICAgICAgIHJldHVybiB3aWRnZXRDb250ZXh0LmFsaWFzQ29udHJvbGxlci5nZXRBbGlhc0luZm8obWluZVNpdGVBbGlhc0lkKS5waXBlKAogICAgICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLm1hcCgoaW5mbykgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGlkOiBpbmZvLmN1cnJlbnRFbnRpdHkuaWQsIGVudGl0eVR5cGU6IGluZm8uY3VycmVudEVudGl0eS5lbnRpdHlUeXBlIH07CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2F2ZU1pbmVTaXRlVG9ab25lUmVsYXRpb24obWluZVNpdGVJZCwgem9uZUlkKSB7CiAgICAgICAgICAgIGNvbnN0IGZvcm1WYWx1ZXMgPSB2bS5hZGRab25lRm9ybUdyb3VwLnZhbHVlOwogICAgICAgICAgICBjb25zdCB6b25lVHlwZSA9IGZvcm1WYWx1ZXMuem9uZVR5cGU7CgogICAgICAgICAgICBsZXQgcmVsYXRpb25UeXBlOwogICAgICAgICAgICBzd2l0Y2ggKHpvbmVUeXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICdMb2FkaW5nJzoKICAgICAgICAgICAgICAgICAgICByZWxhdGlvblR5cGUgPSAnTWluZVNpdGVUb0xvYWRpbmdab25lJzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ1VubG9hZGluZyc6CiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UeXBlID0gJ01pbmVTaXRlVG9VbmxvYWRpbmdab25lJzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ1Jlc3RyaWN0ZWQnOgogICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uVHlwZSA9ICdNaW5lU2l0ZVRvUmVzdHJpY3RlZFpvbmUnOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZWxhdGlvblR5cGUgPSAnTWluZVNpdGVUb1pvbmUnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgcmVsYXRpb24gPSB7CiAgICAgICAgICAgICAgICBmcm9tOiBtaW5lU2l0ZUlkLAogICAgICAgICAgICAgICAgdG86IHpvbmVJZCwKICAgICAgICAgICAgICAgIHR5cGVHcm91cDogJ0NPTU1PTicsCiAgICAgICAgICAgICAgICB0eXBlOiByZWxhdGlvblR5cGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGVudGl0eVJlbGF0aW9uU2VydmljZS5zYXZlUmVsYXRpb24ocmVsYXRpb24pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2F2ZUF0dHJpYnV0ZXMoZW50aXR5SWQpIHsKICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXNBcnJheSA9IFtdOwoKICAgICAgICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHZtLmFkZFpvbmVGb3JtR3JvdXAudmFsdWU7CiAgICAgICAgICAgIGF0dHJpYnV0ZXNBcnJheS5wdXNoKHsga2V5OiAndHlwZScsIHZhbHVlOiBmb3JtVmFsdWVzLnpvbmVUeXBlIH0pOwoKICAgICAgICAgICAgYXR0cmlidXRlc0FycmF5LnB1c2goLi4uZ2V0TWFwSXRlbUxvY2F0aW9uQXR0cmlidXRlcygpKTsKCiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZVNlcnZpY2Uuc2F2ZUVudGl0eUF0dHJpYnV0ZXMoZW50aXR5SWQsICdTRVJWRVJfU0NPUEUnLCBhdHRyaWJ1dGVzQXJyYXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB3aWRnZXRDb250ZXh0LnJ4anMub2YoW10pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwSXRlbUxvY2F0aW9uQXR0cmlidXRlcygpIHsKICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IFtdOwogICAgICAgICAgICBjb25zdCBtYXBJdGVtVHlwZSA9ICRldmVudC5zaGFwZTsKICAgICAgICAgICAgaWYgKG1hcEl0ZW1UeXBlID09PSAnUmVjdGFuZ2xlJyB8fCBtYXBJdGVtVHlwZSA9PT0gJ1BvbHlnb24nKSB7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goeyBrZXk6ICdwZXJpbWV0ZXInLCB2YWx1ZTogYWRkaXRpb25hbFBhcmFtcy5jb29yZGluYXRlcyB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChtYXBJdGVtVHlwZSA9PT0gJ0NpcmNsZScpIHsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMucHVzaCh7IGtleTogJ2NpcmNsZScsIHZhbHVlOiBhZGRpdGlvbmFsUGFyYW1zLmNvb3JkaW5hdGVzIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwogICAgICAgIH0KICAgIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGVkaXRNYWNoaW5lKHdpZGdldENvbnRleHQsIGVudGl0eUlkLCBlbnRpdHlOYW1lKSB7CiAgICBsZXQgJGluamVjdG9yID0gd2lkZ2V0Q29udGV4dC4kc2NvcGUuJGluamVjdG9yOwogICAgbGV0IGN1c3RvbURpYWxvZyA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2N1c3RvbURpYWxvZycpKTsKICAgIGxldCBkZXZpY2VTZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZGV2aWNlU2VydmljZScpKTsKICAgIGxldCBhdHRyaWJ1dGVTZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnYXR0cmlidXRlU2VydmljZScpKTsKCiAgICBvcGVuRWRpdE1hY2hpbmVEaWFsb2coKTsKCiAgICBmdW5jdGlvbiBvcGVuRWRpdE1hY2hpbmVEaWFsb2coKSB7CgogICAgICAgIGNvbnN0IGVkaXRNYWNoaW5lSHRtbFRlbXBsYXRlID0gJzxmb3JtICNlZGl0RW50aXR5Rm9ybT0ibmdGb3JtIiBbZm9ybUdyb3VwXT0iZWRpdE1hY2hpbmVGb3JtR3JvdXAiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAobmdTdWJtaXQpPSJzYXZlKCkiIGNsYXNzPSJlZGl0LWVudGl0eS1mb3JtIiBzdHlsZT0id2lkdGg6IDYwMHB4OyI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxtYXQtdG9vbGJhciBjbGFzcz0iZmxleCBmbGV4LXJvdyIgY29sb3I9InByaW1hcnkiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxoMj5FZGl0IG1hY2hpbmU8L2gyPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxzcGFuIGNsYXNzPSJmbGV4LTEiPjwvc3Bhbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1pY29uLWJ1dHRvbiAoY2xpY2spPSJjYW5jZWwoKSIgdHlwZT0iYnV0dG9uIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtaWNvbiBjbGFzcz0ibWF0ZXJpYWwtaWNvbnMiPmNsb3NlPC9tYXQtaWNvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2J1dHRvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9tYXQtdG9vbGJhcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPG1hdC1wcm9ncmVzcy1iYXIgY29sb3I9Indhcm4iIG1vZGU9ImluZGV0ZXJtaW5hdGUiICpuZ0lmPSJpc0xvYWRpbmckIHwgYXN5bmMiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8L21hdC1wcm9ncmVzcy1iYXI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgc3R5bGU9ImhlaWdodDogNHB4OyIgKm5nSWY9IiEoaXNMb2FkaW5nJCB8IGFzeW5jKSI+PC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgbWF0LWRpYWxvZy1jb250ZW50IGNsYXNzPSJmbGV4IGZsZXgtY29sIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9Im1hdC1ibG9jayIgYXBwZWFyYW5jZT0ib3V0bGluZSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWxhYmVsPk1hY2hpbmUgbmFtZTwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPGlucHV0IG1hdElucHV0IGZvcm1Db250cm9sTmFtZT0ibWFjaGluZU5hbWUiIHJlcXVpcmVkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPG1hdC1lcnJvciAqbmdJZj0iZWRpdE1hY2hpbmVGb3JtR3JvdXAuZ2V0KFwnbWFjaGluZU5hbWVcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIE1hY2hpbmUgbmFtZSBpcyByZXF1aXJlZC5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDwvbWF0LWVycm9yPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LXJvdyBnYXAtMiIgKm5nSWY9Im1hY2hpbmVUeXBlID09PSBcJ0V4Y2F2YXRvclwnIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0iZmxleC0xIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1sYWJlbD5XYXJuaW5nIHByZXNzdXJlIGxpbWl0PC9tYXQtbGFiZWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxpbnB1dCBtYXRJbnB1dCB0eXBlPSJudW1iZXIiIGZvcm1Db250cm9sTmFtZT0id2FybmluZ1RocmVzaG9sZCIgcmVxdWlyZWQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxzcGFuIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDhweCIgbWF0U3VmZml4Pnt7cHJlc3N1cmVVbml0U3ltYm9sfX08L3NwYW4+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxtYXQtZXJyb3IgKm5nSWY9ImVkaXRNYWNoaW5lRm9ybUdyb3VwLmdldChcJ3dhcm5pbmdUaHJlc2hvbGRcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgUmVxdWlyZWQuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDwvbWF0LWVycm9yPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0iZmxleC0xIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1sYWJlbD5Dcml0aWNhbCBwcmVzc3VyZSBsaW1pdDwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8aW5wdXQgbWF0SW5wdXQgdHlwZT0ibnVtYmVyIiBmb3JtQ29udHJvbE5hbWU9ImNyaXRpY2FsVGhyZXNob2xkIiByZXF1aXJlZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPHNwYW4gc3R5bGU9Im1hcmdpbi1yaWdodDogOHB4IiBtYXRTdWZmaXg+e3twcmVzc3VyZVVuaXRTeW1ib2x9fTwvc3Bhbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1lcnJvciAqbmdJZj0iZWRpdE1hY2hpbmVGb3JtR3JvdXAuZ2V0KFwnY3JpdGljYWxUaHJlc2hvbGRcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgUmVxdWlyZWQuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDwvbWF0LWVycm9yPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2Rpdj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtcm93IGdhcC0yIiAqbmdJZj0ibWFjaGluZVR5cGUgPT09IFwnVHJ1Y2tcJyI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9ImZsZXgtMSIgYXBwZWFyYW5jZT0ib3V0bGluZSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxtYXQtbGFiZWw+V2FybmluZyB3ZWlnaHQgbGltaXQ8L21hdC1sYWJlbD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPGlucHV0IG1hdElucHV0IHR5cGU9Im51bWJlciIgZm9ybUNvbnRyb2xOYW1lPSJ3YXJuaW5nVGhyZXNob2xkIiByZXF1aXJlZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPHNwYW4gc3R5bGU9Im1hcmdpbi1yaWdodDogOHB4IiBtYXRTdWZmaXg+e3t3ZWlnaHRVbml0U3ltYm9sfX08L3NwYW4+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxtYXQtZXJyb3IgKm5nSWY9ImVkaXRNYWNoaW5lRm9ybUdyb3VwLmdldChcJ3dhcm5pbmdUaHJlc2hvbGRcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgUmVxdWlyZWQuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDwvbWF0LWVycm9yPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0iZmxleC0xIiBhcHBlYXJhbmNlPSJvdXRsaW5lIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPG1hdC1sYWJlbD5Dcml0aWNhbCB3ZWlnaHQgbGltaXQ8L21hdC1sYWJlbD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPGlucHV0IG1hdElucHV0IHR5cGU9Im51bWJlciIgZm9ybUNvbnRyb2xOYW1lPSJjcml0aWNhbFRocmVzaG9sZCIgcmVxdWlyZWQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIDxzcGFuIHN0eWxlPSJtYXJnaW4tcmlnaHQ6IDhweCIgbWF0U3VmZml4Pnt7d2VpZ2h0VW5pdFN5bWJvbH19PC9zcGFuPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICA8bWF0LWVycm9yICpuZ0lmPSJlZGl0TWFjaGluZUZvcm1Hcm91cC5nZXQoXCdjcml0aWNhbFRocmVzaG9sZFwnKS5oYXNFcnJvcihcJ3JlcXVpcmVkXCcpIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICBSZXF1aXJlZC5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgPC9tYXQtZXJyb3I+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8L21hdC1mb3JtLWZpZWxkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8L2Rpdj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPGRpdiBtYXQtZGlhbG9nLWFjdGlvbnMgY2xhc3M9ImZsZXggZmxleC1yb3cgaXRlbXMtY2VudGVyIGp1c3RpZnktZW5kIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICB0eXBlPSJidXR0b24iXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICBbZGlzYWJsZWRdPSIoaXNMb2FkaW5nJCB8IGFzeW5jKSJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIChjbGljayk9ImNhbmNlbCgpIiBjZGtGb2N1c0luaXRpYWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICBDYW5jZWxcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2J1dHRvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICB0eXBlPSJzdWJtaXQiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICBbZGlzYWJsZWRdPSIoaXNMb2FkaW5nJCB8IGFzeW5jKSB8fCBlZGl0TWFjaGluZUZvcm1Hcm91cC5pbnZhbGlkIHx8ICFlZGl0TWFjaGluZUZvcm1Hcm91cC5kaXJ0eSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICBTYXZlXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPC9idXR0b24+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9mb3JtPic7CgogICAgICAgIGN1c3RvbURpYWxvZy5jdXN0b21EaWFsb2coZWRpdE1hY2hpbmVIdG1sVGVtcGxhdGUsIEVkaXRNYWNoaW5lRGlhbG9nQ29udHJvbGxlcikuc3Vic2NyaWJlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gRWRpdE1hY2hpbmVEaWFsb2dDb250cm9sbGVyKGluc3RhbmNlKSB7CiAgICAgICAgbGV0IHZtID0gaW5zdGFuY2U7CgogICAgICAgIGNvbnN0IHByZXNzdXJlVW5pdCA9IHsKICAgICAgICAgICAgZnJvbTogJ3BzaScsCiAgICAgICAgICAgIE1FVFJJQzogJ2JhcicsCiAgICAgICAgICAgIElNUEVSSUFMOiAncHNpJywKICAgICAgICAgICAgSFlCUklEOiAnYmFyJwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGxvYWRXZWlnaHRVbml0ID0gewogICAgICAgICAgICBmcm9tOiAnbGInLAogICAgICAgICAgICBNRVRSSUM6ICd0JywKICAgICAgICAgICAgSU1QRVJJQUw6ICdsYicsCiAgICAgICAgICAgIEhZQlJJRDogJ3QnCiAgICAgICAgfTsKCiAgICAgICAgdm0ucHJlc3N1cmVVbml0U3ltYm9sID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5nZXRUYXJnZXRVbml0U3ltYm9sKHByZXNzdXJlVW5pdCk7CiAgICAgICAgdm0ud2VpZ2h0VW5pdFN5bWJvbCA9IHdpZGdldENvbnRleHQudW5pdFNlcnZpY2UuZ2V0VGFyZ2V0VW5pdFN5bWJvbChsb2FkV2VpZ2h0VW5pdCk7CgogICAgICAgIHZtLmRldmljZSA9IG51bGw7CiAgICAgICAgdm0ubWFjaGluZVR5cGUgPSBudWxsOwoKICAgICAgICB2bS5lZGl0TWFjaGluZUZvcm1Hcm91cCA9IHZtLmZiLmdyb3VwKHsKICAgICAgICAgICAgbWFjaGluZU5hbWU6IFsnJywgW3ZtLnZhbGlkYXRvcnMucmVxdWlyZWRdXSwKICAgICAgICAgICAgd2FybmluZ1RocmVzaG9sZDogW251bGwsIFt2bS52YWxpZGF0b3JzLnJlcXVpcmVkXV0sCiAgICAgICAgICAgIGNyaXRpY2FsVGhyZXNob2xkOiBbbnVsbCwgW3ZtLnZhbGlkYXRvcnMucmVxdWlyZWRdXQogICAgICAgIH0pOwoKICAgICAgICBsb2FkTWFjaGluZSgpOwoKICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdm0uZGlhbG9nUmVmLmNsb3NlKG51bGwpOwogICAgICAgIH07CgogICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdm0uZWRpdE1hY2hpbmVGb3JtR3JvdXAubWFya0FzUHJpc3RpbmUoKTsKICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLmZvcmtKb2luKFsKICAgICAgICAgICAgICAgIHNhdmVNYWNoaW5lKCksCiAgICAgICAgICAgICAgICBzYXZlQXR0cmlidXRlcygpCiAgICAgICAgICAgIF0pLnN1YnNjcmliZSgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHdpZGdldENvbnRleHQudXBkYXRlQWxpYXNlcygpOwogICAgICAgICAgICAgICAgICAgIHZtLmRpYWxvZ1JlZi5jbG9zZShudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBsb2FkTWFjaGluZSgpIHsKICAgICAgICAgICAgZGV2aWNlU2VydmljZS5nZXREZXZpY2UoZW50aXR5SWQuaWQpLnN1YnNjcmliZSgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRldmljZSkgewogICAgICAgICAgICAgICAgICAgIHZtLmRldmljZSA9IGRldmljZTsKICAgICAgICAgICAgICAgICAgICB2bS5tYWNoaW5lVHlwZSA9IGRldmljZS50eXBlID09PSAnSGF1bCB0cnVjaycgPyAnVHJ1Y2snIDogJ0V4Y2F2YXRvcic7CgogICAgICAgICAgICAgICAgICAgIHZtLmVkaXRNYWNoaW5lRm9ybUdyb3VwLnBhdGNoVmFsdWUoewogICAgICAgICAgICAgICAgICAgICAgICBtYWNoaW5lTmFtZTogZGV2aWNlLm5hbWUKICAgICAgICAgICAgICAgICAgICB9LCB7IGVtaXRFdmVudDogZmFsc2UgfSk7CgogICAgICAgICAgICAgICAgICAgIC8vIExvYWQgYXR0cmlidXRlcyBiYXNlZCBvbiBtYWNoaW5lIHR5cGUKICAgICAgICAgICAgICAgICAgICBsb2FkQXR0cmlidXRlcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbG9hZEF0dHJpYnV0ZXMoKSB7CiAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVLZXlzID0gW107CiAgICAgICAgICAgIGlmICh2bS5tYWNoaW5lVHlwZSA9PT0gJ0V4Y2F2YXRvcicpIHsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUtleXMgPSBbJ2h5ZHJhdWxpY1ByZXNzdXJlV2FybmluZ1RocmVzaG9sZCcsICdoeWRyYXVsaWNQcmVzc3VyZUNyaXRpY2FsVGhyZXNob2xkJ107CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVLZXlzID0gWydsb2FkV2VpZ2h0V2FybmluZ1RocmVzaG9sZCcsICdsb2FkV2VpZ2h0Q3JpdGljYWxUaHJlc2hvbGQnXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXR0cmlidXRlU2VydmljZS5nZXRFbnRpdHlBdHRyaWJ1dGVzKGVudGl0eUlkLCAnU0VSVkVSX1NDT1BFJywgYXR0cmlidXRlS2V5cykuc3Vic2NyaWJlKAogICAgICAgICAgICAgICAgZnVuY3Rpb24oYXR0cmlidXRlcykgewogICAgICAgICAgICAgICAgICAgIGxldCB3YXJuaW5nVmFsdWUgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCBjcml0aWNhbFZhbHVlID0gMDsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHIgPSBhdHRyaWJ1dGVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5rZXkgPT09ICdoeWRyYXVsaWNQcmVzc3VyZVdhcm5pbmdUaHJlc2hvbGQnIHx8IGF0dHIua2V5ID09PSAnbG9hZFdlaWdodFdhcm5pbmdUaHJlc2hvbGQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nVmFsdWUgPSBhdHRyLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF0dHIua2V5ID09PSAnaHlkcmF1bGljUHJlc3N1cmVDcml0aWNhbFRocmVzaG9sZCcgfHwgYXR0ci5rZXkgPT09ICdsb2FkV2VpZ2h0Q3JpdGljYWxUaHJlc2hvbGQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcml0aWNhbFZhbHVlID0gYXR0ci52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLm1hY2hpbmVUeXBlID09PSAnRXhjYXZhdG9yJykgewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nVmFsdWUgPSB3aWRnZXRDb250ZXh0LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUod2FybmluZ1ZhbHVlLCBwcmVzc3VyZVVuaXQpOwogICAgICAgICAgICAgICAgICAgICAgICBjcml0aWNhbFZhbHVlID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5jb252ZXJ0VW5pdFZhbHVlKGNyaXRpY2FsVmFsdWUsIHByZXNzdXJlVW5pdCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ1ZhbHVlID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5jb252ZXJ0VW5pdFZhbHVlKHdhcm5pbmdWYWx1ZSwgbG9hZFdlaWdodFVuaXQpOwogICAgICAgICAgICAgICAgICAgICAgICBjcml0aWNhbFZhbHVlID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5jb252ZXJ0VW5pdFZhbHVlKGNyaXRpY2FsVmFsdWUsIGxvYWRXZWlnaHRVbml0KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZtLmVkaXRNYWNoaW5lRm9ybUdyb3VwLnBhdGNoVmFsdWUoewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nVGhyZXNob2xkOiBNYXRoLnJvdW5kKHdhcm5pbmdWYWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIGNyaXRpY2FsVGhyZXNob2xkOiBNYXRoLnJvdW5kKGNyaXRpY2FsVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgfSwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2F2ZU1hY2hpbmUoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvcm1WYWx1ZXMgPSB2bS5lZGl0TWFjaGluZUZvcm1Hcm91cC52YWx1ZTsKICAgICAgICAgICAgdm0uZGV2aWNlLm5hbWUgPSBmb3JtVmFsdWVzLm1hY2hpbmVOYW1lOwogICAgICAgICAgICByZXR1cm4gZGV2aWNlU2VydmljZS5zYXZlRGV2aWNlKHZtLmRldmljZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzYXZlQXR0cmlidXRlcygpIHsKICAgICAgICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHZtLmVkaXRNYWNoaW5lRm9ybUdyb3VwLnZhbHVlOwogICAgICAgICAgICBjb25zdCB3YXJuaW5nVmFsdWUgPSBmb3JtVmFsdWVzLndhcm5pbmdUaHJlc2hvbGQ7CiAgICAgICAgICAgIGNvbnN0IGNyaXRpY2FsVmFsdWUgPSBmb3JtVmFsdWVzLmNyaXRpY2FsVGhyZXNob2xkOwoKICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXNBcnJheSA9IFtdOwoKICAgICAgICAgICAgaWYgKHZtLm1hY2hpbmVUeXBlID09PSAnRXhjYXZhdG9yJykgewogICAgICAgICAgICAgICAgY29uc3QgcHJlc3N1cmVUb1N0b3JhZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgZnJvbTogdm0ucHJlc3N1cmVVbml0U3ltYm9sLAogICAgICAgICAgICAgICAgICAgIE1FVFJJQzogJ3BzaScsCiAgICAgICAgICAgICAgICAgICAgSU1QRVJJQUw6ICdwc2knLAogICAgICAgICAgICAgICAgICAgIEhZQlJJRDogJ3BzaScKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjb25zdCB3YXJuaW5nSW5Qc2kgPSB3aWRnZXRDb250ZXh0LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUod2FybmluZ1ZhbHVlLCBwcmVzc3VyZVRvU3RvcmFnZSk7CiAgICAgICAgICAgICAgICBjb25zdCBjcml0aWNhbEluUHNpID0gd2lkZ2V0Q29udGV4dC51bml0U2VydmljZS5jb252ZXJ0VW5pdFZhbHVlKGNyaXRpY2FsVmFsdWUsIHByZXNzdXJlVG9TdG9yYWdlKTsKCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzQXJyYXkucHVzaCh7IGtleTogJ2h5ZHJhdWxpY1ByZXNzdXJlV2FybmluZ1RocmVzaG9sZCcsIHZhbHVlOiB3YXJuaW5nSW5Qc2kgfSk7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzQXJyYXkucHVzaCh7IGtleTogJ2h5ZHJhdWxpY1ByZXNzdXJlQ3JpdGljYWxUaHJlc2hvbGQnLCB2YWx1ZTogY3JpdGljYWxJblBzaSB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdlaWdodFRvU3RvcmFnZSA9IHsKICAgICAgICAgICAgICAgICAgICBmcm9tOiB2bS53ZWlnaHRVbml0U3ltYm9sLAogICAgICAgICAgICAgICAgICAgIE1FVFJJQzogJ2xiJywKICAgICAgICAgICAgICAgICAgICBJTVBFUklBTDogJ2xiJywKICAgICAgICAgICAgICAgICAgICBIWUJSSUQ6ICdsYicKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjb25zdCB3YXJuaW5nSW5MYiA9IHdpZGdldENvbnRleHQudW5pdFNlcnZpY2UuY29udmVydFVuaXRWYWx1ZSh3YXJuaW5nVmFsdWUsIHdlaWdodFRvU3RvcmFnZSk7CiAgICAgICAgICAgICAgICBjb25zdCBjcml0aWNhbEluTGIgPSB3aWRnZXRDb250ZXh0LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUoY3JpdGljYWxWYWx1ZSwgd2VpZ2h0VG9TdG9yYWdlKTsKCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzQXJyYXkucHVzaCh7IGtleTogJ2xvYWRXZWlnaHRXYXJuaW5nVGhyZXNob2xkJywgdmFsdWU6IHdhcm5pbmdJbkxiIH0pOwogICAgICAgICAgICAgICAgYXR0cmlidXRlc0FycmF5LnB1c2goeyBrZXk6ICdsb2FkV2VpZ2h0Q3JpdGljYWxUaHJlc2hvbGQnLCB2YWx1ZTogY3JpdGljYWxJbkxiIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlU2VydmljZS5zYXZlRW50aXR5QXR0cmlidXRlcyhlbnRpdHlJZCwgJ1NFUlZFUl9TQ09QRScsIGF0dHJpYnV0ZXNBcnJheSk7CiAgICAgICAgfQogICAgfQp9CgpleHBvcnQgZnVuY3Rpb24gZWRpdFpvbmVOYW1lKHdpZGdldENvbnRleHQsIGVudGl0eUlkLCBlbnRpdHlOYW1lKSB7CiAgICBsZXQgJGluamVjdG9yID0gd2lkZ2V0Q29udGV4dC4kc2NvcGUuJGluamVjdG9yOwogICAgbGV0IGN1c3RvbURpYWxvZyA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2N1c3RvbURpYWxvZycpKTsKICAgIGxldCBhc3NldFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdhc3NldFNlcnZpY2UnKSk7CgogICAgb3BlbkVkaXRab25lRGlhbG9nKCk7CgogICAgZnVuY3Rpb24gb3BlbkVkaXRab25lRGlhbG9nKCkgewoKICAgICAgICBjb25zdCBlZGl0Wm9uZUh0bWxUZW1wbGF0ZSA9ICc8Zm9ybSAjZWRpdEVudGl0eUZvcm09Im5nRm9ybSIgW2Zvcm1Hcm91cF09ImVkaXRab25lRm9ybUdyb3VwIlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgKG5nU3VibWl0KT0ic2F2ZSgpIiBjbGFzcz0iZWRpdC1lbnRpdHktZm9ybSIgc3R5bGU9IndpZHRoOiAzNjBweDsiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8bWF0LXRvb2xiYXIgY2xhc3M9ImZsZXggZmxleC1yb3ciIGNvbG9yPSJwcmltYXJ5Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8aDI+RWRpdCB6b25lIG5hbWU8L2gyPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxzcGFuIGNsYXNzPSJmbGV4LTEiPjwvc3Bhbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1pY29uLWJ1dHRvbiAoY2xpY2spPSJjYW5jZWwoKSIgdHlwZT0iYnV0dG9uIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxtYXQtaWNvbiBjbGFzcz0ibWF0ZXJpYWwtaWNvbnMiPmNsb3NlPC9tYXQtaWNvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2J1dHRvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9tYXQtdG9vbGJhcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPG1hdC1wcm9ncmVzcy1iYXIgY29sb3I9Indhcm4iIG1vZGU9ImluZGV0ZXJtaW5hdGUiICpuZ0lmPSJpc0xvYWRpbmckIHwgYXN5bmMiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8L21hdC1wcm9ncmVzcy1iYXI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgc3R5bGU9ImhlaWdodDogNHB4OyIgKm5nSWY9IiEoaXNMb2FkaW5nJCB8IGFzeW5jKSI+PC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgbWF0LWRpYWxvZy1jb250ZW50IGNsYXNzPSJmbGV4IGZsZXgtY29sIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9Im1hdC1ibG9jayIgYXBwZWFyYW5jZT0ib3V0bGluZSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWxhYmVsPlpvbmUgbmFtZTwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPGlucHV0IG1hdElucHV0IGZvcm1Db250cm9sTmFtZT0iem9uZU5hbWUiIHJlcXVpcmVkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgPG1hdC1lcnJvciAqbmdJZj0iZWRpdFpvbmVGb3JtR3JvdXAuZ2V0KFwnem9uZU5hbWVcJykuaGFzRXJyb3IoXCdyZXF1aXJlZFwnKSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgIFpvbmUgbmFtZSBpcyByZXF1aXJlZC5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDwvbWF0LWVycm9yPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvZGl2PlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8ZGl2IG1hdC1kaWFsb2ctYWN0aW9ucyBjbGFzcz0iZmxleCBmbGV4LXJvdyBpdGVtcy1jZW50ZXIganVzdGlmeS1lbmQiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxidXR0b24gbWF0LWJ1dHRvbiBjb2xvcj0icHJpbWFyeSJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIHR5cGU9ImJ1dHRvbiJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIFtkaXNhYmxlZF09Iihpc0xvYWRpbmckIHwgYXN5bmMpIlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgKGNsaWNrKT0iY2FuY2VsKCkiIGNka0ZvY3VzSW5pdGlhbD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIENhbmNlbFxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvYnV0dG9uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxidXR0b24gbWF0LWJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj0icHJpbWFyeSJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIHR5cGU9InN1Ym1pdCJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIFtkaXNhYmxlZF09Iihpc0xvYWRpbmckIHwgYXN5bmMpIHx8IGVkaXRab25lRm9ybUdyb3VwLmludmFsaWQgfHwgIWVkaXRab25lRm9ybUdyb3VwLmRpcnR5Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIFNhdmVcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L2J1dHRvbj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Zvcm0+JzsKCiAgICAgICAgY3VzdG9tRGlhbG9nLmN1c3RvbURpYWxvZyhlZGl0Wm9uZUh0bWxUZW1wbGF0ZSwgRWRpdFpvbmVEaWFsb2dDb250cm9sbGVyKS5zdWJzY3JpYmUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBFZGl0Wm9uZURpYWxvZ0NvbnRyb2xsZXIoaW5zdGFuY2UpIHsKICAgICAgICBsZXQgdm0gPSBpbnN0YW5jZTsKCiAgICAgICAgdm0uem9uZSA9IG51bGw7CgogICAgICAgIHZtLmVkaXRab25lRm9ybUdyb3VwID0gdm0uZmIuZ3JvdXAoewogICAgICAgICAgICB6b25lTmFtZTogWycnLCBbdm0udmFsaWRhdG9ycy5yZXF1aXJlZF1dCiAgICAgICAgfSk7CgogICAgICAgIGxvYWRab25lKCk7CgogICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2bS5kaWFsb2dSZWYuY2xvc2UobnVsbCk7CiAgICAgICAgfTsKCiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2bS5lZGl0Wm9uZUZvcm1Hcm91cC5tYXJrQXNQcmlzdGluZSgpOwogICAgICAgICAgICBzYXZlWm9uZSgpLnN1YnNjcmliZSgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHdpZGdldENvbnRleHQudXBkYXRlQWxpYXNlcygpOwogICAgICAgICAgICAgICAgICAgIHZtLmRpYWxvZ1JlZi5jbG9zZShudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBsb2FkWm9uZSgpIHsKICAgICAgICAgICAgYXNzZXRTZXJ2aWNlLmdldEFzc2V0KGVudGl0eUlkLmlkKS5zdWJzY3JpYmUoCiAgICAgICAgICAgICAgICBmdW5jdGlvbihhc3NldCkgewogICAgICAgICAgICAgICAgICAgIHZtLnpvbmUgPSBhc3NldDsKICAgICAgICAgICAgICAgICAgICB2bS5lZGl0Wm9uZUZvcm1Hcm91cC5wYXRjaFZhbHVlKHsKICAgICAgICAgICAgICAgICAgICAgICAgem9uZU5hbWU6IHZtLnpvbmUubmFtZQogICAgICAgICAgICAgICAgICAgIH0sIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNhdmVab25lKCkgewogICAgICAgICAgICBjb25zdCBmb3JtVmFsdWVzID0gdm0uZWRpdFpvbmVGb3JtR3JvdXAudmFsdWU7CiAgICAgICAgICAgIHZtLnpvbmUubmFtZSA9IGZvcm1WYWx1ZXMuem9uZU5hbWU7CiAgICAgICAgICAgIHJldHVybiBhc3NldFNlcnZpY2Uuc2F2ZUFzc2V0KHZtLnpvbmUpOwogICAgICAgIH0KICAgIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGdlb1N0YXR1c1RvQ29sb3IodmFsdWUpIHsKICAgIGxldCBjb2xvciA9ICcjZjE2MzYyJzsKICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICh2YWx1ZSA9PT0gImluc2lkZVJlc3RyaWN0ZWRab25lIikgewogICAgICAgICAgICBjb2xvciA9ICcjREQyQzAwOyM2RjE2MDAnOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPT09ICJpbnNpZGVVbmxvYWRpbmdab25lIikgewogICAgICAgICAgICBjb2xvciA9ICcjMUVCQjREOyMwRjVFMjcnOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPT09ICJpbnNpZGVMb2FkaW5nWm9uZSIpIHsKICAgICAgICAgICAgY29sb3IgPSAnIzMzODhGRjsjMUE0NDgwJzsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09PSAib3V0c2lkZU1pbmVTaXRlIikgewogICAgICAgICAgICBjb2xvciA9ICcjNkQ2RDZEOyMzNzM3MzcnOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPT09ICJpbnNpZGVNaW5lU2l0ZSIpIHsKICAgICAgICAgICAgY29sb3IgPSAnI0E2QkRCMDsjNDM0ZDQ3JwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZXhwb3J0IGZ1bmN0aW9uIGdlb1N0YXR1c1RvU3RhdHVzKHZhbHVlKSB7CiAgICBsZXQgc3RhdHVzID0gJ09mZiBzaXRlJzsKICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICh2YWx1ZSA9PT0gImluc2lkZVJlc3RyaWN0ZWRab25lIikgewogICAgICAgICAgICBzdGF0dXMgPSAnUmVzdHJpY3RlZCc7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSA9PT0gImluc2lkZVVubG9hZGluZ1pvbmUiKSB7CiAgICAgICAgICAgIHN0YXR1cyA9ICdVbmxvYWRpbmcnOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPT09ICJpbnNpZGVMb2FkaW5nWm9uZSIpIHsKICAgICAgICAgICAgc3RhdHVzID0gJ0xvYWRpbmcnOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPT09ICJvdXRzaWRlTWluZVNpdGUiKSB7CiAgICAgICAgICAgIHN0YXR1cyA9ICdPZmYgc2l0ZSc7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSA9PT0gImluc2lkZU1pbmVTaXRlIikgewogICAgICAgICAgICBzdGF0dXMgPSAnT24gc2l0ZScKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RhdHVzOwp9CgpleHBvcnQgZnVuY3Rpb24gem9uZVR5cGVUb0NvbG9yKHZhbHVlKSB7CiAgICBsZXQgY29sb3IgPSAnI2YxNjM2Mic7CiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodmFsdWUgPT09ICJSZXN0cmljdGVkIikgewogICAgICAgICAgICBjb2xvciA9ICcjREQyQzAwJzsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09PSAiVW5sb2FkaW5nIikgewogICAgICAgICAgICBjb2xvciA9ICcjMUVCQjREJzsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09PSAiTG9hZGluZyIpIHsKICAgICAgICAgICAgY29sb3IgPSAnIzMzODhGRic7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGNvbG9yOwp9CgpleHBvcnQgZnVuY3Rpb24gbWFya2VyTGFiZWwoZGF0YSkgewogICAgbGV0IHRleHRDb2xvciA9IGRhdGEuZ2VvU3RhdHVzQ29sb3Iuc3BsaXQoJzsnKVsxXTsKICAgIHJldHVybiBgPGRpdiBzdHlsZT0icG9zaXRpb246IHJlbGF0aXZlOyB3aGl0ZS1zcGFjZTogbm93cmFwOyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJib3JkZXI6IDFweCBzb2xpZCAke3RleHRDb2xvcn07IGJvcmRlci1yYWRpdXM6IDhweDsgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjtwYWRkaW5nOiA4cHg7Ij4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOiAxNHB4O2ZvbnQtd2VpZ2h0OiA1MDA7bGluZS1oZWlnaHQ6IDIwcHg7Y29sb3I6ICR7dGV4dENvbG9yfSI+ICR7ZGF0YS5lbnRpdHlOYW1lfTwvc3Bhbj48YnIgLz4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOiAxMnB4O2ZvbnQtd2VpZ2h0OiA0MDA7bGluZS1oZWlnaHQ6IDE2cHg7Y29sb3I6ICR7dGV4dENvbG9yfSI+RnVlbCBsZXZlbDogJHtkYXRhLmZ1ZWxMZXZlbH0lPC9zcGFuPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0TWFjaGluZVRvb2x0aXAoY3R4LCBkYXRhLCBub0FjdGlvbikgewogICAgY29uc3Qgc3BlZWRVbml0ID0gewogICAgICAgIGZyb206ICdtcGgnLAogICAgICAgIE1FVFJJQzogJ2ttL2gnLAogICAgICAgIElNUEVSSUFMOiAnbXBoJywKICAgICAgICBIWUJSSUQ6ICdrbS9oJwogICAgfTsKICAgIGNvbnN0IHVzclNwZWVkVW5pdCA9IGN0eC51bml0U2VydmljZS5nZXRUYXJnZXRVbml0U3ltYm9sKHNwZWVkVW5pdCk7CiAgICBjb25zdCBzcGVlZFZhbHVlID0gY3R4LnVuaXRTZXJ2aWNlLmNvbnZlcnRVbml0VmFsdWUoZGF0YT8uc3BlZWQgfHwgMCwgdXNyU3BlZWRVbml0KS50b0ZpeGVkKDEpOwoKICAgIGNvbnN0IG1hY2hpbmVUeXBlID0gZGF0YT8uZGV2aWNlVHlwZSB8fCBkYXRhPy50eXBlOwogICAgY29uc3QgaXNUcnVjayA9IG1hY2hpbmVUeXBlID09PSAnSGF1bCB0cnVjayc7CgogICAgbGV0IG1hY2hpbmVTcGVjaWZpY0NvbnRlbnQgPSAnJzsKCiAgICBpZiAoaXNUcnVjaykgewogICAgICAgIGNvbnN0IGxvYWRXZWlnaHRVbml0ID0gewogICAgICAgICAgICBmcm9tOiAnbGInLAogICAgICAgICAgICBNRVRSSUM6ICd0JywKICAgICAgICAgICAgSU1QRVJJQUw6ICdsYicsCiAgICAgICAgICAgIEhZQlJJRDogJ3QnCiAgICAgICAgfTsKICAgICAgICBjb25zdCB1c3JMb2FkV2VpZ2h0VW5pdCA9IGN0eC51bml0U2VydmljZS5nZXRUYXJnZXRVbml0U3ltYm9sKGxvYWRXZWlnaHRVbml0KTsKICAgICAgICBjb25zdCBsb2FkV2VpZ2h0VmFsdWUgPSBjdHgudW5pdFNlcnZpY2UuY29udmVydFVuaXRWYWx1ZShkYXRhPy5sb2FkV2VpZ2h0IHx8IDAsIGxvYWRXZWlnaHRVbml0KS50b0ZpeGVkKDEpOwoKICAgICAgICBtYWNoaW5lU3BlY2lmaWNDb250ZW50ID0gYAogICAgICAgIDxkaXY+CiAgICAgICAgICAgIDxiIHN0eWxlPSJmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzMzMzsiPkxvYWQgd2VpZ2h0OjwvYj4gJHtsb2FkV2VpZ2h0VmFsdWV9ICR7dXNyTG9hZFdlaWdodFVuaXR9CiAgICAgICAgPC9kaXY+YDsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgcHJlc3N1cmVVbml0ID0gewogICAgICAgICAgICBmcm9tOiAncHNpJywKICAgICAgICAgICAgTUVUUklDOiAnYmFyJywKICAgICAgICAgICAgSU1QRVJJQUw6ICdwc2knLAogICAgICAgICAgICBIWUJSSUQ6ICdiYXInCiAgICAgICAgfTsKICAgICAgICBjb25zdCB1c3JQcmVzc3VyZVVuaXQgPSBjdHgudW5pdFNlcnZpY2UuZ2V0VGFyZ2V0VW5pdFN5bWJvbChwcmVzc3VyZVVuaXQpOwogICAgICAgIGNvbnN0IHByZXNzdXJlVmFsdWUgPSBjdHgudW5pdFNlcnZpY2UuY29udmVydFVuaXRWYWx1ZShkYXRhPy5oeWRyYXVsaWNQcmVzc3VyZSB8fCAwLCBwcmVzc3VyZVVuaXQpLnRvRml4ZWQoMSk7CgogICAgICAgIG1hY2hpbmVTcGVjaWZpY0NvbnRlbnQgPSBgCiAgICAgICAgPGRpdj4KICAgICAgICAgICAgPGIgc3R5bGU9ImZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMzMzOyI+SHlkcmF1bGljIHByZXNzdXJlOjwvYj4gJHtwcmVzc3VyZVZhbHVlfSAke3VzclByZXNzdXJlVW5pdH0KICAgICAgICA8L2Rpdj5gOwogICAgfQoKICAgIHJldHVybiBgCiAgICA8ZGl2IHN0eWxlPSIKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIG1hcmdpbi1ib3R0b206IDE2cHg7CiAgICAiPgogICAgICAgIDxzcGFuIHN0eWxlPSIKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgICAiPiR7ZGF0YT8uZW50aXR5TmFtZSB8fCAnJ308L3NwYW4+CiAgICA8L2Rpdj4KICAgIDxkaXYgc3R5bGU9IgogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICBsaW5lLWhlaWdodDogMS44OwogICAgICAgIGNvbG9yOiAjNTU1OwogICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHgKICAgICI+CiAgICAgICAgPGRpdj4KICAgICAgICAgICAgPGIgc3R5bGU9ImZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMzMzOyI+TGF0aXR1ZGU6PC9iPiAke2RhdGE/LmxhdGl0dWRlLnRvRml4ZWQoNCkgfHwgJyd9CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdj4KICAgICAgICAgICAgPGIgc3R5bGU9ImZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMzMzOyI+TG9uZ2l0dWRlOjwvYj4gJHtkYXRhPy5sb25naXR1ZGUudG9GaXhlZCg0KSB8fCAnJ30KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgICA8YiBzdHlsZT0iZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICMzMzM7Ij5GdWVsIGxldmVsOjwvYj4gJHtkYXRhPy5mdWVsTGV2ZWwgfHwgMH0gJQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXY+CiAgICAgICAgICAgIDxiIHN0eWxlPSJmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzMzMzsiPlNwZWVkOjwvYj4gJHtzcGVlZFZhbHVlfSAke3VzclNwZWVkVW5pdH0KICAgICAgICA8L2Rpdj4KICAgICAgICAke21hY2hpbmVTcGVjaWZpY0NvbnRlbnR9CiAgICA8L2Rpdj4KICAgICR7bm9BY3Rpb24gPyAnJyA6ICI8YnV0dG9uLWFjdCBuYW1lPSdtYWNoaW5lLWRldGFpbHMnPlNlZSBkZXRhaWxzPC9idXR0b24tYWN0PiJ9CmA7Cn0=",
    "descriptor" : null,
    "etag" : "16b877dff43184ab93c19aa807ecd4a2babd895f2e7d1137ad8dac94478df106",
    "externalId" : null,
    "fileName" : "Mine site monitoring solution JS utils.js",
    "id" : {
      "entityType" : "TB_RESOURCE",
      "id" : "b225be30-128e-11f1-8fce-55f815a3848a"
    },
    "link" : "/api/resource/js_module/tenant/Mine site monitoring solution JS utils.js",
    "name" : "Mine site monitoring solution JS utils",
    "preview" : null,
    "public" : false,
    "publicLink" : null,
    "publicResourceKey" : null,
    "resourceKey" : "Mine site monitoring solution JS utils.js",
    "resourceSubType" : "MODULE",
    "resourceType" : "JS_MODULE",
    "title" : "Mine site monitoring solution JS utils"
  }
}