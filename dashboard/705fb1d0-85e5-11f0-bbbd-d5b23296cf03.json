{
  "entityType" : "DASHBOARD",
  "entity" : {
    "title" : "Widget Test",
    "image" : null,
    "mobileHide" : false,
    "mobileOrder" : null,
    "configuration" : {
      "description" : "",
      "widgets" : {
        "e3fea6ac-e577-b3b9-7352-996ccd634cf5" : {
          "typeFullFqn" : "system.cards.entities_table",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 6.5,
          "config" : {
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 86400000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1756501908241,
                  "endTimeMs" : 1756588308241
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "NONE",
                "limit" : 200
              }
            },
            "showTitle" : true,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "4px",
            "settings" : {
              "entitiesTitle" : "Entities",
              "enableSearch" : true,
              "enableSelectColumnDisplay" : true,
              "enableStickyHeader" : true,
              "enableStickyAction" : true,
              "showCellActionsMenu" : true,
              "reserveSpaceForHiddenAction" : "true",
              "displayEntityName" : false,
              "entityNameColumnTitle" : "",
              "displayEntityLabel" : false,
              "entityLabelColumnTitle" : "",
              "displayEntityType" : false,
              "displayPagination" : false,
              "defaultPageSize" : 10,
              "pageStepCount" : 3,
              "pageStepIncrement" : 10,
              "defaultSortOrder" : "name",
              "useRowStyleFunction" : false,
              "rowStyleFunction" : ""
            },
            "title" : "Entities table",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400,
              "padding" : "5px 10px 5px 10px"
            },
            "useDashboardTimewindow" : false,
            "showLegend" : false,
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "b2917daf-99e3-6211-135d-47e39b87d5cc",
              "filterId" : null,
              "dataKeys" : [ {
                "name" : "firstName",
                "type" : "entityField",
                "label" : "Nombre",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.5465553049193347
              }, {
                "name" : "lastName",
                "type" : "entityField",
                "label" : "Apellido",
                "color" : "#f44336",
                "settings" : { },
                "_hash" : 0.7534752139672583,
                "decimals" : 0,
                "aggregationType" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              }, {
                "name" : "email",
                "type" : "entityField",
                "label" : "Correo electrónico",
                "color" : "#4caf50",
                "settings" : { },
                "_hash" : 0.37362506214047775,
                "decimals" : 0
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "displayTimewindow" : false,
            "configMode" : "advanced",
            "actions" : {
              "actionCellButton" : [ {
                "name" : "Editar",
                "icon" : "edit",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "customPretty",
                "customHtml" : "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"\n      (ngSubmit)=\"save()\" class=\"edit-entity-form\">\n    <mat-toolbar color=\"primary\">\n        <h2>Edit sensor {{entityName}}</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n    <div mat-dialog-content fxLayout=\"column\">\n        <mat-form-field fxFlex class=\"mat-block\">\n            <mat-label>Sensor name</mat-label>\n            <input matInput formControlName=\"entityName\" readonly>\n        </mat-form-field>\n        <div formGroupName=\"attributes\" fxLayout=\"column\">\n            <mat-slide-toggle formControlName=\"temperatureAlarmFlag\">\n                High temperature alarm\n            </mat-slide-toggle>\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>High temperature threshold, °C</mat-label>\n                <input type=\"number\" step=\"any\" matInput\n                        [required] = \"editEntityFormGroup.get('attributes').get('temperatureAlarmFlag').value\"\n                        formControlName=\"temperatureAlarmThreshold\">\n                <mat-error *ngIf=\"editEntityFormGroup.get('attributes').get('temperatureAlarmThreshold').hasError('required')\">\n                    High temperature threshold is required.\n                </mat-error>\n            </mat-form-field>\n\n            <mat-slide-toggle formControlName=\"humidityAlarmFlag\">\n                Low humidity alarm\n            </mat-slide-toggle>\n\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Low humidity threshold, %</mat-label>\n                <input type=\"number\" step=\"any\" matInput\n                       [required] = \"editEntityFormGroup.get('attributes').get('humidityAlarmFlag').value\"\n                       formControlName=\"humidityAlarmThreshold\">\n                <mat-error *ngIf=\"editEntityFormGroup.get('attributes').get('humidityAlarmThreshold').hasError('required')\">\n                    Low humidity threshold is required.\n                </mat-error>\n            </mat-form-field>\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Latitude</mat-label>\n                <input type=\"number\" step=\"0.1\" matInput\n                       formControlName=\"latitude\">\n            </mat-form-field>\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Longitude</mat-label>\n                <input type=\"number\" step=\"0.1\" matInput\n                       formControlName=\"longitude\">\n            </mat-form-field>\n        </div>\n    </div>\n    <div mat-dialog-actions fxLayoutAlign=\"end center\">\n        <button mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-raised-button color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">\n            Save\n        </button>\n    </div>\n</form>",
                "customCss" : "\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction" : "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenEditEntityDialog();\n\nfunction openEditEntityDialog() {\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n}\n\nfunction EditEntityDialogController(instance) {\n    let vm = instance;\n    \n    vm.entityId = entityId;\n    vm.entityName = entityName;\n    vm.attributes = {};\n    \n    vm.editEntityFormGroup = vm.fb.group({\n        entityName: [''],\n        attributes: vm.fb.group({\n            temperatureAlarmFlag: [false],\n            temperatureAlarmThreshold: [{value: null, disabled: true}],\n            humidityAlarmFlag: [false],\n            humidityAlarmThreshold: [{value: null, disabled: true}],\n            latitude: [null],\n            longitude: [null]\n        })\n    });\n    \n    vm.editEntityFormGroup.get('attributes').get('temperatureAlarmFlag').valueChanges\n    .subscribe(activate => {\n        if (activate) {\n            vm.editEntityFormGroup.get('attributes').get('temperatureAlarmThreshold').enable();\n        } else {\n            vm.editEntityFormGroup.get('attributes').get('temperatureAlarmThreshold').disable();\n        }\n    });\n    \n    vm.editEntityFormGroup.get('attributes').get('humidityAlarmFlag').valueChanges\n    .subscribe(activate => {\n        if (activate) {\n            vm.editEntityFormGroup.get('attributes').get('humidityAlarmThreshold').enable();\n        } else {\n            vm.editEntityFormGroup.get('attributes').get('humidityAlarmThreshold').disable();\n        }\n    });\n    \n    \n    getEntityInfo();\n    \n    \n    vm.save = function() {\n        vm.editEntityFormGroup.markAsPristine();\n        saveAttributes(entityId).subscribe(\n            function () {\n                vm.dialogRef.close(null);\n            }\n        );\n    };\n    \n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n    \n    function getEntityAttributes(attributes) {\n        for (var i = 0; i < attributes.length; i++) {\n            vm.attributes[attributes[i].key] = attributes[i].value;\n        }\n    }\n    \n    function getEntityInfo() {\n        attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE').subscribe(\n            function (attributes) {\n                getEntityAttributes(attributes);\n                vm.editEntityFormGroup.patchValue({\n                    entityName: vm.entityName,\n                    attributes: vm.attributes\n                });\n                // if(vm.attributes.temperatureAlarmFlag) {\n                //     vm.editEntityFormGroup.get('attributes').get('temperatureAlarmThreshold').enable();\n                // }\n                // if(vm.attributes.humidityAlarmFlag) {\n                //     vm.editEntityFormGroup.get('attributes').get('humidityAlarmThreshold').enable();\n                // }\n            }\n        );\n    }\n    \n    function saveAttributes(entityId) {\n        let attributes = vm.editEntityFormGroup.get('attributes').value;\n        let attributesArray = [];\n        for (let key in attributes) {\n            if (attributes[key] !== vm.attributes[key]) {\n                attributesArray.push({key: key, value: attributes[key]});\n            }\n        }\n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n        } else {\n            return widgetContext.rxjs.of([]);\n        }\n    }\n}",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "fa49f9e2-5673-31df-3d43-6359c3bd47ea"
              } ]
            },
            "showTitleIcon" : false,
            "titleIcon" : "list",
            "iconColor" : null,
            "titleFont" : null,
            "titleColor" : null
          },
          "row" : 0,
          "col" : 0,
          "id" : "e3fea6ac-e577-b3b9-7352-996ccd634cf5"
        },
        "eacd4f17-e502-99ac-f9fc-930c1f29eeca" : {
          "typeFullFqn" : "system.cards.markdown_card",
          "type" : "latest",
          "sizeX" : 5,
          "sizeY" : 3.5,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "entityAliasId" : "2209fa3c-bd68-8dad-c129-aa2cd2a75d20",
              "dataKeys" : [ {
                "name" : "title",
                "type" : "entityField",
                "label" : "Title",
                "color" : "#ffab00",
                "settings" : { },
                "_hash" : 0.6665256109779127
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            }, {
              "type" : "entity",
              "entityAliasId" : "d61165fd-70e9-f3b7-c538-c902295ef146",
              "dataKeys" : [ {
                "name" : "name",
                "type" : "entityField",
                "label" : "Name",
                "color" : "#9c27b0",
                "settings" : { },
                "_hash" : 0.6317429825219516
              }, {
                "name" : "sortDevicesStatus",
                "type" : "attribute",
                "label" : "sortDevicesStatus",
                "color" : "#8bc34a",
                "settings" : { },
                "_hash" : 0.21906924667222505
              }, {
                "name" : "showDescription",
                "type" : "attribute",
                "label" : "showDescription",
                "color" : "#673ab7",
                "settings" : { },
                "_hash" : 0.1424098524221502
              }, {
                "name" : "showLegend",
                "type" : "attribute",
                "label" : "showLegend",
                "color" : "#2962ff",
                "settings" : { },
                "_hash" : 0.14071779349238422,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : true,
                "postFuncBody" : "if(!value) return true\n\nreturn value;"
              }, {
                "name" : "showFilters",
                "type" : "attribute",
                "label" : "showFilters",
                "color" : "#00c853",
                "settings" : { },
                "_hash" : 0.6674789033737676
              }, {
                "name" : "filterByAssetStatus",
                "type" : "attribute",
                "label" : "filterByAssetStatus",
                "color" : "#d50000",
                "settings" : { },
                "_hash" : 0.3734921497700181
              }, {
                "name" : "filterAboveOrBelowPressureOption",
                "type" : "attribute",
                "label" : "filterAboveOrBelowPressureOption",
                "color" : "#455a64",
                "settings" : { },
                "_hash" : 0.5051156305584215
              }, {
                "name" : "filterAboveOrBelowPressureValue",
                "type" : "attribute",
                "label" : "filterAboveOrBelowPressureValue",
                "color" : "#aa00ff",
                "settings" : { },
                "_hash" : 0.39046403339511837
              }, {
                "name" : "searchSensor",
                "type" : "attribute",
                "label" : "searchSensor",
                "color" : "#64dd17",
                "settings" : { },
                "_hash" : 0.35022619253605525
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            }, {
              "type" : "entity",
              "name" : "",
              "deviceId" : "02664830-06f0-11ef-8643-a3e35f8fb749",
              "entityAliasId" : "65a9e3f5-693c-b0fa-72a6-37c2b49e610d",
              "filterId" : "3315a7b2-cdcd-aafa-2e3b-1756ce0c92b1",
              "dataKeys" : [ {
                "name" : "pressure",
                "type" : "timeseries",
                "label" : "pressure",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.24992544099924396
              }, {
                "name" : "unit_pressure",
                "type" : "attribute",
                "label" : "Unit",
                "color" : "#4caf50",
                "settings" : { },
                "_hash" : 0.6094497076144114,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              }, {
                "name" : "asset_status",
                "type" : "timeseries",
                "label" : "Asset Status",
                "color" : "#f44336",
                "settings" : { },
                "_hash" : 0.07819821076308076,
                "aggregationType" : "NONE",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              }, {
                "name" : "label",
                "type" : "attribute",
                "label" : "Label",
                "color" : "#ffc107",
                "settings" : { },
                "_hash" : 0.5514337237788833,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              }, {
                "name" : "lastActivityTime",
                "type" : "attribute",
                "label" : "lastActivityTime",
                "color" : "#607d8b",
                "settings" : { },
                "_hash" : 0.22681633820702984,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : true,
                "postFuncBody" : "var date = new Date(value);\r\n\r\nvar formattedDate = \"\";\r\nvar diffInMinutes = Math.floor((Date.now() - value) / (1000 * 60));\r\nvar diffInSeconds = Math.floor(((Date.now() - value) / (1000)) % 60);\r\n\r\nif (diffInMinutes < 1) {\r\n  formattedDate = \"Last Minute\";\r\n} else if (diffInMinutes < 60) {\r\n  formattedDate = diffInMinutes + \" minutes ago\";\r\n} else if (diffInMinutes < 1440) {\r\n  formattedDate = Math.floor(diffInMinutes / 60) + \" hours ago\";\r\n} else if (diffInMinutes < 43200) {\r\n  formattedDate = Math.floor(diffInMinutes / 1440) + \" days ago\";\r\n} else if (diffInMinutes < 525600) {\r\n  formattedDate = Math.floor(diffInMinutes / 43200) + \" months ago\";\r\n} else if (diffInMinutes < 1051200) { // 1 year (60 * 24 * 365)\r\n  formattedDate = Math.floor(diffInMinutes / 525600) + \" years ago\";\r\n} else {\r\n  formattedDate = date.getFullYear() + \"-\" + (date.getMonth() + 1) + \"-\" + date.getDate();\r\n}\r\n\r\nreturn formattedDate"
              }, {
                "name" : "battery",
                "type" : "timeseries",
                "label" : "battery",
                "color" : "#3f51b5",
                "settings" : { },
                "_hash" : 0.8204102085521499,
                "aggregationType" : "NONE",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : true,
                "postFuncBody" : "return ((value / 3.6) * 100).toFixed(0) ;"
              }, {
                "name" : "rssi",
                "type" : "timeseries",
                "label" : "rssi",
                "color" : "#e91e63",
                "settings" : { },
                "_hash" : 0.7720445298312639
              }, {
                "name" : "alarmsCountActive",
                "type" : "attribute",
                "label" : "activeAlarm",
                "color" : "#ffeb3b",
                "settings" : { },
                "_hash" : 0.8794105096318674,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : true,
                "postFuncBody" : "if(!value) return 0\n\nreturn value"
              }, {
                "name" : "active",
                "type" : "attribute",
                "label" : "active",
                "color" : "#ff9800",
                "settings" : { },
                "_hash" : 0.9830845690897634
              }, {
                "name" : "notes",
                "type" : "attribute",
                "label" : "notes",
                "color" : "#ff9800",
                "settings" : { },
                "_hash" : 0.7251347713689329
              }, {
                "name" : "pressure",
                "type" : "timeseries",
                "label" : "avgPressure",
                "color" : "#cddc39",
                "settings" : { },
                "_hash" : 0.6159697412940102,
                "aggregationType" : "AVG",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null,
                "comparisonEnabled" : null
              }, {
                "name" : "pressure",
                "type" : "timeseries",
                "label" : "maxPressure",
                "color" : "#009688",
                "settings" : { },
                "_hash" : 0.034140643614007704,
                "aggregationType" : "MAX",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null,
                "comparisonEnabled" : null
              }, {
                "name" : "pressure",
                "type" : "timeseries",
                "label" : "minPressure",
                "color" : "#00bcd4",
                "settings" : { },
                "_hash" : 0.37060468298209703,
                "aggregationType" : "MIN",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null,
                "comparisonEnabled" : null
              }, {
                "name" : "ts_difference_asset_on",
                "type" : "timeseries",
                "label" : "OnTime",
                "color" : "#795548",
                "settings" : { },
                "_hash" : 0.8596227693562524,
                "aggregationType" : "SUM",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : false,
                "postFuncBody" : null,
                "comparisonEnabled" : null
              }, {
                "name" : "enable_asset_status_confirmed",
                "type" : "attribute",
                "label" : "enable_asset_status_confirmed",
                "color" : "#ff5722",
                "settings" : { },
                "_hash" : 0.09095394558792691
              }, {
                "name" : "asset_status_confirmed",
                "type" : "attribute",
                "label" : "asset_status_confirmed",
                "color" : "#9e9e9e",
                "settings" : { },
                "_hash" : 0.24053069434825902,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : true,
                "postFuncBody" : "if(value=='true' || value==true) return true\n\nreturn false"
              }, {
                "name" : "devEUI",
                "type" : "attribute",
                "label" : "devEUI",
                "color" : "#304ffe",
                "settings" : { },
                "_hash" : 0.8074129179917693
              }, {
                "name" : "related_area",
                "type" : "attribute",
                "label" : "related_area",
                "color" : "#c51162",
                "settings" : { },
                "_hash" : 0.2636842908770418
              }, {
                "name" : "related_asset",
                "type" : "attribute",
                "label" : "related_asset",
                "color" : "#ffd600",
                "settings" : { },
                "_hash" : 0.5852815706252177
              }, {
                "name" : "related_location",
                "type" : "attribute",
                "label" : "related_location",
                "color" : "#0091ea",
                "settings" : { },
                "_hash" : 0.14906679861546435
              }, {
                "name" : "waterVolume",
                "type" : "timeseries",
                "label" : "waterVolume",
                "color" : "#ff6d00",
                "settings" : { },
                "_hash" : 0.420342570601821
              }, {
                "name" : "waterLevelPerc",
                "type" : "timeseries",
                "label" : "waterLevelPerc",
                "color" : "#6200ea",
                "settings" : { },
                "_hash" : 0.8336496014629973
              }, {
                "name" : "temperature",
                "type" : "timeseries",
                "label" : "temperature",
                "color" : "#aeea00",
                "settings" : { },
                "_hash" : 0.03599962209141927
              }, {
                "name" : "data_temperature_2",
                "type" : "timeseries",
                "label" : "data_temperature_2",
                "color" : "#00bfa5",
                "settings" : { },
                "_hash" : 0.7335197215922369
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "hideAggregation" : false,
              "hideAggInterval" : false,
              "hideTimezone" : false,
              "selectedTab" : 1,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : true,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 604800000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1714400561672,
                  "endTimeMs" : 1714486961672
                },
                "quickInterval" : "CURRENT_HOUR",
                "hideInterval" : true,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              },
              "timezone" : null
            },
            "showTitle" : false,
            "backgroundColor" : "#F1F3FF",
            "color" : "rgb(0, 0, 0)",
            "padding" : "0px",
            "settings" : {
              "useMarkdownTextFunction" : true,
              "markdownTextPattern" : "<body>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>hola</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n    <div>\r\n        <p>test</p>\r\n    </div>\r\n</body>",
              "markdownTextFunction" : "//getting svgs object\nvar svgs = getSvgs()\n\nvar stateParams = ctx.stateController.getStateParams();\n\n//filter by asset status json, has for example [\"asset on\", \"asset off\", etc]\nvar filterByAssetStatus = data[1].filterByAssetStatus ? JSON\n    .parse(data[1].filterByAssetStatus) : []\n    \nvar searchSensor = data[1].searchSensor ? data[1].searchSensor : ''\n\n//show legend toggle\nvar showLegend = data[1].showLegend ? data[1].showLegend :\n    false\nvar htmlVAL = \"\"\nvar dataItems = data.slice(2)\n\nvar map = dataItems.map(item => {\n    // Extract the unit from the data\n    var unit = data[2].Unit;\n    \n    // Destructure the pressure-related values from the getPressureValues function\n    var {\n        pressure,\n        avgPressure,\n        maxPressure,\n        minPressure\n    } = getPressureValues(item, unit);\n    \n    // Check if the device matches the search criteria\n    if(searchDevice(searchSensor, item) == true) {\n        return returnItems(); // If it matches, return the formatted HTML element\n    } else if(!searchSensor) {\n        return returnItems(); // If there's no search sensor, return the formatted HTML element\n    } else {\n        return null; // If it doesn't match, return null\n    }\n    \n    // Function to return the formatted HTML element for the item\n    function returnItems() {\n        // Prepare the data attribute for the HTML element, passing the entityName to the actions\n        var htmlVAL = `data-value=\"${item.entityName}\"`;\n\n        // Get the background color, status button color, and text color based on the item's pressure values\n        var {\n            bgColor,\n            statusButtonColor,\n            color\n        } = getCardColors(item, pressure);\n\n        // Apply filters to determine if the item should be included in the map\n        if (!applyFilters(item, pressure, filterByAssetStatus, \"\", \"\")) {\n            return null; // If it doesn't pass the filters, return null\n        }\n\n        // Retrieve battery level and active alarm status for the item\n        var battery = item.battery;\n        var alarm = item.activeAlarm;\n\n        // Determine the active color based on the item's active status\n        var activeColor = item.active === true ? 'green' : 'red';\n\n        // Return the formatted HTML element for the item\n        return `<div class=\"subContainer ${color}\" style=\"background-color: ${bgColor};\" id=\"asset_details\" value=\"${item.entityName}\" ${htmlVAL}>\n            <div style=\"font-weight: 700; font-size: 20px;\" ${htmlVAL}>${item.entityLabel}</div>\n            <div class=\"items-center\" ${htmlVAL}>\n                <span class=\"material-icons icon\" ${htmlVAL}>\n                    compress\n                </span>\n                <div class=\"pressure-info\" ${htmlVAL}>\n                    <div ${htmlVAL}>\n                        <span ${htmlVAL}>CURR</span>\n                        <span class=\"pressure-value pressure-curr\"  ${htmlVAL}>${pressure}</span>\n                        <span ${htmlVAL}>${unit}</span>\n                    </div>\n                    <div ${htmlVAL}>\n                        <span ${htmlVAL}>MIN</span>\n                        <span class=\"pressure-value\" ${htmlVAL}>${minPressure}</span>\n                        <span ${htmlVAL}>${unit}</span>\n                    </div>\n                    <div ${htmlVAL}>\n                        <span ${htmlVAL}>AVG</span>\n                        <span class=\"pressure-value\" ${htmlVAL}>${avgPressure}</span>\n                        <span ${htmlVAL}>${unit}</span>\n                    </div>\n                    <div ${htmlVAL}>\n                        <span ${htmlVAL}>MAX</span>\n                        <span class=\"pressure-value\" ${htmlVAL}>${maxPressure}</span>\n                        <span ${htmlVAL}>${unit}</span>\n                    </div>\n                </div>\n            </div>\n            <div style=\"display: flex; justify-content: space-between;\" class=\"info-container\" ${htmlVAL}>\n                <div class=\"items-center text\" ${htmlVAL}>\n                    ${getBatteryText(item.battery).icon}\n                    ${getBatteryText(item.battery).text}\n                </div>\n                <div class=\"items-center text\" ${htmlVAL}>\n                    ${getSignalText(item.rssi).icon}  ${getSignalText(item.rssi).text}\n                </div>\n                <div style=\"color: white\" class=\"text\" ${htmlVAL}>\n                    <span ${htmlVAL}>${status == true || status == 'true' ? 'Total Usage ' : 'Total Usage '} ${(formatTimeFromSeconds(item.OnTime / 1000))}</span>\n                </div>\n            </div>\n            <div class=\"alarmsContainer\" ${htmlVAL}>\n                <div class='statusContainer' ${htmlVAL}>\n                    ${alarm ? `${alarm}<span class=\"material-symbols-outlined\" style=\"color: ${statusButtonColor};\" id=\"alarm\"  ${htmlVAL}>\n                            warning</span>` : '<div></div>'}\n                </div>\n                <div>\n                    <span class=\"material-symbols-outlined\" style=\"cursor: pointer; color: ${statusButtonColor};\" ${htmlVAL} id=\"device_timeline\">\n                        monitoring\n                    </span>\n                </div>\n                <div class='' ${htmlVAL}>\n                    ${item.asset_status_confirmed == false ? `<span class=\"material-symbols-outlined circle-icon\" style=\"color: ${statusButtonColor}; \" id=\"turn-on\"  ${htmlVAL}>\n                                check_circle\n                            </span>` : '<div></div>'}\n                    ${item.asset_status_confirmed == true ? `<span class=\"material-symbols-outlined circle-icon\" style=\"color: ${statusButtonColor}; \" id=\"turn-off\"  ${htmlVAL}>\n                                cancel \n                            </span>` : '<div></div>'} \n                </div>\n            </div>\n        </div>`;\n    }\n})\n\n//function to get bg color\nfunction getCardColors(item, pressure) {\n    let bgColor = 'black';\n    let statusButtonColor = '';\n    let color = 'black';\n\n    if(item.active=='false' || item.active==false) {\n        // bgColor = '#E25A5A';\n        bgColor = 'gray';\n        statusButtonColor = \"white\";\n        color = 'white';\n    }\n    else if (pressure <= 0.25) { //blue\n        bgColor = '#154c79';\n        statusButtonColor = \"white\";\n        color = 'white';\n    } else if (pressure <= 6) { //green\n        bgColor = '#279B54';\n        statusButtonColor = \"white\";\n        color = 'white';\n    } else if (pressure <= 10) { //yellow\n        bgColor = '#eab676';\n        statusButtonColor = \"black\";\n        color = 'black';\n    } else if(pressure>10){\n        bgColor = '#FFA500';\n        statusButtonColor = \"white\";\n        color = 'white';\n    }\n    //asset off\n    else {\n        // bgColor = '#E25A5A';\n        bgColor = 'gray';\n        statusButtonColor = \"white\";\n        color = 'white';\n    }\n\n    return {\n        bgColor,\n        statusButtonColor,\n        color\n    };\n}\n\n//function to apply filters\n\nfunction applyFilters(item, pressure, filterByAssetStatus,\n    filterAboveOrBelowPressureOption,\n    filterAboveOrBelowPressureValue) {\n    \n    /*if(pressure>10){\n        return false\n    }*/\n    \n    //DEVICES MUST BE ACTIVE FOR PRESSURE VALIDATIONS\n    \n        \n    // Check if the filter includes \"asset on\"\n    if (filterByAssetStatus.includes(\"The pressure is below\")) {\n        // If the asset status is 'true' or true and the pressure is greater than or equal to 0.25, exclude the item\n        if (parseFloat(pressure) <= 0.25 && (item.active === 'true' || item.active ===true)) {\n            return false;\n        }\n    }\n    // Check if the filter includes \"device off\"\n    if (filterByAssetStatus.includes(\"device off\")) {\n        // If the device is inactive ('false' or false), exclude the item\n        if (item.active === 'false' || item.active ===false) {\n            return false;\n        }\n    }\n\n    // Check if the filter includes \"asset off reported on\"\n    if (filterByAssetStatus.includes(\"The pressure is normal\")) {\n        // If the asset status is 'true' or true and the pressure is less than 0.25, exclude the item\n        if (parseFloat(pressure) > 0.25 && parseFloat(\n                pressure) <= 6 && (item.active === 'true' || item.active ===true)) {\n            return false;\n        }\n    }\n\n    // Check if the filter includes \"asset off\"\n    if (filterByAssetStatus.includes(\"The pressure is above\")) {\n        // If the asset status is 'false' or false, exclude the item\n        if (parseFloat(pressure) > 6 && parseFloat(\n                pressure) <= 10 \n                && (item.active === 'true' || item.active ===true)) {\n            return false;\n        }\n    }\n    \n    if (filterByAssetStatus.includes(\"The pressure is high\")) {\n        // If the asset status is 'false' or false, exclude the item\n        if (parseFloat(pressure) > 10 && (item.active === 'true' || item.active ===true)) {\n            return false;\n        }\n    }\n\n    \n    if (filterByAssetStatus.includes(\"The pressure is high\")) {\n        // If the asset status is 'false' or false, exclude the item\n        if (parseFloat(pressure) > 10 && (item.active === 'true' || item.active ===true)) {\n            return false;\n        }\n    }\n\n    // If none of the conditions are met, include the item\n    return true;\n}\n\n\n//function to get pressure values\nfunction getPressureValues(item, unit) {\n    return {\n        pressure: getPressure(item.pressure, unit),\n        avgPressure: item.avgPressure ? getPressure(item\n            .avgPressure, unit) : 0,\n        maxPressure: item.maxPressure ? getPressure(item\n            .maxPressure, unit) : 0,\n        minPressure: item.minPressure ? getPressure(item\n            .minPressure, unit) : 0\n    };\n}\n\n\n//convert pressure to other units depending device settings\nfunction getPressure(value, unit) {\n    if (value.toString() == \"0\") {\n        return 0\n    }\n\n    if (value) {\n        if (value.toString() == \"0\") {\n            return 0\n        }\n\n        if (value || value.toString() == \"0\") {\n            //mbar to mWC\n            if (unit == 'mmWC') {\n                if (value || value.toString() == \"0\")\n                return (value * 10.197162129779)\n                    .toFixed(1)\n                return value.toFixed(1)\n            }\n            //mbar to inWC\n            else if (unit == 'inWC') {\n                if (value || value.toString() == \"0\")\n                return (value * 0.40146307866177)\n                    .toFixed(1)\n                if (value || value.toString() == \"0\")\n                return (value).toFixed(1)\n\n                return value.toFixed(1)\n            }\n            return value.toFixed(1)\n        }\n    }\n}\n\n\nfunction getSvgs() {\n\n    var svgs = {\n        pressure: `<svg width=\"15\" height=\"20\" viewBox=\"0 0 22 29\" fill=\"#000000\" xmlns=\"http://www.w3.org/2000/svg\" >\n            <g clip-path=\"url(#clip0_167_2)\">\n            <path d=\"M9.17571 0.128591C4.87074 1.04712 1.58051 4.31302 0.40177 8.84898C-0.520723 12.387 0.176272 16.5715 2.17501 19.4858C3.323 21.1528 5.03474 22.627 6.71572 23.3981L7.61772 23.8177V24.7929C7.61772 25.8929 7.73047 26.2331 8.20196 26.5619C8.52996 26.7887 8.52996 26.8001 8.54021 27.6732C8.54021 28.6371 8.65296 29 8.92971 29C9.27821 29 9.3602 28.7619 9.3602 27.7299V26.732H10.8464H12.3224L12.3532 27.7639C12.3737 28.5918 12.4147 28.8299 12.5582 28.9206C12.6812 29.0113 12.7734 29 12.8862 28.8979C13.0092 28.7845 13.0502 28.5237 13.0502 27.7413V26.732H13.3577C13.5524 26.732 13.7882 26.6073 13.9932 26.4032C14.3314 26.0743 14.3314 26.0516 14.3622 24.9403L14.4032 23.8063L15.2949 23.3981C16.9656 22.627 18.6876 21.1528 19.8254 19.4858C21.7729 16.6395 22.4801 12.6479 21.6704 9.15516C21.1681 6.96656 19.7434 4.21096 19.1694 4.30168C18.7901 4.35838 18.8311 4.83465 19.2514 5.44701C19.7639 6.19544 20.3891 7.49953 20.6864 8.4861C22.1829 13.3169 20.5941 18.6013 16.7607 21.527C13.8702 23.7383 10.0162 24.1238 6.80797 22.5249C5.33198 21.7878 3.5895 20.2002 2.63625 18.7374C1.10901 16.39 0.44277 13.1355 0.904016 10.2778C1.27301 7.94179 2.11351 6.09338 3.62025 4.34704C4.90149 2.86151 6.34673 1.88628 8.18146 1.26258C9.05271 0.967744 9.21671 0.945064 11.0002 0.945064C12.7837 0.945064 12.9477 0.967744 13.8189 1.26258C15.0182 1.67082 16.2174 2.32853 17.0886 3.06563C17.4781 3.38314 17.8574 3.70066 17.9394 3.7687C18.1341 3.92746 18.4314 3.68932 18.4314 3.3718C18.4314 2.70275 15.5922 0.899705 13.7164 0.355389C12.4352 -0.00748824 10.3237 -0.109547 9.17571 0.128591ZM11.0002 24.3393C11.5947 24.3393 12.4147 24.2713 12.8247 24.1919L13.5627 24.0558V24.8609C13.5627 25.3372 13.5114 25.7228 13.4397 25.8021C13.2654 25.9949 8.73496 25.9949 8.56071 25.8021C8.48896 25.7228 8.43771 25.3372 8.43771 24.8609V24.0558L9.18596 24.1919C9.5857 24.2713 10.4057 24.3393 11.0002 24.3393Z\" fill=\"#000000\"/>\n            <path d=\"M9.10378 2.16984C4.29657 3.41723 1.18059 8.33875 1.86734 13.5891C2.01084 14.5984 2.10309 14.8252 2.39008 14.8252C2.72833 14.8252 2.81033 14.5644 2.69758 13.9066C2.40033 12.2283 2.65658 9.88098 3.30233 8.32741C4.34782 5.76459 6.5413 3.74609 9.02178 3.06569C9.97503 2.80487 12.0353 2.80487 12.9885 3.06569C16.0532 3.90485 18.4825 6.61508 19.2102 10.0171C19.4562 11.1851 19.4767 12.9654 19.2615 14.1334C18.4312 18.556 14.69 21.7198 10.59 21.4817C7.58679 21.3003 5.06531 19.5539 3.56882 16.6055C3.12808 15.7437 2.81033 15.5169 2.60533 15.9252C2.29783 16.5715 4.07107 19.2137 5.63931 20.4498C8.34529 22.593 12.0968 22.9559 15.0077 21.3456C17.4985 19.9622 19.2205 17.6488 19.938 14.6891C20.2455 13.4417 20.266 10.9809 19.979 9.79026C19.118 6.19551 16.8425 3.53063 13.665 2.39664C12.9065 2.13582 12.5888 2.09046 11.2563 2.05644C10.1903 2.02242 9.53428 2.06778 9.10378 2.16984Z\" fill=\"#000000\"/>\n            <path d=\"M9.2782 4.61924C8.8682 4.74398 8.3352 4.93676 8.08921 5.0615C6.75672 5.70787 5.40373 7.15938 4.73748 8.63357C4.19423 9.85828 4.03024 10.5614 3.95849 12.0696C3.89699 13.317 3.89699 13.3283 4.16348 13.6231C4.41973 13.9066 4.48123 13.918 5.49597 13.918C6.46972 13.918 6.57222 13.8953 6.77722 13.6572C6.96171 13.4417 7.00271 13.2603 7.00271 12.7046C7.00271 10.1531 8.19171 8.38409 10.2519 7.8738C10.8669 7.71504 11.0822 7.49958 10.9592 7.17072C10.9079 7.00062 10.8054 6.97794 10.3032 7.03464C9.98544 7.06866 9.62669 7.1367 9.51395 7.17072C9.3397 7.22742 9.26795 7.12536 9.0117 6.49033C8.67345 5.61716 8.6632 5.62849 9.60619 5.4017C10.3134 5.2316 11.3282 5.19758 12.0457 5.32232C12.4147 5.39036 12.5684 5.36768 12.6914 5.2316C12.8657 5.02748 12.8759 4.95944 12.7529 4.75532C12.5274 4.34709 10.4877 4.26771 9.2782 4.61924ZM8.32495 6.85321C8.63245 7.55628 8.6427 7.61298 8.46845 7.72638C8.09946 7.95318 7.31021 8.84903 6.99246 9.41602C6.80797 9.74488 6.64397 10.0284 6.63372 10.0511C6.61322 10.0624 6.30572 9.97168 5.93672 9.8356C5.50622 9.67684 5.26023 9.52942 5.26023 9.41602C5.26023 9.17789 5.73172 8.32739 6.22372 7.68102C6.58247 7.1934 7.77146 6.09343 7.92521 6.09343C7.95596 6.09343 8.14046 6.43363 8.32495 6.85321ZM5.76247 10.6407C6.38772 10.8789 6.40822 10.8902 6.34672 11.2304C6.31597 11.4118 6.28522 11.9108 6.28522 12.3417V13.1242H5.50622H4.71698L4.76823 11.8995C4.80923 10.7315 4.87073 10.4026 5.04498 10.4026C5.08598 10.4026 5.40373 10.516 5.76247 10.6407Z\" fill=\"#000000\"/>\n            <path d=\"M13.952 4.98264C13.501 5.39088 9.5445 10.834 9.319 11.367C8.76551 12.6484 9.67775 14.168 11 14.168C11.9532 14.168 12.5067 13.601 12.9475 12.1495C13.3062 11.0155 14.7925 5.54964 14.7925 5.40222C14.7925 5.24346 14.3927 4.84656 14.2492 4.84656C14.1775 4.84656 14.0442 4.9146 13.952 4.98264ZM13.5625 7.08053C13.5112 7.26196 13.1832 8.44131 12.8347 9.72272C12.4862 10.9928 12.1172 12.2629 12.0147 12.5237C11.8302 13.0113 11.41 13.3515 11 13.3515C10.7027 13.3515 10.2107 13.0453 10.0775 12.7958C9.90325 12.4216 9.9545 11.7639 10.2005 11.3897C10.713 10.5732 13.5317 6.77435 13.6137 6.77435C13.6342 6.77435 13.6137 6.91043 13.5625 7.08053Z\" fill=\"#000000\"/>\n            <path d=\"M15.3666 6.61507C15.1309 6.86454 15.1514 6.94392 15.6126 7.49958C16.0431 8.02122 16.7401 9.22325 16.7401 9.45004C16.7401 9.52942 16.4326 9.69952 16.0534 9.84694L15.3769 10.0964L15.1821 9.79024C14.7516 9.14387 14.2904 9.57478 14.5876 10.3459C14.8439 11.0036 14.9976 11.8881 14.9976 12.7159C14.9976 13.3056 15.0386 13.4644 15.2334 13.6685C15.4486 13.8953 15.5819 13.918 16.5249 13.918C17.4986 13.918 17.5908 13.8953 17.8163 13.6345C18.0418 13.3963 18.0726 13.2603 18.0726 12.5345C18.0623 10.3459 17.4064 8.41811 16.1764 6.89856C15.7561 6.38827 15.6126 6.34291 15.3666 6.61507ZM17.1604 10.8108C17.2014 10.9923 17.2321 11.5819 17.2424 12.1263L17.2526 13.1242H16.4839H15.7151V12.3417C15.7151 11.9108 15.6844 11.4118 15.6536 11.2304C15.6024 10.9129 15.6126 10.9016 16.2481 10.6634C16.6069 10.5273 16.9451 10.4366 16.9964 10.448C17.0579 10.4706 17.1296 10.6294 17.1604 10.8108Z\" fill=\"#000000\"/>\n            <path d=\"M5.77287 15.1655C5.59862 15.3583 5.56787 15.5397 5.56787 16.3789C5.56787 17.4448 5.59862 17.5582 5.94712 17.7624C6.26487 17.9438 15.7358 17.9438 16.0535 17.7624C16.402 17.5582 16.4328 17.4448 16.4328 16.3789C16.4328 14.8253 16.73 14.9387 12.4558 14.9387C9.82159 14.9387 8.8581 14.9727 8.76585 15.0748C8.56085 15.3016 8.62235 15.6191 8.90935 15.7325C9.05285 15.8006 10.5596 15.8459 12.4456 15.8459H15.7153V16.4129V16.9799H11.0003H6.28537V16.4129V15.8459H6.84911C7.52561 15.8459 7.90485 15.5511 7.72036 15.1655C7.62811 14.9727 7.50511 14.9387 6.79786 14.9387C6.11112 14.9387 5.94712 14.9727 5.77287 15.1655Z\" fill=\"#000000\"/>\n            <path d=\"M7.74066 18.9301C7.56641 19.1228 7.58691 19.5538 7.78166 19.6331C7.87391 19.6672 9.36015 19.7012 11.0924 19.7012C13.3986 19.7012 14.2699 19.6672 14.3621 19.5651C14.5466 19.361 14.5056 19.0435 14.2904 18.9074C13.9931 18.7373 7.90466 18.7486 7.74066 18.9301Z\" fill=\"#000000\"/>\n            </g>\n            <defs>\n            <clipPath id=\"clip0_167_2\">\n            <rect width=\"22\" height=\"29\" fill=\"white\"/>\n            </clipPath>\n            </defs>\n            </svg>`\n    }\n\n    return svgs\n}\n\n\n//function to get the battery text: Low, Medium, High, Very High or Full\nfunction getBatteryText(batt) {\n    let result_text = \"\",\n        icon = \"\"\n    if (batt >= 0 && batt <= 10) {\n        result_text = \"Low\"; // rojo\n        icon = `<span class=\"material-icons\">\n            battery_1_bar\n        </span>`\n    } else if (batt > 10 && batt <= 30) {\n        result_text = \"Medium\"; // naranja\n        icon = `<span class=\"material-icons\">\n            battery_2_bar\n        </span>`\n    } else if (batt > 30 && batt <= 50) {\n        result_text = \"High\"; // amarillo\n        icon = `<span class=\"material-icons\">\n            battery_4_bar\n        </span>`\n    } else if (batt > 50 && batt <= 70) {\n        result_text = \"Very High\"; // verde oscuro\n        icon = `<span class=\"material-icons\">\n            battery_5_bar\n        </span>`\n    } else if (batt > 70 && batt <= 100) {\n        result_text = \"Full\"; // verde claro\n        icon = `<span class=\"material-icons\">\n            battery_full\n        </span>`\n    }\n    return {\n        text: result_text,\n        icon\n    }\n}\n\n//function to get the rssi text: Very Strong, Strong, Moderate, etc\nfunction getSignalText(rssi) {\n    let result_signal = \"\",\n        icon = \"\"\n    if (rssi > -70 && rssi <= -40) {\n        result_text = \"Very strong\"\n        icon = `<span class=\"material-icons\">\n            signal_wifi_statusbar_4_bar\n        </span>`\n    } else if (rssi > -100 && rssi <= -70) {\n        result_text = \"Strong\" // green\n        icon = `<span class=\"material-icons\">\n            signal_wifi_statusbar_4_bar\n        </span>`\n    } else if (rssi > -120 && rssi <= -\n        100) { //low signal power\n        result_text = \"Moderate\"\n        icon = `<span class=\"material-icons\">\n            network_wifi_3_bar\n        </span>`\n    } else if (rssi > -120 && rssi <= -\n        105) { //really low signal power (problems to make calls)\n        result_text = \"Weak\"\n        icon = `<span class=\"material-icons\">\n            network_wifi_1_bar\n        </span>`\n    } else if (rssi <= -120) {\n        result_text = \"Super weak\"\n        icon = `<span class=\"material-icons\">\n            network_wifi_1_bar\n        </span>`\n    }\n    return {\n        text: result_text,\n        icon\n    }\n}\n\n\n//for showing in total Usage\nfunction formatTimeFromSeconds(seconds) {\n    seconds = parseInt(seconds)\n\n    // Constants for time conversions\n    const oneMinute = 60;\n    const oneHour = 60 * oneMinute;\n    const oneDay = 24 * oneHour;\n    const oneYear = 365 * oneDay;\n    const oneMonth = 30 *\n    oneDay; // Assuming an average of 30 days per month\n\n    // Calculate individual time components\n    let years = Math.floor(seconds / oneYear);\n    let months = Math.floor((seconds % oneYear) / oneMonth);\n    let days = Math.floor(((seconds % oneYear) % oneMonth) /\n        oneDay);\n    let hours = Math.floor((((seconds % oneYear) %\n        oneMonth) % oneDay) / oneHour);\n    let minutes = Math.floor(\n        ((((seconds % oneYear) % oneMonth) % oneDay) %\n            oneHour) / oneMinute\n    );\n    let remainingSeconds = seconds % oneMinute;\n\n    // Initialize the result string\n    let resultText = \"\";\n\n    // Mostrar máximo dos componentes no nulos\n    let componentsCount = 0;\n\n    // Include years if greater than 0 and there is still room for more components\n    if (years > 0 && componentsCount < 2) {\n        resultText += `${years}y `;\n        componentsCount++;\n    }\n\n    // Include months if greater than 0 and there is still room for more components\n    if (months > 0 && componentsCount < 2) {\n        resultText += `${months}mo `;\n        componentsCount++;\n    }\n\n    // Include days if greater than 0 and there is still room for more components\n    if (days > 0 && componentsCount < 2) {\n        resultText += `${days}d `;\n        componentsCount++;\n    }\n\n    // Include hours if greater than 0 and there is still room for more components\n    else if (hours > 0 && componentsCount < 2) {\n        resultText += `${hours}h `;\n        componentsCount++;\n    }\n\n    // Include minutes if greater than 0 and there is still room for more components\n    else if (minutes > 0 && componentsCount < 2) {\n        resultText += `${minutes}min `;\n        componentsCount++;\n    }\n\n    // Include remaining seconds if greater than 0 and there is still room for more components\n    else if (remainingSeconds > 0 && componentsCount < 2) {\n        resultText += `${remainingSeconds.toFixed(0)}s`;\n        componentsCount++;\n    }\n\n    // If no components were added, default to \"0s\"\n    if (resultText.trim() === \"\") {\n        resultText = \"0s\";\n    }\n\n    // Return the trimmed result string\n    return resultText.trim();\n}\n\n\n//legend container: this will have the legend for the user and some custom actions\nvar legend = `<div class=\"legendContainer\" style=\"box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); margin: 6px 0px; border-radius: 10px;\">\n    <div class=\"status-info\" style=\"padding: 0px 3px; \">\n        <div style=\"display: flex; gap: 4px; align-items: center; cursor: pointer;\" id=\"Information\">\n            <span class=\"material-icons\">info</span>\n            <span class=\"title\">Legend and Filters</span>\n        </div>\n        <div style=\"display: flex; gap: 15px\">\n            <div class=\"status-row\" id=\"filter-pressure-below\" style=\"cursor: pointer\" ${htmlVAL}>\n                <div class=\"status-dot\" style=\"background-color: #154c79;\" ${htmlVAL}></div>\n                <span ${htmlVAL} class=\"${filterByAssetStatus.includes(\"The pressure is below\") && \"lineThrough\"}\">Asset Off</span>\n            </div>\n            <div class=\"status-row\" id=\"filter-device-off\" style=\"cursor: pointer\">\n                <div class=\"status-dot\" style=\"background-color: #757678;\"></div>\n                <span class=\"${filterByAssetStatus.includes(\"device off\") && \"lineThrough\"}\">Sensor Off</span>\n            </div>\n            <div class=\"status-row\" id=\"filter-pressure-normal\"  style=\"cursor: pointer\" ${htmlVAL}>\n                <div class=\"status-dot\" style=\"background-color: #279B54;\" ${htmlVAL}></div>\n                <span ${htmlVAL} class=\"${filterByAssetStatus.includes(\"The pressure is normal\") && \"lineThrough\"}\">0.25-6</span>\n            </div>\n            <div class=\"status-row\" id=\"filter-pressure-above\" style=\"cursor: pointer\" ${htmlVAL}>\n                <div class=\"status-dot\" style=\"background-color: #FFC700;\" ${htmlVAL}></div>\n                <span ${htmlVAL} class=\"${filterByAssetStatus.includes(\"The pressure is above\") && \"lineThrough\"}\">6-10</span>\n            </div>\n            <!--<div class=\"status-row\" id=\"filter-pressure-higher\" style=\"cursor: pointer\" ${htmlVAL}>\n                <div class=\"status-dot\" style=\"background-color: #FFA500;\" ${htmlVAL}></div>\n                <span ${htmlVAL}>>10</span>\n            </div>-->\n            <div class=\"status-row\" id=\"filter-pressure-higher\" style=\"cursor: pointer\" ${htmlVAL}>\n                <div class=\"status-dot\" style=\"background-color: #FFA500;\" ${htmlVAL}></div>\n                <span ${htmlVAL} class=\"${filterByAssetStatus.includes(\"The pressure is high\") && \"lineThrough\"}\">>10</span>\n            </div>\n            <!--<div class=\"status-row\" id=\"filter-by-pressure\" style=\"cursor: pointer\" ${htmlVAL} >\n                <span class=\"${filterByAssetStatus.includes(\"device off\") && \"lineThrough\"}\" ${htmlVAL} >Filter by pressure</span>\n            </div>-->\n        </div>\n    </div>\n    <div class=\"status-info\">\n    </div>\n</div>`\n\nfunction searchDevice(searchSensor, item) {\n    // Check if the search term is not defined\n    if (!searchSensor) return false;\n\n    // Convert the search term to lowercase\n    const searchTerm = searchSensor.toString().toLowerCase();\n\n    // Array of fields to search within the item\n    const fields = [\n        'entityLabel',\n        'entityName',\n        'devEUI',\n        'related_location',\n        'related_area',\n        'related_asset'\n    ];\n\n    // Check if any of the fields contain the search term\n    return fields.some(field => \n        item[field] && item[field].toLowerCase().includes(searchTerm)\n    );\n}\n\nreturn `<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\" />\n<body style=\"background: #F1F3FF\">\n    <div style=\"display: padding: 0px 8px !important;\">\n        <div class=\"legendMainContainer\">\n            <span class=\"material-icons\" style=\"font-size: 24px; cursor: pointer;\" id=\"showLegend\">\n                ${showLegend=='true' || showLegend==true ? 'expand_more' : \"expand_less\"}\n            </span>\n            ${showLegend=='true' || showLegend==true ? legend : '<div></div>'}\n        </div>\n    </div>\n    <div class='searchBar'>\n        <tb-dashboard-state  [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"card_searchbar\" class=\"farme-state\"></tb-dashboard-state>\n    </div>\n    <div class=\"mainContainer\">${map.find(item=>item!=null) ? map.join(\" \") : \"<label style='color: red; padding-left: 4px;'>No devices found</label>\"}\n    </div>\n</body>`",
              "applyDefaultMarkdownStyle" : true,
              "markdownCss" : "tb-dashboard-state{\r\n    height: 180px;\r\n    width: 50%;\r\n}\r\n\r\n.searchBar{\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    width: 100%;\r\n}\r\n\r\n@media(max-width: 900px){\r\n    tb-dashboard-state{\r\n        width: 100%;\r\n    }\r\n}\r\n\r\nbody {\r\n    overflow: auto;\r\n}\r\n\r\n.mainContainer {\r\n    width: 100%;\r\n    padding: 10px 2px;\r\n    display: flex;\r\n    display: grid;\r\n    grid-template-columns: repeat(6, 1fr);\r\n    gap: 12px;\r\n}\r\n.subContainer {\r\n    border-radius:5px;\r\n    padding: 5px;\r\n    border: 1px solid #000;\r\n    width: 100%;\r\n    height: 100%;\r\n    height: 220px;\r\n    overflow: auto;\r\n    font-size: 0.6vw;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n}\r\n.subContainer:hover{\r\n    /*background: black !important;*/\r\n    color: white !important;\r\n    opacity: 0.8;\r\n    cursor: pointer;\r\n}\r\n.subContainer:hover *{\r\n    /*color: white;*/\r\n}\r\n.alarmContainer{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n.statusContainer{\r\n    display: flex;\r\n    align-items: center;\r\n    padding-right: 4px;\r\n    font-weight: 700;\r\n    gap: 4px;\r\n}\r\n\r\n#alarm, .circle-icon {\r\n    /*cursor: text;*/\r\n    transition: transform 0.5s; \r\n}\r\n#alarm:hover, .circle-icon:hover {\r\n    transform: scale(1.2); \r\n}\r\n#statusButton{\r\n    font-size: 28px !important;\r\n}\r\n\r\ninput{\r\n    background: transparent;\r\n}\r\n\r\n.icon{\r\n    font-size: 14px;\r\n    margin-right: px;\r\n}\r\n\r\n.items-center{\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 4px;\r\n}\r\n\r\n.flex-center{\r\n    display: flex;\r\n    font-weight: 700;\r\n}\r\n\r\n@media(max-width: 1200px){\r\n    .mainContainer {\r\n        grid-template-columns: repeat(5, 1fr);\r\n    }\r\n}\r\n\r\n@media(max-width: 1000px){\r\n    .mainContainer {\r\n        grid-template-columns: repeat(4, 1fr);\r\n    }\r\n}\r\n\r\n@media(max-width: 800px){\r\n    .mainContainer {\r\n        grid-template-columns: repeat(3, 1fr);\r\n    }\r\n}\r\n\r\n@media(max-width: 600px){\r\n    .mainContainer {\r\n        grid-template-columns: repeat(2, 1fr);\r\n    }\r\n}\r\n\r\n@media(max-width: 400px){\r\n    .mainContainer {\r\n        grid-template-columns: repeat(1, 1fr);\r\n    }\r\n}\r\n\r\n.black *{\r\n    color: black;\r\n}\r\n\r\n.white *{\r\n    color: #F7F7F7;\r\n}\r\n\r\n.material-symbols-outlined{\r\n    font-size: 28px;\r\n    color: #FFD311;\r\n    font-weight: 500;\r\n}\r\n\r\n.circle-icon{\r\n    font-size: 28px;\r\n    color: #f5e393;\r\n    font-weight: 500;\r\n}\r\n\r\n.material-icons{\r\n    font-size: 20px;\r\n}\r\n\r\n/*.border-r{\r\n    border-right: 2px solid white;\r\n}*/\r\n\r\n.pressure-info{\r\n    width: 100%;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    flex-wrap: flex-wrap;\r\n    gap: 3px;\r\n}\r\n\r\n@media(max-width: 1000px){\r\n    .info-container{\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n}\r\n\r\n.pressure-info span{\r\n    display: flex;\r\n    padding: 0px 3px;\r\n    flex-wrap: flex-wrap;\r\n}\r\n\r\n@media(max-width:1000px){\r\n    .subContainer{\r\n        font-size: 13px;\r\n    }\r\n}\r\n\r\n@media(max-width:950px){\r\n    .subContainer{\r\n        font-size: 11px;\r\n        height: 230px;\r\n    }\r\n    .legendContainer{\r\n        width: 100%;\r\n    }\r\n}\r\n\r\n.alarmsContainer{\r\n    padding-top: 4px;\r\n    width: 100%;\r\n    display: flex; \r\n    align-items: center;\r\n    justify-content: space-between;\r\n}\r\n\r\n.legendContainer{\r\n    font-size: 14px;\r\n    gap: 6px;\r\n    padding: 12px 0px;\r\n    display: grid;\r\n    /*grid-template-columns: 40% 60%;*/\r\n}\r\n\r\n.legendMainContainer{\r\n}\r\n\r\n.more-info{\r\n    transition: transform 1s; \r\n    display: flex;\r\n    gap: 4px;\r\n    justify-content: center;\r\n}\r\n\r\n.more-info:hover{\r\n    cursor: pointer;\r\n    color: blue;\r\n    opacity: 0.8;\r\n    padding: 0;\r\n}\r\n\r\n.more-info {\r\n    display: flex;\r\n    align-items: center;\r\n    border-right: 1px solid #ccc;\r\n}\r\n\r\n.info-label, .info-icon, .title {\r\n    font-weight: 700;\r\n    font-size: 16px !important;\r\n}\r\n\r\n.status-info {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n.status-row {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-top: 5px;\r\n}\r\n\r\n.status-dot {\r\n    margin-right: 5px;\r\n    width: 12px;\r\n    height: 12px;\r\n    border-radius: 50%;\r\n}\r\n\r\n.title{\r\n    font-weight: 700;\r\n    font-size: 14px;\r\n    \r\n}\r\n\r\n.pressure-value{\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    /*font-family: Sans-Serif;*/\r\n}\r\n\r\n.pressure-curr{\r\n    font-weight: 700;\r\n    font-size: 18px;\r\n}\r\n\r\n.lineThrough {\r\n    text-decoration: line-through;\r\n}\r\n\r\n#device_timeline {\r\n  \r\n  font-size: 28px;\r\n  transition: transform 0.2s;\r\n  transform-origin: center; /* add this */\r\n}\r\n\r\n#device_timeline:hover {\r\n  transform: scale(1.2);\r\n}"
            },
            "title" : "Pressure sensors map rendering",
            "showTitleIcon" : false,
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "24px",
            "titleTooltip" : "",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "showLegend" : false,
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true,
            "enableDataExport" : false,
            "widgetCss" : "#mat-tab-label-3-0{\n    display: none !important;\n}",
            "pageSize" : 1024,
            "noDataDisplayMessage" : "",
            "actions" : {
              "elementClick" : [ {
                "name" : "asset_details",
                "icon" : "sensors",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "// Get customerId from widgetContext data sources\r\nvar customerId = widgetContext.datasources[0].entityId;\r\n\r\n// Get the value from the event target's data attribute\r\nvar value = $event.target.getAttribute(\"data-value\");\r\n\r\n// Get state parameters from the state controller\r\nvar stateParams = widgetContext.stateController.getStateParams();\r\n\r\n// Get the JWT token from localStorage\r\nvar jwtToken = localStorage.getItem('jwt_token');\r\n\r\n// Define headers for the fetch request\r\nconst relationsHeaders = {\r\n    accept: \"application/json\",\r\n    \"Content-Type\": \"application/json\",\r\n    Authorization: `Bearer ${jwtToken}`,\r\n};\r\n\r\n// Define the options for the fetch request\r\nconst relationsHeadersContent = {\r\n    method: \"GET\",\r\n    headers: relationsHeaders\r\n};\r\n\r\n// Make a fetch request to get device information based on the customerId and value\r\nfetch(`https://iotlogiq.com:443/api/customer/${customerId}/deviceInfos?pageSize=1&page=0&textSearch=${value}`, relationsHeadersContent)\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n        // Update stateParams with the new device information\r\n        stateParams.currentDevice = {\r\n            entityId: data.data[0].id,\r\n            entityName: data.data[0].name,\r\n            entityLabel: data.data[0].label\r\n        };\r\n        // Update the state with the new stateParams\r\n        widgetContext.stateController.updateState('default', stateParams, false);\r\n        \r\n        document.getElementById('top').scrollIntoView({ behavior: 'smooth' });\r\n    })\r\n    .catch((error) => console.error('Error fetching device information:', error));\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "41b95118-6b55-7823-efab-e7146ac37184"
              }, {
                "name" : "device_timeline",
                "icon" : "show_chart",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "var customerId = widgetContext.datasources[0].entityId\r\n\r\nvar value = $event.target.getAttribute(\"data-value\");\r\n//var entityService = widgetContext.entityService\r\n\r\nvar stateParams = widgetContext.stateController.getStateParams()\r\n\r\nvar jwtToken = localStorage.getItem('jwt_token')\r\n\r\nconst relationsHeaders = {\r\n\taccept: \"application/json\",\r\n\t\"Content-Type\": \"application/json\",\r\n\tAuthorization: `Bearer ${jwtToken}`,\r\n}\r\n\r\nconst relationsHeadersContent = {\r\n\tmethod: \"GET\",\r\n\theaders: relationsHeaders\r\n};\r\n\r\nfetch(`https://iotlogiq.com:443/api/customer/${customerId}/deviceInfos?pageSize=1&page=0&textSearch=${value}`, relationsHeadersContent)\r\n\t.then((response) => response.json())\r\n\t.then((data) => {\r\n\t\tstateParams.currentDevice = {\r\n            entityId: data.data[0].id, \r\n            entityName: data.data[0].name, \r\n            entityLabel: data.data[0].label \r\n        };\r\n        \r\n        widgetContext.actionsApi.openDashboardStateInPopover($event, \"device_timeline\", stateParams, true, undefined, true, '500px', '350px');\r\n\t})\r\n\t.catch((error) => console.error(error));\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "be507cde-fdc6-9e97-90ac-4180d0780958"
              }, {
                "name" : "deprecated-filter-by-pressure",
                "icon" : "filter_alt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "var customerId = widgetContext.datasources[0].entityId\r\n\r\nvar value = $event.target.getAttribute(\"data-value\");\r\n//var entityService = widgetContext.entityService\r\n\r\nvar stateParams = widgetContext.stateController.getStateParams()\r\n\r\nvar jwtToken = localStorage.getItem('jwt_token')\r\n\r\nconst relationsHeaders = {\r\n\taccept: \"application/json\",\r\n\t\"Content-Type\": \"application/json\",\r\n\tAuthorization: `Bearer ${jwtToken}`,\r\n}\r\n\r\nconst relationsHeadersContent = {\r\n\tmethod: \"GET\",\r\n\theaders: relationsHeaders\r\n};\r\n\r\n\r\n\t\tfetch(`https://iotlogiq.com:443/api/customer/${customerId}/deviceInfos?pageSize=1&page=0&textSearch=${value}`, relationsHeadersContent)\r\n\t\t\t.then((response) => response.json())\r\n\t\t\t.then((data) => {\r\n    \t\t\tstateParams.currentDevice = {\r\n                    entityId: data.data[0].id, \r\n                    entityName: data.data[0].name, \r\n                    entityLabel: data.data[0].label \r\n                };\r\n                widgetContext.actionsApi.openDashboardStateInSeparateDialog(\"popup_settings_current_user\", stateParams, \"Set threshold filters for pressure\", undefined, true, '400px', '350px');\r\n\t\t\t})\r\n\t\t\t.catch((error) => console.error(error));\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "28bbb08b-7ef7-eacd-713b-a085521ecd56"
              }, {
                "name" : "turn-on",
                "icon" : "check_circle",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "var customerId = widgetContext.datasources[0].entityId\r\n\r\nlet $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get(\"customDialog\"));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get(\"deviceService\"));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get(\"attributeService\"));\r\n\r\nvar value = $event.target.getAttribute(\"data-value\");\r\nvar stateParams = widgetContext.stateController.getStateParams();\r\nvar jwtToken = localStorage.getItem('jwt_token');\r\n\r\nconst relationsHeaders = {\r\n    accept: \"application/json\",\r\n    \"Content-Type\": \"application/json\",\r\n    Authorization: `Bearer ${jwtToken}`,\r\n};\r\n\r\nconst relationsHeadersContent = {\r\n    method: \"GET\",\r\n    headers: relationsHeaders\r\n};\r\n\r\nfetch(`https://iotlogiq.com:443/api/customer/${customerId}/deviceInfos?pageSize=1&page=0&textSearch=${value}`, relationsHeadersContent)\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n        \r\n        const entityId = data.data[0].id.id\r\n        //const entityId = data.id.id;\r\n        \r\n        const relationsHeadersContentPost = {\r\n            method: \"POST\",\r\n            headers: relationsHeaders,\r\n            body: JSON.stringify({\r\n                \"asset_status_confirmed\": true,\r\n                \"enable_asset_status_confirmed\": true\r\n            })\r\n        };\r\n        \r\n        fetch(`https://iotlogiq.com:443/api/plugins/telemetry/${entityId}/SERVER_SCOPE`, relationsHeadersContentPost)\r\n            .then((response2) => response2.json())\r\n            .then((data2) => {\r\n            });\r\n    })\r\n    .catch((error) => console.error(error));",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "0b4ce66a-064d-dcef-f89f-1575257c437d"
              }, {
                "name" : "turn-off",
                "icon" : "cancel",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "var customerId = widgetContext.datasources[0].entityId\r\n\r\n\r\nlet $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get(\"customDialog\"));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get(\"deviceService\"));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get(\"attributeService\"));\r\n\r\nvar value = $event.target.getAttribute(\"data-value\");\r\nvar stateParams = widgetContext.stateController.getStateParams();\r\nvar jwtToken = localStorage.getItem('jwt_token');\r\n\r\nconst relationsHeaders = {\r\n    accept: \"application/json\",\r\n    \"Content-Type\": \"application/json\",\r\n    Authorization: `Bearer ${jwtToken}`,\r\n};\r\n\r\nconst relationsHeadersContent = {\r\n    method: \"GET\",\r\n    headers: relationsHeaders\r\n};\r\n\r\nfetch(`https://iotlogiq.com:443/api/customer/${customerId}/deviceInfos?pageSize=1&page=0&textSearch=${value}`, relationsHeadersContent)\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n        const entityId = data.data[0].id.id\r\n        \r\n        const relationsHeadersContentPost = {\r\n            method: \"POST\",\r\n            headers: relationsHeaders,\r\n            body: JSON.stringify({\r\n                \"asset_status_confirmed\": false,\r\n                \"enable_asset_status_confirmed\": true\r\n            })\r\n        };\r\n        \r\n        fetch(`https://iotlogiq.com:443/api/plugins/telemetry/${entityId}/SERVER_SCOPE`, relationsHeadersContentPost)\r\n            .then((response2) => response2.json())\r\n            .then((data2) => {\r\n                widgetContext.showSuccessToast(`${value} reported as off`, 3000, 'top', 'left')\r\n            });\r\n    })\r\n    .catch((error) => console.error(error));\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "932276e8-f3a7-63ee-aabc-9ccefae424bc"
              }, {
                "name" : "alarm",
                "icon" : "report_problem",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "var customerId = widgetContext.datasources[0].entityId\r\n\r\nvar value = $event.target.getAttribute(\"data-value\");\r\n//var entityService = widgetContext.entityService\r\n\r\nvar stateParams = widgetContext.stateController.getStateParams()\r\n\r\nvar jwtToken = localStorage.getItem('jwt_token')\r\n\r\nconst relationsHeaders = {\r\n\taccept: \"application/json\",\r\n\t\"Content-Type\": \"application/json\",\r\n\tAuthorization: `Bearer ${jwtToken}`,\r\n}\r\n\r\nconst relationsHeadersContent = {\r\n\tmethod: \"GET\",\r\n\theaders: relationsHeaders\r\n};\r\n\r\n\r\n\t\tfetch(`https://iotlogiq.com:443/api/customer/${customerId}/deviceInfos?pageSize=1&page=0&textSearch=${value}`, relationsHeadersContent)\r\n\t\t\t.then((response) => response.json())\r\n\t\t\t.then((data) => {\r\n    \t\t\tstateParams.currentDevice = {\r\n                    entityId: data.data[0].id, \r\n                    entityName: data.data[0].name, \r\n                    entityLabel: data.data[0].label \r\n                };\r\n                widgetContext.actionsApi.openDashboardStateInPopover($event, \"alarms\", stateParams, true, undefined, true, '500px', '350px');\r\n\t\t\t})\r\n\t\t\t.catch((error) => console.error(error));\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//maybe make a fetch\r\n\r\n/*entityService.getEntitiesByNameFilter('DEVICE', value).subscribe((entities) => {\r\n    // Hacer algo con las entidades devueltas\r\n    console.log(entities);\r\n}, (error) => {\r\n    // Manejar el error\r\n    console.error(error);\r\n});*/",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "67eb6bd5-e9f5-3864-c7e3-18287b6c7582"
              }, {
                "name" : "Information",
                "icon" : "info",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "openDashboardState",
                "targetDashboardStateId" : "asset_information",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : false,
                "popoverPreferredPlacement" : "bottomRight",
                "popoverHideOnClickOutside" : true,
                "popoverHideDashboardToolbar" : true,
                "popoverWidth" : "600px",
                "popoverHeight" : "400px",
                "popoverStyle" : { },
                "openInSeparateDialog" : false,
                "openInPopover" : true,
                "id" : "f270b512-a73a-cbd1-be95-bd3b728ed7b6"
              }, {
                "name" : "showLegend",
                "icon" : "visibility",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "const $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nvar showLegend = widgetContext.data.find(item=>item.dataKey.name=='showLegend').data[0][1]\n\nlet attributesArray = [\n    {key: \"showLegend\", value: showLegend=='false' ? true : false},\n    //{key: \"sortDevicesStatus\", value: \"desc\"}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "80a6a8b5-08d9-fd0f-1fbf-766c6cb83fec"
              }, {
                "name" : "deprecated-showFilters",
                "icon" : "visibility",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//showFilters\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nvar showFilters = widgetContext.data.find(item=>item.dataKey.name=='showFilters').data[0][1]\n\nlet attributesArray = [\n    {key: \"showFilters\", value: showFilters=='false' ? true : false},\n    //{key: \"sortDevicesStatus\", value: \"desc\"}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "e6fa8f94-d0e9-133f-e097-ddac11b6c934"
              }, {
                "name" : "filter-asset-on",
                "icon" : "filter_alt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"asset on\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "ee4e7226-5460-774d-cb93-f0984cb1b79b"
              }, {
                "name" : "filter-asset-off",
                "icon" : "filter_alt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"asset off\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "2ff557af-e4e1-d7fc-a2b8-cdbe2ffd9a52"
              }, {
                "name" : "filter-device-off",
                "icon" : "filter_alt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"device off\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "d7faf8be-bb51-14e2-79d9-abdc9eb0bd9e"
              }, {
                "name" : "filter-asset-off-reported-on",
                "icon" : "filter_alt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"asset off reported on\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "14861411-6aa1-b12e-2c00-f25dee5695bb"
              }, {
                "name" : "deprecated-statusButton",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "customPretty",
                "customHtml" : "<form #addEntityForm=\"ngForm\" [formGroup]=\"editDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 420px; background-color: #F1F3FF;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Manual override</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n      <mat-checkbox (change)=\"onEnableChange($event.target)\" formControlName=\"enable_asset_status_confirmed\" [(ngModel)] = \"flag\"> \n        <mat-label>Enable Setting Asset Status</mat-label>\n      </mat-checkbox>\n      \n      <div *ngIf=\"flag==true\" >\n            <mat-label style=\"font-size: 14px; font-weight: 700;\">Confirm Asset Status</mat-label>\n            <mat-slide-toggle formControlName=\"asset_status_confirmed\" (change)=\"onChangeStatus($event)\" [(ngModel)]=\"status\" [checked]=\"status == true\">\n            </mat-slide-toggle>\n            \n            \n            \n            \n          <!--<mat-radio-group formControlName=\"asset_status_confirmed\" fxLayout=\"row\" (change)=\"onChangeStatus($event)\"  \n          [(ngModel)] = \"status\">\n              <mat-radio-button [value]=\"'true'\">Asset On</mat-radio-button>\n              <mat-radio-button [value]=\"'false'\">Asset Off</mat-radio-button>\n            </mat-radio-group>-->\n      </div>\n      \n      <!--<mat-checkbox formControlName=\"asset_status_confirmed\" *ngIf=\"flag==true\">\n        <mat-label>Confirm Asset Status On</mat-label>\n      </mat-checkbox>-->\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editDeviceFormGroup.invalid || !editDeviceFormGroup.dirty\">\n      Save device\n    </button>\n  </div>\n</form>\n",
                "customCss" : "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction" : "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap\r\n    .get(\"customDialog\"));\r\nlet deviceService = $injector.get(\r\n    widgetContext.servicesMap.get(\"deviceService\")\r\n);\r\nlet attributeService = $injector.get(\r\n    widgetContext.servicesMap.get(\"attributeService\")\r\n);\r\n\r\nvar value = $event.target.getAttribute(\"data-value\");\r\n//var entityService = widgetContext.entityService\r\n\r\nvar stateParams = widgetContext.stateController.getStateParams()\r\n\r\nvar jwtToken = localStorage.getItem('jwt_token')\r\n\r\nconst relationsHeaders = {\r\n\taccept: \"application/json\",\r\n\t\"Content-Type\": \"application/json\",\r\n\tAuthorization: `Bearer ${jwtToken}`,\r\n}\r\n\r\nconst relationsHeadersContent = {\r\n\tmethod: \"GET\",\r\n\theaders: relationsHeaders\r\n};\r\n\r\n\r\n\t\tfetch(\r\n\t\t\t`https://iotlogiq.com:443/api/tenant/devices?deviceName=${value}`, \r\n\t\t\trelationsHeadersContent\r\n\t\t)\r\n\t\t\t.then((response) => response.json())\r\n\t\t\t.then((data) => {\r\n\t\t\t    entityId = data.id\r\n\t\t\t    \r\n\t\t\t    \r\n                openEditDeviceDialog();\r\n                \r\n                function openEditDeviceDialog() {\r\n                    customDialog\r\n                        .customDialog(htmlTemplate,\r\n                            EditDeviceDialogController)\r\n                        .subscribe();\r\n                }\r\n\t\t\t    \r\n    \t\t\tfunction EditDeviceDialogController(instance) {\r\n                    let vm = instance;\r\n\t\t\t    \r\n\t\t\t        //FLAG\r\n    \t\t\t    var initial_flag = widgetContext.data.find(item => item\r\n                        .dataKey.name ==\r\n                        'enable_asset_status_confirmed' && item\r\n                        .datasource.entityName == data.name).data[0][\r\n                    1] == 'true'\r\n            \r\n                    initial_flag = initial_flag.toString() == 'true' ?\r\n                        true : false\r\n                    vm.flag = initial_flag ? initial_flag : false\r\n                    \r\n                    \r\n                    //STATUS\r\n                    vm.status = false\r\n                    var initial_status = widgetContext.data.find(item => item\r\n                        .dataKey.name ==\r\n                        'asset_status_confirmed' && item\r\n                        .datasource.entityName == data.name).data[0][\r\n                    1] == true || widgetContext.data.find(item => item\r\n                        .dataKey.name ==\r\n                        'asset_status_confirmed' && item\r\n                        .datasource.entityName == data.name).data[0][\r\n                    1] == 'true'\r\n            \r\n                    /*initial_status = initial_status.toString() == 'true' ?\r\n                        true : false*/\r\n                    vm.status = initial_status\r\n                \r\n                \r\n                    vm.device = {};\r\n                \r\n                    vm.editDeviceFormGroup = vm.fb.group({\r\n                        //name: [\"\", [vm.validators.required]],\r\n                        //type: [\"\", [vm.validators.required]],\r\n                        asset_status_confirmed: [false],\r\n                        enable_asset_status_confirmed: [false]\r\n                    });\r\n                \r\n                    getDevice();\r\n                \r\n                    vm.cancel = function() {\r\n                        vm.dialogRef.close(null);\r\n                    };\r\n                \r\n                    vm.onEnableChange = function(e) {\r\n                        vm.flag = vm.flag\r\n                    }\r\n                \r\n                    vm.onChangeStatus = function(e) {\r\n                        vm.status  = e.checked=='true' || e.checked==true ? true : false\r\n                    }\r\n                \r\n                    vm.save = function() {\r\n                        vm.editDeviceFormGroup.markAsPristine();\r\n                        widgetContext.rxjs\r\n                            .forkJoin([\r\n                                saveAttributes(entityId),\r\n                                //saveRelations(entityId),\r\n                                saveDevice(),\r\n                            ])\r\n                            .subscribe(function() {\r\n                                widgetContext.updateAliases();\r\n                                vm.dialogRef.close(null);\r\n                            });\r\n                    };\r\n                    \r\n                    /*var initial_flag = widgetContext.data.find(item => item\r\n                        .dataKey.name ==\r\n                        'enable_asset_status_confirmed' && item\r\n                        .datasource.entityName == entityName).data[0][\r\n                    1] == 'true'\r\n            \r\n                    initial_flag = initial_flag.toString() == 'true' ?\r\n                        true : false\r\n                \r\n                    vm.flag = initial_flag ? initial_flag : false\r\n                    vm.status = null*/\r\n                \r\n                    function getDevice() {\r\n                        deviceService.getDevice(entityId.id).subscribe(\r\n                            function(device) {\r\n                                vm.device = device;\r\n                                vm.editDeviceFormGroup.patchValue({\r\n                                    //name: vm.device.name,\r\n                                    //type: vm.device.type,\r\n                                    /*label: vm.device.label,\r\n                                    notes: widgetContext.data\r\n                                        .find(item => item\r\n                                            .dataKey.name ==\r\n                                            'notes' && item\r\n                                            .datasource\r\n                                            .entityName ==\r\n                                            entityName).data[0][\r\n                                            1\r\n                                        ],*/\r\n                                    asset_status_confirmed: widgetContext.data.find(item=>item.dataKey.name=='asset_status_confirmed' && item.datasource.entityName==entityName).data[0][1],\r\n                                    enable_asset_status_confirmed: initial_flag\r\n                                }, {\r\n                                    emitEvent: false\r\n                                });\r\n                            });\r\n                    }\r\n                \r\n                    function saveAttributes(entityId) {\r\n                        const formValues = vm.editDeviceFormGroup.value;\r\n                        let attributesArray = [];\r\n                        attributesArray.push(\r\n                        {\r\n                            key: \"asset_status_confirmed\",\r\n                            value: formValues\r\n                                .enable_asset_status_confirmed!=false || formValues\r\n                                .enable_asset_status_confirmed!='false' ? vm.status : \"\"\r\n                        }, {\r\n                            key: \"enable_asset_status_confirmed\",\r\n                            value: formValues\r\n                                .enable_asset_status_confirmed\r\n                        });\r\n                        if (attributesArray.length > 0) {\r\n                            return attributeService.saveEntityAttributes(\r\n                                entityId,\r\n                                \"SERVER_SCOPE\",\r\n                                attributesArray\r\n                            );\r\n                        }\r\n                        return widgetContext.rxjs.of([]);\r\n                    }\r\n                \r\n                    function saveDevice() {\r\n                        const formValues = vm.editDeviceFormGroup.value;\r\n                        //vm.device.name = formValues.name;\r\n                        //if (vm.device.type !== formValues.type) {\r\n                        //vm.device.type = formValues.type;\r\n                        //vm.device.deviceProfileId = null;\r\n                        //}\r\n                        //vm.device.label = formValues.label;\r\n                        return deviceService.saveDevice(vm.device);\r\n                    }\r\n                }\r\n\t\t\t})\r\n\t\t\t.catch((error) => console.error(error));\r\n\r\n",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "6178166e-4416-75bc-27ad-e89411ac21a0"
              }, {
                "name" : "filter-pressure-below",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"The pressure is below\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "f52d0835-0875-9f57-861a-91cd0a2265f5"
              }, {
                "name" : "filter-pressure-normal",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"The pressure is normal\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "08203bbf-ce1c-0609-d3bd-42676ee1bf0a"
              }, {
                "name" : "filter-pressure-above",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"The pressure is above\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "ea38f9fc-c865-fad2-916f-e5aa91e3d957"
              }, {
                "name" : "filter-pressure-higher",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "//filterByAssetStatus\n\nvar value = \"The pressure is high\"\n\nconst $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nvar filterByAssetStatus = widgetContext.data.find(item => item.dataKey.name == 'filterByAssetStatus').data[0][1];\n\nif (!filterByAssetStatus) {\n    filterByAssetStatus = [value];\n} else {\n    filterByAssetStatus = JSON.parse(filterByAssetStatus);\n\n    const index = filterByAssetStatus.indexOf(value);\n    if (index != -1) {\n        // The element is in the array, delete it\n        filterByAssetStatus.splice(index, 1);\n    } else {\n        // The element is not in the array, add it\n        filterByAssetStatus.push(value);\n    }\n}\n\nfilterByAssetStatus = filterByAssetStatus;\n\nlet attributesArray = [\n    {key: \"filterByAssetStatus\", value: filterByAssetStatus}\n];\n\nvar entityId = {entityType: 'USER', id: widgetContext.data[1].datasource.entityId}\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "5effe8ca-dabb-46c6-2f57-d60ff470bb37"
              }, {
                "name" : "high-pressure-vals",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "openDashboardState",
                "targetDashboardStateId" : "popup_devices_with_high_pressure",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : false,
                "popoverPreferredPlacement" : "top",
                "popoverHideOnClickOutside" : true,
                "popoverHideDashboardToolbar" : true,
                "popoverWidth" : "600px",
                "popoverHeight" : "400px",
                "popoverStyle" : { },
                "openInSeparateDialog" : false,
                "openInPopover" : true,
                "id" : "b1eca3d5-659b-8129-dd9a-06e31de0191b"
              } ],
              "headerButton" : [ {
                "name" : "Information",
                "icon" : "info",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "openDashboardState",
                "targetDashboardStateId" : "asset_information",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : false,
                "popoverPreferredPlacement" : "top",
                "popoverHideOnClickOutside" : true,
                "popoverHideDashboardToolbar" : true,
                "popoverWidth" : "600px",
                "popoverHeight" : "400px",
                "popoverStyle" : { },
                "openInSeparateDialog" : false,
                "openInPopover" : true,
                "id" : "020aa26a-1dbb-8fac-26a1-4ab08cf9e9cc"
              }, {
                "name" : "deprecated-Bulk",
                "icon" : "power_settings_new",
                "useShowWidgetActionFunction" : true,
                "showWidgetActionFunction" : "return false;",
                "type" : "customPretty",
                "customHtml" : "<form #addEntityForm=\"ngForm\" [formGroup]=\"editDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 420px; background-color: #F1F3FF;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Manual override</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n    \n    <div>\n        <!--<span style=\"color: black;\">Confirm asset status</span><br/>-->\n        <mat-slide-toggle (change)=\"onChangeStatus($event, device.entityName)\" [(ngModel)]=\"status\" [checked]=\"status == true\">\n            Set status to {{status==true ? 'ON' : 'OFF'}}\n        </mat-slide-toggle>\n    </div><br/>\n    \n      <div *ngFor=\"let device of devices\">\n          <mat-checkbox (change)=\"onCheckboxChange($event, device)\">\n            {{ device.entityLabel ? device.entityLabel : device.entityName }}\n        </mat-checkbox>\n          \n      </div>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) ||  selectedDevices.length == 0\">\n      Save device\n    </button>\n  </div>\n</form>\n",
                "customCss" : "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction" : "/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap\n    .get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap\n    .get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap\n    .get('deviceService'));\nlet entityService = $injector.get(widgetContext.servicesMap\n    .get('entityService'));\nlet entityGroupService = $injector.get(widgetContext\n    .servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext\n    .servicesMap.get('entityRelationService'));\n\n\nopenEditDeviceDialog();\n\nfunction openEditDeviceDialog() {\n    customDialog\n        .customDialog(htmlTemplate,\n            EditDeviceDialogController)\n        .subscribe();\n}\n\nfunction EditDeviceDialogController(instance) {\n    let vm = instance\n\n    vm.device = {};\n    \n    vm.status = false\n\n    vm.editDeviceFormGroup = vm.fb.group({\n        assets_on: [[]],\n        assets_off: [[]],\n        flag: [false]\n    });\n    \n    vm.devices = []\n    vm.devices = widgetContext.datasources.slice(1)\n    vm.selectedDevices = []\n    \n    vm.onChangeStatus = function(e, name) {\n        vm.status  = e.checked=='true' || e.checked==true ? true : false\n    }\n    \n    getDevice();\n    \n    function addDevice(device) {\n        vm.editDeviceFormGroup.get('flag').setValue(true);\n        if (vm.selectedDevices.indexOf(device.entityId) === -1) {\n            vm.selectedDevices.push(device.entityId);\n        }\n    }\n    \n    function removeDevice(device) {\n        const index = vm.selectedDevices.indexOf(device.entityId);\n    \n        if (index !== -1) {\n            vm.selectedDevices.splice(index, 1);\n        }\n    }\n    \n    vm.onCheckboxChange = function(event, device) {\n        if (event.checked) {\n            addDevice(device);\n        } else {\n            removeDevice(device);\n        }\n    }\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.onEnableChange = function(e) {\n        vm.flag = vm.flag\n    }\n\n    vm.onChangeStatus = function(e) {\n        vm.status  = e.checked=='true' || e.checked==true ? true : false\n    }\n\n    vm.save = function() {\n        vm.editDeviceFormGroup.markAsPristine();\n        widgetContext.updateAliases();\n        vm.dialogRef.close(null);\n        vm.selectedDevices.forEach(item=>{\n            console.log(item)\n        })\n        /*widgetContext.rxjs\n            .forkJoin([\n                //saveAttributes(entityId),\n                //saveRelations(entityId),\n                //saveDevice(),\n            ])\n            .subscribe(function() {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n            });*/\n    };\n    \n\n    function getDevice() {\n        /*deviceService.getDevice(entityId.id).subscribe(\n            function(device) {\n                vm.device = device;\n                vm.editDeviceFormGroup.patchValue({\n                    asset_status_confirmed: widgetContext.data.find(item=>item.dataKey.name=='asset_status_confirmed' && item.datasource.entityName==entityName).data[0][1],\n                    enable_asset_status_confirmed: initial_flag\n                }, {\n                    emitEvent: false\n                });\n            });*/\n    }\n\n    function saveAttributes(entityId) {\n        /*const formValues = vm.editDeviceFormGroup.value;\n        let attributesArray = [];\n        attributesArray.push()\n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(\n                entityId,\n                \"SERVER_SCOPE\",\n                attributesArray\n            );\n        }\n        return widgetContext.rxjs.of([]);*/\n    }\n\n    function saveDevice() {\n        //const formValues = vm.editDeviceFormGroup.value;\n        //vm.device.name = formValues.name;\n        //if (vm.device.type !== formValues.type) {\n        //vm.device.type = formValues.type;\n        //vm.device.deviceProfileId = null;\n        //}\n        //vm.device.label = formValues.label;\n        //return deviceService.saveDevice(vm.device);\n    }\n}\n\n\n\nfunction openAddEntityDialog() {\n    customDialog.customDialog(htmlTemplate,\n        AddEntityDialogController).subscribe();\n}\n\nfunction AddEntityDialogController(instance) {\n    let vm = instance;\n\n    vm.selectedLongListHeroes = [];\n    vm.unassignedDevices = [];\n\n    vm.selectedCustomer = widgetContext.stateController\n        .getStateParams().currentCustomer;\n    vm.selectedSite = widgetContext.stateController\n        .getStateParams().selectedSite;\n\n    vm.addEntityFormGroup = vm.fb.group({\n        owner_type: ['area'],\n        selectedEntity: [null, [vm.validators.required]],\n        selectedDevices: [null, [vm.validators.required]],\n        searchtext: ['']\n    });\n\n    init();\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n}",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "61e252d5-9987-8329-8c4d-7fa872672bd9"
              }, {
                "name" : "deprecated-Sort by Status",
                "icon" : "sort",
                "useShowWidgetActionFunction" : true,
                "showWidgetActionFunction" : "return false;",
                "type" : "custom",
                "customFunction" : "const $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nvar sortDevicesStatus = widgetContext.data.find(item=>item.dataKey.name=='sortDevicesStatus').data[0][1]\n\nlet attributesArray = [\n    {key: \"sortDevicesStatus\", value: sortDevicesStatus=='desc' ? 'asc' : 'desc'},\n    //{key: \"sortDevicesStatus\", value: \"desc\"}\n];\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "4f4c7b36-9736-d03f-5fe8-359e1a82d579"
              }, {
                "name" : "Deprectad-Show Description",
                "icon" : "visibility",
                "useShowWidgetActionFunction" : true,
                "showWidgetActionFunction" : "return false;",
                "type" : "custom",
                "customFunction" : "const $injector = widgetContext.$injector;\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nvar showDescription = widgetContext.data.find(item=>item.dataKey.name=='showDescription').data[0][1]\n\nlet attributesArray = [\n    {key: \"showDescription\", value: !showDescription},\n    //{key: \"sortDevicesStatus\", value: \"desc\"}\n];\n\nattributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray).subscribe(() => {\n    widgetContext.updateAliases();\n});",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "53987c1a-6ff2-f00e-379b-84306a68d3c2"
              } ]
            },
            "units" : null,
            "borderRadius" : "16px"
          },
          "row" : 0,
          "col" : 0,
          "id" : "eacd4f17-e502-99ac-f9fc-930c1f29eeca"
        },
        "81cd62eb-2713-c805-9597-000101379690" : {
          "typeFullFqn" : "system.cards.markdown_card",
          "type" : "latest",
          "sizeX" : 5,
          "sizeY" : 3.5,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "db7ff95c-2c8c-be42-7d04-db503c8c356d",
              "dataKeys" : [ {
                "name" : "title",
                "type" : "entityField",
                "label" : "Title",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.23278673876621192
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            }, {
              "type" : "device",
              "deviceId" : "948c5700-3fd3-11f0-bbbd-d5b23296cf03",
              "dataKeys" : [ {
                "name" : "chat",
                "type" : "timeseries",
                "label" : "chat",
                "color" : "#4caf50",
                "settings" : { },
                "_hash" : 0.5306040127911112
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1724146213845,
                  "endTimeMs" : 1724232613845
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#EEEEEE",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "",
            "settings" : {
              "useMarkdownTextFunction" : false,
              "markdownTextPattern" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Sidebar Menu</title>\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap\" rel=\"stylesheet\">\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\">\r\n</head>\r\n\r\n<body>\r\n    <div class=\"logo-container\">\r\n        <img src=\"https://mtek3d.com/wp-content/uploads/2018/01/image-placeholder-500x500.jpg\" alt=\"Logo\" class=\"logo\">\r\n    </div>\r\n    <div id=\"customerTitle\" style=\"display:none;\" >${entityName}</div>\r\n    <div class=\"sidebar\">\r\n        <a class=\"menu-item\" id=\"liveApp\">\r\n            <i class=\"fa-solid fa-map\"></i> Live App\r\n        </a>\r\n        <div class=\"menu-item\" id=\"Devices\">\r\n            <i class=\"fas fa-wifi\"></i> Devices\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Reports\" data-action=\"click\">\r\n            <i class=\"fas fa-book\"></i> Reports\r\n            <i class=\"fas fa-chevron-down\" id=\"reportsArrow\" style=\"margin-left:auto;\"></i>\r\n        </div>\r\n        <div class=\"submenu\" id=\"reportsSubmenu\">\r\n            <a id=\"WaterReport\"><i class=\"fa-solid fa-droplet\"></i>Water Salinity Reports</a>\r\n            <a id=\"EnergyReport\"><i class=\"fa-solid fa-bolt\"></i>Energy Reports</a>\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Automated\">\r\n            <i class=\"fa-solid fa-file\"></i> Automated Reports\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Alerts\">\r\n            <i class=\"fas fa-bell\"></i> Alerts\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Contact\">\r\n            <i class=\"fas fa-question-circle\"></i> Contact\r\n        </div>\r\n    </div>\r\n</body>\r\n</html>\r\n",
              "markdownTextFunction" : "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
              "applyDefaultMarkdownStyle" : false,
              "markdownCss" : "body {\r\n    font-family: 'Roboto', sans-serif;\r\n    margin: 0;\r\n    padding: 0;\r\n    background-color: #fff;\r\n}\r\n\r\n.logo-container {\r\n    display: flex;\r\n    justify-content: center; /* Center logo horizontally */\r\n    align-items: center; /* Center logo vertically */\r\n    background-color: #fff; /* Optional: set background color if needed */\r\n    margin: 0; /* Remove margin if using full height */\r\n}\r\n\r\n.logo {\r\n    width: auto; /* Maintain aspect ratio */\r\n    max-width: 100%; /* Ensure logo doesn't exceed the container width */\r\n}\r\n\r\n.sidebar {\r\n    width: 100%; /* Set a fixed width for the sidebar */\r\n    height: 100vh; /* Full height of the viewport */\r\n    background-color: #ffffff;\r\n    padding: 0;\r\n}\r\n\r\n.menu-item {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n    height: 60px; /* Set height to 60px */\r\n    padding: 0 20px; /* Adjust padding to center content horizontally */\r\n    width: 100%;\r\n    color: #333;\r\n    text-decoration: none;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    transition: background-color 0.3s ease;\r\n}\r\n\r\n.menu-item:hover {\r\n    background-color: rgba(235, 96, 96, 0.5); /* 50% opacity */\r\n}\r\n\r\n.menu-item i {\r\n    margin-right: 10px;\r\n}\r\n\r\n.submenu {\r\n    padding-left: 0;\r\n    display: none;\r\n    user-select: none;\r\n}\r\n\r\n.submenu a {\r\n    display: flex;\r\n    align-items: center;\r\n    height: 50px; /* Set height to 50px for submenu items */\r\n    padding: 0 20px;\r\n    font-size: 14px;\r\n    text-decoration: none;\r\n    width: 100%;\r\n    color: #333;\r\n    box-sizing: border-box;\r\n    transition: background-color 0.3s ease;\r\n    background-color: #eee;\r\n    cursor: pointer;\r\n}\r\n\r\n.submenu a i {\r\n    margin-right: 10px;\r\n}\r\n\r\n.submenu a:hover {\r\n    background-color: rgba(235, 96, 96, 0.7); /* 70% opacity */\r\n}\r\n\r\n.rotate {\r\n    transform: rotate(180deg);\r\n}\r\n\r\n#Contact{\r\n    border-top: solid #b8bfd4 1px;\r\n}\r\n"
            },
            "title" : "Markdown/HTML Card",
            "showTitleIcon" : false,
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "24px",
            "titleTooltip" : "",
            "dropShadow" : false,
            "enableFullscreen" : false,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "showLegend" : false,
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true,
            "actions" : {
              "elementClick" : [ {
                "name" : "liveApp",
                "icon" : "map",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "default",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "7ae4f14c-e248-b709-2194-e251d4fb4def"
              }, {
                "name" : "Devices",
                "icon" : "wifi",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "devices",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "d1499cfd-7409-e619-b835-ff1edac50622"
              }, {
                "name" : "Automated",
                "icon" : "description",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "Automated Reports",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "011cac58-e56e-b396-d969-94361e3d8f5a"
              }, {
                "name" : "Alerts",
                "icon" : "notifications",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "alerts",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "24e6e7a0-0adc-b860-7c12-6be7d528142e"
              }, {
                "name" : "Contact",
                "icon" : "help",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "openURL",
                "openNewBrowserTab" : true,
                "url" : "https://www.google.com",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "52b5652f-de35-1ce5-b83e-63bde7f86f51"
              }, {
                "name" : "Reports",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "// Arrays for categorizing customers\r\nvar OnlyWater = [\"Customer A\",];\r\nvar OnlyEnergy = [\"Customer B\", \"Customer C\"];\r\nvar AllReports = [\"Customer D\"];\r\n\r\n// Retrieve the customer_title from the hidden div\r\nvar customerTitle = widgetContext.$container.find('#customerTitle').text().trim();\r\n\r\n// Find the submenu elements\r\nvar waterReport = widgetContext.$container.find('#WaterReport');\r\nvar energyReport = widgetContext.$container.find('#EnergyReport');\r\n\r\n// Find the Reports submenu and arrow\r\nvar reportsSubmenu = widgetContext.$container.find('#reportsSubmenu');\r\nvar reportsArrow = widgetContext.$container.find('#reportsArrow');\r\n\r\n// Toggle the visibility of the submenu directly based on the current state\r\nif (reportsSubmenu.is(':visible')) {\r\n    reportsSubmenu.hide();\r\n    reportsArrow.removeClass('rotate');\r\n} else {\r\n    reportsSubmenu.show();\r\n    reportsArrow.addClass('rotate');\r\n}\r\n\r\n// Determine which report options to show based on the customer title\r\nif (OnlyWater.includes(customerTitle)) {\r\n    waterReport.show();\r\n    energyReport.hide();\r\n} else if (OnlyEnergy.includes(customerTitle)) {\r\n    waterReport.hide();\r\n    energyReport.show();\r\n} else if (AllReports.includes(customerTitle)) {\r\n    waterReport.show();\r\n    energyReport.show();\r\n} else {\r\n    // Default behavior: Show all reports if the customer is not listed in any array\r\n    waterReport.show();\r\n    energyReport.show();\r\n}\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "d5c95e9f-c076-8c41-6b8a-edd6a750070a"
              }, {
                "name" : "WaterReport",
                "icon" : "water_drop",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "reports",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "f9505310-c43c-e0e0-4706-497157b80574"
              }, {
                "name" : "EnergyReport",
                "icon" : "bolt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "Energy Reports",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "7c95a652-62a4-f26e-3631-5477d63c6c3b"
              } ]
            },
            "enableDataExport" : false,
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : ""
          },
          "row" : 0,
          "col" : 0,
          "id" : "81cd62eb-2713-c805-9597-000101379690"
        },
        "b2b1869a-779c-c2d6-83e0-13409f64395c" : {
          "typeFullFqn" : "system.cards.html_value_card",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 3,
          "config" : {
            "datasources" : [ {
              "type" : "device",
              "name" : "",
              "deviceId" : "f4557890-3cd8-11f0-bbbd-d5b23296cf03",
              "entityAliasId" : null,
              "dataKeys" : [ ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1756786906743,
                  "endTimeMs" : 1756873306743
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#fff",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "cardCss" : ".card {\n   width: 100%;\n   height: 100%;\n   border: 2px solid #ccc;\n   box-sizing: border-box;\n}\n\n.card .content {\n   padding: 20px;\n   display: flex;\n   flex-direction: row;\n   align-items: center;\n   justify-content: space-around;\n   height: 100%;\n   box-sizing: border-box;\n}\n\n.card .content .column {\n   display: flex;\n   flex-direction: column;    \n   justify-content: space-around;\n   height: 100%;\n}\n\n.card h1 {\n    text-transform: uppercase;\n    color: #999;\n    font-size: 20px;\n    font-weight: bold;\n    margin: 0;\n    padding-bottom: 10px;\n    line-height: 32px;\n}\n\n.card .value {\n    font-size: 38px;\n    font-weight: 200;\n}\n\n.card .description {\n    font-size: 20px;\n    color: #999;\n}\n",
              "cardHtml" : "<div class='card'>\n    <div class='content'>\n        <div class='column'>\n            <h1>Value title</h1>\n            <div class='value'>\n                ${My value:2} units.\n            </div>    \n            <div class='description'>\n                Value description text\n            </div>\n        </div>\n        <img height=\"80px\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIwIiB3aWR0aD0iMzIwIj48ZyBzdHJva2Utd2lkdGg9IjI4Ij48ZyBmaWxsPSIjMzA1NjgwIiBjb2xvcj0iIzAwMCIgd2hpdGUtc3BhY2U9Im5vcm1hbCI+PHBhdGggc3R5bGU9InRleHQtZGVjb3JhdGlvbi1jb2xvcjojMDAwO2lzb2xhdGlvbjphdXRvO21peC1ibGVuZC1tb2RlOm5vcm1hbDtibG9jay1wcm9ncmVzc2lvbjp0Yjt0ZXh0LWRlY29yYXRpb24tbGluZTpub25lO3RleHQtZGVjb3JhdGlvbi1zdHlsZTpzb2xpZDt0ZXh0LWluZGVudDowO3RleHQtdHJhbnNmb3JtOm5vbmUiIGQ9Ik0xNTEuMTMgMGMtMjguMzYzIDAtNTQuOTE1IDcuOTE1LTc3LjYxMyAyMS41MzdhMzYuNTc4IDM2LjU3OCAwIDAgMC0yMy4wNjctOC4xOTQgOC43NjYgOC43NjYgMCAwIDAtLjAwNCAwYy0yMC4xNTQuMDAxLTM2LjY3OSAxNi41MjgtMzYuNjc4IDM2LjY4MmE4Ljc2NiA4Ljc2NiAwIDAgMCAwIC4wMSAzNi42OSAzNi42OSAwIDAgMCA4LjEwNCAyMi45MjhjLTEzLjgzIDIyLjgzLTIxLjg3IDQ5LjU4LTIxLjg3IDc4LjE3YTguNzY2IDguNzY2IDAgMSAwIDE3LjUzIDBjMC0yNC43MDIgNi43Mi00Ny43NDggMTguMzc5LTY3LjU3NCA0LjU2NiAxLjk4NSA5LjQ3MiAzLjE1IDE0LjUxOSAzLjE1N2E4Ljc2NiA4Ljc2NiAwIDAgMCAuMDEyIDBjMjAuMTU1IDAgMzYuNjgzLTE2LjUyNyAzNi42ODItMzYuNjgyYTguNzY2IDguNzY2IDAgMCAwIDAtLjAwNGMtLjAwMS01LTEuMTM4LTkuODYzLTMuMDgzLTE0LjM5NyAxOS43MTctMTEuNDg0IDQyLjU4NS0xOC4wOTUgNjcuMDg1LTE4LjA5NWE4Ljc2NiA4Ljc2NiAwIDEgMCAwLTE3LjUzek01MC40NCAzMC44OGM1LjkxMy4wMDIgMTEuMTkxIDIuNTEyIDE0LjgzNiA3LjA3N2E4Ljc2NiA4Ljc2NiAwIDAgMCAuMTgzLjIxNCAxOS4xMzcgMTkuMTM3IDAgMCAxIDQuMTM0IDExLjg2M2MtLjAwMiAxMC42NzctOC40NjggMTkuMTQ0LTE5LjE0NCAxOS4xNDhhMTkuMTQ1IDE5LjE0NSAwIDAgMS0xMi00LjI1NCA4Ljc2NiA4Ljc2NiAwIDAgMC0uMDEzLS4wMSAxOS4xMzYgMTkuMTM2IDAgMCAxLTcuMTQ0LTE0Ljg5MmMuMDAzLTEwLjY3NyA4LjQ3LTE5LjE0NCAxOS4xNDgtMTkuMTQ2eiIvPjxwYXRoIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb24tY29sb3I6IzAwMDtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWw7YmxvY2stcHJvZ3Jlc3Npb246dGI7dGV4dC1kZWNvcmF0aW9uLWxpbmU6bm9uZTt0ZXh0LWRlY29yYXRpb24tc3R5bGU6c29saWQ7dGV4dC1pbmRlbnQ6MDt0ZXh0LXRyYW5zZm9ybTpub25lIiBkPSJNNjYuOTkyIDEwMi44M2E4LjE4NyA4LjE4NyAwIDAgMC0yLjI1OCA2LjA3MSA4LjYwNCA4LjYwNCAwIDAgMCAyLjMzOCA1LjUxOGM2LjgwNSA2Ljg1NiAyMC4yMjMgMjAuMjIzIDIwLjIyMyAyMC4yMjNsMTEuODQ0LTExLjgzcy0xMi45NzMtMTIuOTYxLTIwLjE3Ni0yMC4xNzFjLTEuNjA0LTEuNjMyLTMuNzUtMi4zMTQtNi4wMTItMi4zMjRhOC4xNSA4LjE1IDAgMCAwLTUuOTYgMi41MTJ6bTMyLjE0NyAxOS45ODNMNjIuNSAxNTkuNDUyYy0zLjk3NSAzLjk3Ni0zLjk3NSAxMC40MjEgMCAxNC4zOTdsMTguMTU2IDE4LjE1NiAzMS43NTMgMzEuNzUzIDMwLjQ3OCAzMC40NzhjMy45NzYgMy45NzYgMTAuNDIyIDMuOTc2IDE0LjM5OCAwbDI0Ljc5MS0yNC43OTEgMzcuOTE0LTM3LjkxNCAzNi42MzktMzYuNjM5YzMuOTc1LTMuOTc2IDMuOTc1LTEwLjQyMiAwLTE0LjM5OGwtMTguNjMtMTguNjMtMzEuNzUtMzEuNzYtMzAuMDEtMzBjLTMuOTc3LTMuOTc1LTEwLjQyMi0zLjk3NS0xNC4zOTggMGwtMjQuNzkgMjQuNzktMzcuOTEgMzcuOTF6bTM3LjkxMS0zNy45MXMtMTIuOTczLTEyLjk2MS0yMC4xNzYtMjAuMTcxYy0xLjYwNC0xLjYzMi0zLjc1LTIuMzE0LTYuMDEyLTIuMzI0LTQuNzE3LS4wMjMtOC40MzQgMy44NjEtOC4yMTcgOC41ODNhOC42MDQgOC42MDQgMCAwIDAgMi4zMzcgNS41MThjNi44MDUgNi44NTYgMjAuMjIzIDIwLjIyMyAyMC4yMjMgMjAuMjIzbDExLjg0NC0xMS44M3ptNjkuMTkzIDUuMjEzczEyLjk2MS0xMi45NzMgMjAuMTcxLTIwLjE3NmMxLjYzMy0xLjYwNCAyLjMxNC0zLjc1IDIuMzI0LTYuMDEyLjAyMy00LjcxNi0zLjg2MS04LjQzNC04LjU4My04LjIxN2E4LjYwNCA4LjYwNCAwIDAgMC01LjUxOCAyLjMzOGMtNi44NTYgNi44MDUtMjAuMjIzIDIwLjIyMy0yMC4yMjMgMjAuMjIzbDExLjgzIDExLjg0NHptMzEuNzUzIDMxLjc1M3MxMi45NjEtMTIuOTczIDIwLjE3MS0yMC4xNzZjMS42MzMtMS42MDQgMi4zMTQtMy43NSAyLjMyNC02LjAxMi4wMjMtNC43MTYtMy44NjEtOC40MzQtOC41ODMtOC4yMTdhOC42MDQgOC42MDQgMCAwIDAtNS41MTggMi4zMzhjLTYuODU2IDYuODA1LTIwLjIyMyAyMC4yMjMtMjAuMjIzIDIwLjIyM2wxMS44MyAxMS44NDR6bS0xOC4wMDkgNjkuNjY3czEyLjk3MyAxMi45NjEgMjAuMTc4IDIwLjE3YzEuNjA0IDEuNjMyIDMuNzUgMi4zMTMgNi4wMTIgMi4zMjQgNC43MTcuMDIyIDguNDM0LTMuODYyIDguMjE3LTguNTg0bC0uMDAyLjAwMmE4LjYwNiA4LjYwNiAwIDAgMC0yLjMzOC01LjUxOGMtNi44MDUtNi44NTYtMjAuMjIyLTIwLjIyMi0yMC4yMjItMjAuMjIybC0xMS44NDQgMTEuODN6bS0zNy45MTQgMzcuOTE0czEyLjk3MyAxMi45NjEgMjAuMTc4IDIwLjE3YzEuNjA0IDEuNjMyIDMuNzUgMi4zMTMgNi4wMTIgMi4zMjMgNC43MTcuMDIzIDguNDM0LTMuODYxIDguMjE3LTguNTgzaC0uMDAyYTguNjAzIDguNjAzIDAgMCAwLTIuMzM3LTUuNTE4Yy02LjgwNS02Ljg1Ni0yMC4yMjMtMjAuMjIzLTIwLjIyMy0yMC4yMjNsLTExLjg0NCAxMS44M3ptLTY5LjY2Ny01LjY4N3MtMTIuOTYxIDEyLjk3My0yMC4xNjkgMjAuMTc4Yy0xLjYzMiAxLjYwNC0yLjMxNCAzLjc1LTIuMzI0IDYuMDEyLS4wMjMgNC43MTcgMy44NjEgOC40MzQgOC41ODMgOC4yMTdoLS4wMDJhOC42MDIgOC42MDIgMCAwIDAgNS41MTgtMi4zMzdjNi44NTYtNi44MDUgMjAuMjIzLTIwLjIyMyAyMC4yMjMtMjAuMjIzbC0xMS44Mi0xMS44NHptLTMxLjc0My0zMS43NHMtMTIuOTYxIDEyLjk3My0yMC4xNjkgMjAuMTc4Yy0xLjYzMiAxLjYwNC0yLjMxNCAzLjc1LTIuMzI0IDYuMDEyLS4wMjMgNC43MTcgMy44NjEgOC40MzQgOC41ODMgOC4yMTdoLS4wMDJhOC42MDQgOC42MDQgMCAwIDAgNS41MTgtMi4zMzdjNi44NTYtNi44MDUgMjAuMjIzLTIwLjIyMyAyMC4yMjMtMjAuMjIzbC0xMS44My0xMS44NXpNMTY3LjkgMTAxLjQ3YzEuNjgtMS43MDYgMy45NjctMi42NiA2LjI5Ny0yLjYyNmE3Ljg5IDcuODkgMCAwIDEgNC41NjMgMS41MWwxNi40OTkgMTIuMWMzLjIgMi4yOTcgNC4xNDQgNi42NTkgMi4yMyAxMC4zMTItMS45MTMgMy42NTMtNi4xMjMgNS41MjQtOS45NSA0LjQyM2w2LjEyNCAyMy45NDhjMS4xMTMgNC4zNTEtMS41NjQgOC45NjctNS45ODQgMTAuMzE3bC00NC42NDIgMTMuNjMgOC4yNDYgMzEuODg0YzEuMTczIDQuMzctMS41MDIgOS4wNDQtNS45NTUgMTAuNDA3cy04Ljk3NS0xLjExMS0xMC4wNjgtNS41MDVsLTEwLjI4Mi0zOS43N2MtMS4xMjYtNC4zNTUgMS41NS04Ljk4NCA1Ljk3Ni0xMC4zMzdsNDQuNjYxLTEzLjYzNy00LjEyMi0xNi4xMThjLTIuNzYzIDMuMDY0LTcuMjMzIDMuODA4LTEwLjU4NiAxLjc2MS0zLjM1My0yLjA0Ny00LjYxNC02LjI5LTIuOTg2LTEwLjA0N2w4LjExNy0xOS40NTRhOC44NzIgOC44NzIgMCAwIDEgMS44NjMtMi43OTd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBzdHlsZT0idGV4dC1kZWNvcmF0aW9uLWNvbG9yOiMwMDA7aXNvbGF0aW9uOmF1dG87bWl4LWJsZW5kLW1vZGU6bm9ybWFsO2Jsb2NrLXByb2dyZXNzaW9uOnRiO3RleHQtZGVjb3JhdGlvbi1saW5lOm5vbmU7dGV4dC1kZWNvcmF0aW9uLXN0eWxlOnNvbGlkO3RleHQtaW5kZW50OjA7dGV4dC10cmFuc2Zvcm06bm9uZSIgZD0iTTE2OC44NyAzMjAuMDRjMjguMzYzIDAgNTQuOTE1LTcuOTE1IDc3LjYxNC0yMS41MzhhMzYuNTc4IDM2LjU3OCAwIDAgMCAyMy4wNjcgOC4xOTQgOC43NjYgOC43NjYgMCAwIDAgLjAwNCAwYzIwLjE1NSAwIDM2LjY4LTE2LjUyOCAzNi42NzktMzYuNjgyYTguNzY2IDguNzY2IDAgMCAwIDAtLjAxMSAzNi42ODggMzYuNjg4IDAgMCAwLTguMTAzLTIyLjkyN2MxMy44MjUtMjIuODIgMjEuODY2LTQ5LjU3MiAyMS44NjYtNzguMTYyYTguNzY2IDguNzY2IDAgMSAwLTE3LjUzMSAwYzAgMjQuNzAzLTYuNzIgNDcuNzQ5LTE4LjM3OCA2Ny41NzUtNC41NjctMS45ODUtOS40NzMtMy4xNS0xNC41Mi0zLjE1N2E4Ljc2NiA4Ljc2NiAwIDAgMC0uMDEyIDBjLTIwLjE1NS0uMDAxLTM2LjY4MyAxNi41MjctMzYuNjgyIDM2LjY4Mi4wMDIgNC45OTkgMS4xMzkgOS44NjIgMy4wODMgMTQuMzk3LTE5LjcxNyAxMS40ODQtNDIuNTg2IDE4LjA5NS02Ny4wODYgMTguMDk1YTguNzY2IDguNzY2IDAgMSAwIDAgMTcuNTN6bTEwMC42OS0zMC44NzVjLTUuOTEzIDAtMTEuMTkxLTIuNTEyLTE0LjgzNi03LjA3N2E4Ljc2NiA4Ljc2NiAwIDAgMC0uMTgzLS4yMTQgMTkuMTM2IDE5LjEzNiAwIDAgMS00LjEzNC0xMS44NjNjLjAwMi0xMC42NzcgOC40NjgtMTkuMTQ0IDE5LjE0NC0xOS4xNDhhMTkuMTQ1IDE5LjE0NSAwIDAgMSAxMiA0LjI1NCA4Ljc2NiA4Ljc2NiAwIDAgMCAuMDEzLjAxIDE5LjEzNiAxOS4xMzYgMCAwIDEgNy4xNDQgMTQuODkyYy0uMDAzIDEwLjY3Ny04LjQ3IDE5LjE0NS0xOS4xNDggMTkuMTQ2eiIvPjwvZz48L2c+PC9zdmc+\" />\n    </div>\n</div>"
            },
            "title" : "HTML Value Card",
            "dropShadow" : false,
            "enableFullscreen" : true,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "useDashboardTimewindow" : true,
            "showLegend" : false,
            "actions" : {
              "elementClick" : [ ],
              "headerButton" : [ {
                "name" : "location",
                "buttonType" : "icon",
                "icon" : "pin_drop",
                "buttonColor" : "rgba(0, 0, 0, 0.87)",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "// Geolocaliza y guarda en atributos de USUARIO (SERVER_SCOPE)\r\n(() => {\r\n  const SCOPE = 'SERVER_SCOPE'; // cambiá a 'SHARED_SCOPE' si querés shared attrs\r\n  const userRef = { entityType: 'USER', id: widgetContext.currentUser.userId };\r\n\r\n  const save = (key, value) => widgetContext.attributeService\r\n    .saveEntityAttributes(userRef, SCOPE, [{ key, value }])\r\n    .subscribe(\r\n      () => console.log(`OK ${key}=${value}`),\r\n      (e) => console.error(`ERR guardando ${key}`, e)\r\n    );\r\n\r\n  const onSuccess = (pos) => {\r\n    const { latitude, longitude } = pos.coords || {};\r\n    if (typeof latitude !== 'number' || typeof longitude !== 'number') {\r\n      return onError({ code: 'INVALID', message: 'Coordenadas inválidas' });\r\n    }\r\n    save('SearchLatitude', latitude);\r\n    save('SearchLongitude', longitude);\r\n    save('SearchGo', 1);\r\n  };\r\n\r\n  const onError = (err) => {\r\n    const msg = {\r\n      1: 'Permiso denegado',\r\n      2: 'Ubicación no disponible',\r\n      3: 'Timeout',\r\n      INVALID: 'Coordenadas inválidas',\r\n      NO_GEO: 'Geolocalización no soportada'\r\n    }[err.code] || 'Error desconocido';\r\n    console.warn('Geo error:', err, msg);\r\n  };\r\n\r\n  if (!navigator.geolocation) {\r\n    return onError({ code: 'NO_GEO' });\r\n  }\r\n\r\n  navigator.geolocation.getCurrentPosition(onSuccess, onError, {\r\n    enableHighAccuracy: false,\r\n    timeout: 8000,\r\n    maximumAge: 600000 // cache hasta 10 min\r\n  });\r\n})();\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "9d7a6c75-7970-7b45-e393-07d316726971"
              } ]
            },
            "displayTimewindow" : true
          },
          "row" : 0,
          "col" : 0,
          "id" : "b2b1869a-779c-c2d6-83e0-13409f64395c"
        },
        "149e7b15-dffb-2cc4-6196-1a60ac42e51f" : {
          "typeFullFqn" : "system.cards.value_card",
          "type" : "latest",
          "sizeX" : 3,
          "sizeY" : 3,
          "config" : {
            "datasources" : [ {
              "type" : "device",
              "name" : "",
              "deviceId" : "68cd1a60-3e60-11f0-bbbd-d5b23296cf03",
              "dataKeys" : [ {
                "name" : "nivelTanque",
                "type" : "timeseries",
                "label" : "nivelTanque",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.13492509086199211,
                "aggregationType" : "NONE",
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : true,
                "postFuncBody" : "return (value - prevOrigValue) / (time - timePrev) * 60000;"
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1756832852188,
                  "endTimeMs" : 1756919252188
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#EEEEEE",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "layout" : "square",
              "autoScale" : true,
              "showLabel" : true,
              "labelFont" : {
                "family" : "Roboto",
                "size" : 16,
                "sizeUnit" : "px",
                "style" : "normal",
                "weight" : "500",
                "lineHeight" : "1.5"
              },
              "labelColor" : {
                "type" : "constant",
                "color" : "rgba(0, 0, 0, 0.87)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
              },
              "showIcon" : true,
              "iconSize" : 40,
              "iconSizeUnit" : "px",
              "icon" : "thermostat",
              "iconColor" : {
                "type" : "constant",
                "color" : "#5469FF",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
              },
              "valueFont" : {
                "family" : "Roboto",
                "size" : 52,
                "sizeUnit" : "px",
                "style" : "normal",
                "weight" : "500",
                "lineHeight" : "100%"
              },
              "valueColor" : {
                "type" : "constant",
                "color" : "rgba(0, 0, 0, 0.87)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
              },
              "showDate" : true,
              "dateFormat" : {
                "format" : null,
                "lastUpdateAgo" : true,
                "custom" : false,
                "auto" : false
              },
              "dateFont" : {
                "family" : "Roboto",
                "size" : 12,
                "sizeUnit" : "px",
                "style" : "normal",
                "weight" : "500",
                "lineHeight" : "1.33"
              },
              "dateColor" : {
                "type" : "constant",
                "color" : "rgba(0, 0, 0, 0.38)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
              },
              "background" : {
                "type" : "color",
                "imageUrl" : null,
                "color" : "#EEEEEE",
                "overlay" : {
                  "enabled" : false,
                  "color" : "rgba(255,255,255,0.72)",
                  "blur" : 3
                }
              },
              "padding" : ""
            },
            "title" : "Value card",
            "dropShadow" : false,
            "enableFullscreen" : false,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "units" : "°C",
            "decimals" : 3,
            "useDashboardTimewindow" : true,
            "showLegend" : false,
            "widgetStyle" : { },
            "actions" : { },
            "configMode" : "advanced",
            "displayTimewindow" : true,
            "margin" : "0px",
            "borderRadius" : "0px",
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : "",
            "showTitleIcon" : false,
            "titleTooltip" : "",
            "titleFont" : {
              "size" : 12,
              "sizeUnit" : "px",
              "family" : null,
              "weight" : null,
              "style" : null,
              "lineHeight" : "1.6"
            },
            "titleIcon" : "",
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "14px",
            "timewindowStyle" : {
              "showIcon" : true,
              "iconSize" : "14px",
              "icon" : "query_builder",
              "iconPosition" : "left",
              "font" : {
                "size" : 12,
                "sizeUnit" : "px",
                "family" : null,
                "weight" : null,
                "style" : null,
                "lineHeight" : "1"
              },
              "color" : null
            }
          },
          "row" : 0,
          "col" : 0,
          "id" : "149e7b15-dffb-2cc4-6196-1a60ac42e51f"
        },
        "b251de93-f0c3-93cf-d2d0-345fd99be8b8" : {
          "typeFullFqn" : "tenant.chat4",
          "type" : "timeseries",
          "sizeX" : 8,
          "sizeY" : 5,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "d61165fd-70e9-f3b7-c538-c902295ef146",
              "dataKeys" : [ {
                "name" : "chat",
                "type" : "timeseries",
                "label" : "chat",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.5155856113519992
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "realtime" : {
                "timewindowMs" : 60000
              }
            },
            "showTitle" : true,
            "backgroundColor" : "#fff",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "8px",
            "settings" : {
              "shadowSize" : 4,
              "fontColor" : "#545454",
              "fontSize" : 10,
              "xaxis" : {
                "showLabels" : true,
                "color" : "#545454"
              },
              "yaxis" : {
                "showLabels" : true,
                "color" : "#545454"
              },
              "grid" : {
                "color" : "#545454",
                "tickColor" : "#DDDDDD",
                "verticalLines" : true,
                "horizontalLines" : true,
                "outlineWidth" : 1
              },
              "legend" : {
                "show" : true,
                "position" : "nw",
                "backgroundColor" : "#f0f0f0",
                "backgroundOpacity" : 0.85,
                "labelBoxBorderColor" : "rgba(1, 1, 1, 0.45)"
              },
              "decimals" : 1,
              "stack" : false,
              "tooltipIndividual" : false
            },
            "title" : "chat4",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "mobileHeight" : null,
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true
          },
          "row" : 0,
          "col" : 0,
          "id" : "b251de93-f0c3-93cf-d2d0-345fd99be8b8"
        },
        "b9f932d5-a9cc-d56d-7e05-04539206d364" : {
          "typeFullFqn" : "system.cards.markdown_card",
          "type" : "latest",
          "sizeX" : 5,
          "sizeY" : 3.5,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "65a9e3f5-693c-b0fa-72a6-37c2b49e610d",
              "dataKeys" : [ {
                "name" : "name",
                "type" : "entityField",
                "label" : "Nombre",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.18788394870546488
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1757198970022,
                  "endTimeMs" : 1757285370022
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#fff",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "useMarkdownTextFunction" : true,
              "markdownTextPattern" : "var htmlString = '<div class=\"flex-container wrap\">';\r\n\r\nfor (var i =0; i < data.length; i++) {\r\n    htmlString += getDeviceCard(data[i].entityName, data[i].entityId);\r\n}\r\n\r\nhtmlString += '</div>';\r\n\r\nfunction getDeviceCard(deviceName, deviceId) {\r\n    return `\r\n\t<div class=\"flex-item\" >\r\n\t  <div class=\"card\" >\r\n\t\t<div class=\"content\">\r\n\t\t\t<h2>${deviceName.slice(-5)}</h2>\r\n\t\t\t<i class=\"chip\">Vaccant</i>\r\n\t\t</div>\r\n\t\t<div class=\"card-buttons noselect\">\r\n\t\t\t<div id=\"lock\" device-id=\"${deviceId}\" class=\"button button-cancel\"><svg id=\"lock\" device-id=\"${deviceId}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-lock\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect><path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path></svg></div>\r\n\t\t\t<div id=\"unlock\" device-id=\"${deviceId}\" class=\"button button-reply\"><svg id=\"unlock\" device-id=\"${deviceId}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-unlock\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect><path d=\"M7 11V7a5 5 0 0 1 9.9-1\"></path></svg></div>\r\n\t\t\t<div id=\"settings\" device-id=\"${deviceId}\"  class=\"button button-reply\" style=\"border-right: none;\" ><svg id=\"settings\" device-id=\"${deviceId}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-settings\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg></div>\r\n\t  \t </div>\r\n\t  </div>\r\n\t</div>`;\r\n}\r\n\r\nreturn htmlString;\r\n",
              "markdownTextFunction" : "var htmlString = '<div class=\"flex-container wrap\">';\r\n\r\nfor (var i =0; i < data.length; i++) {\r\n    htmlString += getDeviceCard(data[i].entityName, data[i].entityId);\r\n}\r\n\r\nhtmlString += '</div>';\r\n\r\nfunction getDeviceCard(deviceName, deviceId) {\r\n    return `\r\n\t<div class=\"flex-item\" >\r\n\t  <div class=\"card\" >\r\n\t\t<div class=\"content\">\r\n\t\t\t<h2>${deviceName.slice(-5)}</h2>\r\n\t\t\t<i class=\"chip\">Vaccant</i>\r\n\t\t</div>\r\n\t\t<div class=\"card-buttons noselect\">\r\n\t\t\t<div id=\"lock\" device-id=\"${deviceId}\" class=\"button button-cancel\"><svg id=\"lock\" device-id=\"${deviceId}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-lock\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect><path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path></svg></div>\r\n\t\t\t<div id=\"unlock\" device-id=\"${deviceId}\" class=\"button button-reply\"><svg id=\"unlock\" device-id=\"${deviceId}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-unlock\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect><path d=\"M7 11V7a5 5 0 0 1 9.9-1\"></path></svg></div>\r\n\t\t\t<div id=\"settings\" device-id=\"${deviceId}\"  class=\"button button-reply\" style=\"border-right: none;\" ><svg id=\"settings\" device-id=\"${deviceId}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-settings\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg></div>\r\n\t  \t </div>\r\n\t  </div>\r\n\t</div>`;\r\n}\r\n\r\nreturn htmlString;\r\n",
              "applyDefaultMarkdownStyle" : true,
              "markdownCss" : ".flex-container {\r\n    padding: 0;\r\n    margin: 0;\r\n    list-style: none;\r\n\r\n    -ms-box-orient: horizontal;\r\n    display: -webkit-box;\r\n    display: -moz-box;\r\n    display: -ms-flexbox;\r\n    display: -moz-flex;\r\n    display: -webkit-flex;\r\n    display: flex;\r\n}\r\n\r\n.wrap {\r\n    -webkit-flex-wrap: wrap;\r\n    flex-wrap: wrap;\r\n}\r\n\r\n.flex-item {\r\n    margin: 10px;\r\n    font-size: 1em;\r\n}\r\n\r\n/* Clear floats after the columns */\r\n.row:after {\r\n    content: \"\";\r\n    display: table;\r\n    clear: both;\r\n}\r\n\r\n\r\n\r\n/* Style the counter cards */\r\n.card {\r\n    min-width: 325px;\r\n    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);\r\n    padding: 0;\r\n    font-family: 'Poppins', Helvetica, Arial, sans-serif;\r\n\r\n}\r\n\r\n.content {\r\n    padding: 16px;\r\n    text-align: center;\r\n    background-color: white;\r\n}\r\n\r\n.chip {\r\n    border-radius: 6px;\r\n    padding: 2px 6px;\r\n    font-size: 1rem;\r\n    font-weight: 500;\r\n    font-style: normal;\r\n    background-color: #e2e8f0;\r\n    color: #334155;\r\n}\r\n\r\n.noselect {\r\n    -webkit-user-select: none;\r\n    /* Chrome all / Safari all */\r\n    -moz-user-select: none;\r\n    /* Firefox all */\r\n    -ms-user-select: none;\r\n    /* IE 10+ */\r\n    user-select: none;\r\n    /* Likely future */\r\n}\r\n\r\n/* elements */\r\n.button {\r\n    background-color: #FFFFFF;\r\n    color: #999999;\r\n    cursor: pointer;\r\n    float: left;\r\n    font-weight: 500;\r\n    height: 50px;\r\n    line-height: 50px;\r\n    text-align: center;\r\n    text-align: center;\r\n    text-transform: uppercase;\r\n    transition: .3s ease-out;\r\n    width: 33.3%;\r\n    border-right: 2px solid #e6e6e6;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    text-align: center;\r\n\r\n}\r\n\r\n.button:hover {\r\n    background-color: darken(#fdf3e8, 3%);\r\n}\r\n\r\n\r\n.card-buttons {\r\n    border-top: 2px solid #e6e6e6;\r\n    background-color: white;\r\n    overflow: auto;\r\n    -webkit-border-bottom-right-radius: 10px;\r\n    -webkit-border-bottom-left-radius: 10px;\r\n    -moz-border-radius-bottomright: 10px;\r\n    -moz-border-radius-bottomleft: 10px;\r\n    border-bottom-right-radius: 10px;\r\n    border-bottom-left-radius: 10px;\r\n    padding: 0px -16px -16px -16px;\r\n}"
            },
            "title" : "Markdown/HTML Card",
            "showTitleIcon" : false,
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "24px",
            "titleTooltip" : "",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "showLegend" : false,
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true
          },
          "row" : 0,
          "col" : 0,
          "id" : "b9f932d5-a9cc-d56d-7e05-04539206d364"
        },
        "c97cf698-6801-a9a3-c140-f41f767a01eb" : {
          "typeFullFqn" : "system.cards.entities_table",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 6.5,
          "config" : {
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 86400000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1749767094291,
                  "endTimeMs" : 1749853494291
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "NONE",
                "limit" : 200
              }
            },
            "showTitle" : true,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "4px",
            "settings" : {
              "enableSearch" : true,
              "enableSelectColumnDisplay" : true,
              "enableStickyHeader" : true,
              "enableStickyAction" : true,
              "reserveSpaceForHiddenAction" : "true",
              "displayEntityName" : false,
              "displayEntityLabel" : false,
              "displayEntityType" : false,
              "displayPagination" : true,
              "defaultPageSize" : 10,
              "defaultSortOrder" : "name",
              "useRowStyleFunction" : false,
              "entitiesTitle" : "Entities"
            },
            "title" : "REPORTS",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400,
              "padding" : "5px 10px 5px 10px"
            },
            "useDashboardTimewindow" : false,
            "showLegend" : false,
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "deviceId" : null,
              "entityAliasId" : "65a9e3f5-693c-b0fa-72a6-37c2b49e610d",
              "filterId" : null,
              "dataKeys" : [ {
                "name" : "name",
                "type" : "entityField",
                "label" : "Nombre",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.9633712812704178
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "displayTimewindow" : false,
            "configMode" : "advanced",
            "actions" : {
              "actionCellButton" : [ {
                "name" : "report",
                "icon" : "mdi:file-chart",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "customPretty",
                "customHtml" : "<form #reportForm=\"ngForm\" [formGroup]=\"reportFormGroup\"\r\n      (ngSubmit)=\"generateReport()\" class=\"edit-entity-form\">\r\n    <mat-toolbar color=\"primary\">\r\n        <h2>Generar reporte CSV</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n    </mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content fxLayout=\"column\">\r\n        <mat-form-field fxFlex class=\"mat-block\">\r\n            <mat-label>Fecha inicio</mat-label>\r\n            <input matInput [matDatepicker]=\"startPicker\" formControlName=\"startDate\" required>\r\n            <mat-datepicker-toggle matSuffix [for]=\"startPicker\"></mat-datepicker-toggle>\r\n            <mat-datepicker #startPicker></mat-datepicker>\r\n        </mat-form-field>\r\n        <mat-form-field fxFlex class=\"mat-block\">\r\n            <mat-label>Fecha fin</mat-label>\r\n            <input matInput [matDatepicker]=\"endPicker\" formControlName=\"endDate\" required>\r\n            <mat-datepicker-toggle matSuffix [for]=\"endPicker\"></mat-datepicker-toggle>\r\n            <mat-datepicker #endPicker></mat-datepicker>\r\n        </mat-form-field>\r\n        <div style=\"color:#d32f2f;min-height:24px;\">{{status}}</div>\r\n    </div>\r\n    <div mat-dialog-actions fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancelar\r\n        </button>\r\n        <button mat-raised-button color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || reportForm.invalid\">\r\n            Generar reporte\r\n        </button>\r\n    </div>\r\n</form>",
                "customCss" : ".edit-entity-form {\r\n    width: 320px;\r\n}",
                "customFunction" : "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\n\r\nopenReportDialog();\r\n\r\nfunction openReportDialog() {\r\n    customDialog.customDialog(htmlTemplate, ReportDialogController).subscribe();\r\n}\r\n\r\nfunction getDateString(dateObj) {\r\n    if (typeof dateObj === 'string') return dateObj;\r\n    if (dateObj instanceof Date) return dateObj.toISOString().slice(0, 10);\r\n    return '';\r\n}\r\n\r\nfunction ReportDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.status = '';\r\n    vm.isLoading$ = widgetContext.rxjs.of(false);\r\n\r\n    // Solo fechas, sin horas\r\n    vm.reportFormGroup = vm.fb.group({\r\n        startDate: [null, vm.validators.required],\r\n        endDate: [null, vm.validators.required]\r\n    });\r\n\r\n    vm.cancel = function() {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.generateReport = function() {\r\n        vm.status = '';\r\n        if (vm.reportFormGroup.invalid) {\r\n            vm.status = 'Selecciona ambas fechas.';\r\n            return;\r\n        }\r\n        vm.isLoading$ = widgetContext.rxjs.of(true);\r\n\r\n        let startDate = vm.reportFormGroup.get('startDate').value;\r\n        let endDate = vm.reportFormGroup.get('endDate').value;\r\n\r\n        startDate = getDateString(startDate);\r\n        endDate = getDateString(endDate);\r\n\r\n        if (!startDate || !endDate) {\r\n            vm.status = 'Selecciona ambas fechas.';\r\n            vm.isLoading$ = widgetContext.rxjs.of(false);\r\n            if (instance.$scope && instance.$scope.$applyAsync) instance.$scope.$applyAsync();\r\n            return;\r\n        }\r\n\r\n        // Timestamps: inicio del día y fin del día\r\n        const startTs = new Date(`${startDate}T00:00:00`).getTime();\r\n        const endTs = new Date(`${endDate}T23:59:59`).getTime();\r\n\r\n        if (isNaN(startTs) || isNaN(endTs)) {\r\n            vm.status = 'Formato de fecha inválido.';\r\n            vm.isLoading$ = widgetContext.rxjs.of(false);\r\n            if (instance.$scope && instance.$scope.$applyAsync) instance.$scope.$applyAsync();\r\n            return;\r\n        }\r\n\r\n        const deviceId = entityId.id;\r\n        const token = \"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZW5hbnRAdGhpbmdzYm9hcmQub3JnIiwidXNlcklkIjoiZDRiZWMxNDAtM2E5My0xMWYwLTk2ZjQtNjcyZWMxNDQ3YWZhIiwic2NvcGVzIjpbIlRFTkFOVF9BRE1JTiJdLCJzZXNzaW9uSWQiOiI5OTVhZDhlOS1iY2M4LTRlMmEtYTcyMS0wZDAzNjk4YzNlZDkiLCJleHAiOjE3NDk5MjExMjIsImlzcyI6InRoaW5nc2JvYXJkLmlvIiwiaWF0IjoxNzQ5OTEyMTIyLCJlbmFibGVkIjp0cnVlLCJpc1B1YmxpYyI6ZmFsc2UsInRlbmFudElkIjoiZDNlM2EzODAtM2E5My0xMWYwLTk2ZjQtNjcyZWMxNDQ3YWZhIiwiY3VzdG9tZXJJZCI6IjEzODE0MDAwLTFkZDItMTFiMi04MDgwLTgwODA4MDgwODA4MCJ9.usorahH-qf9rIdaOX-nCz4tkXsgcTuAsJKT2DbmLBibPU_2FH_e50UaI9osu3VxrUFLge7krll6sVAaZRiOwqA\";\r\n\r\n        const url = `/api/plugins/telemetry/DEVICE/${deviceId}/values/timeseries?keys=data_batt&startTs=${startTs}&endTs=${endTs}&intervalType=MILLISECONDS&interval=0&limit=1000&useStrictDataTypes=false`;\r\n\r\n        fetch(url, {\r\n            headers: {\r\n                'accept': 'application/json',\r\n                'X-Authorization': 'Bearer ' + token\r\n            }\r\n        })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                return response.text().then(text => { throw new Error(text || 'Error en la API'); });\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(data => {\r\n            if (!data.data_batt || data.data_batt.length === 0) {\r\n                vm.status = 'No hay datos en ese rango.';\r\n                vm.isLoading$ = widgetContext.rxjs.of(false);\r\n                if (instance.$scope && instance.$scope.$applyAsync) instance.$scope.$applyAsync();\r\n                return;\r\n            }\r\n            let csv = 'fecha,hora,data_batt\\n';\r\n            data.data_batt.forEach(item => {\r\n                const dateObj = new Date(item.ts);\r\n                const fecha = dateObj.toLocaleDateString();\r\n                const hora = dateObj.toLocaleTimeString();\r\n                csv += `${fecha},${hora},${item.value}\\n`;\r\n            });\r\n            const blob = new Blob([csv], { type: 'text/csv' });\r\n            const link = document.createElement('a');\r\n            link.href = URL.createObjectURL(blob);\r\n            link.download = 'reporte_telemetria.csv';\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n            vm.status = '¡Reporte generado!';\r\n            vm.isLoading$ = widgetContext.rxjs.of(false);\r\n            if (instance.$scope && instance.$scope.$applyAsync) instance.$scope.$applyAsync();\r\n        })\r\n        .catch(err => {\r\n            vm.status = 'Error: ' + err.message;\r\n            vm.isLoading$ = widgetContext.rxjs.of(false);\r\n            if (instance.$scope && instance.$scope.$applyAsync) instance.$scope.$applyAsync();\r\n        });\r\n    };\r\n}",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "86a773a5-ea0f-f7dc-507c-e2414fb6065c"
              } ]
            },
            "showTitleIcon" : false,
            "titleIcon" : "list",
            "iconColor" : null,
            "titleFont" : null,
            "titleColor" : null,
            "titleTooltip" : "",
            "widgetStyle" : { },
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : ""
          },
          "row" : 0,
          "col" : 0,
          "id" : "c97cf698-6801-a9a3-c140-f41f767a01eb"
        },
        "42786926-b8ab-6eae-2685-003a1ab94240" : {
          "typeFullFqn" : "system.cards.html_value_card",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 3,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "d61165fd-70e9-f3b7-c538-c902295ef146",
              "dataKeys" : [ ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1757270663060,
                  "endTimeMs" : 1757357063060
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#fff",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "cardHtml" : "<div class='card'>\r\n    <div class='content'>\r\n        <div class='column'>\r\n            <h1>GET LOCATION</h1>\r\n             \r\n            <div class='description'>\r\n                Tocar el boton y se asigna lat y lon al user (atributos)\r\n            </div>\r\n        </div>\r\n        <img height=\"80px\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIwIiB3aWR0aD0iMzIwIj48ZyBzdHJva2Utd2lkdGg9IjI4Ij48ZyBmaWxsPSIjMzA1NjgwIiBjb2xvcj0iIzAwMCIgd2hpdGUtc3BhY2U9Im5vcm1hbCI+PHBhdGggc3R5bGU9InRleHQtZGVjb3JhdGlvbi1jb2xvcjojMDAwO2lzb2xhdGlvbjphdXRvO21peC1ibGVuZC1tb2RlOm5vcm1hbDtibG9jay1wcm9ncmVzc2lvbjp0Yjt0ZXh0LWRlY29yYXRpb24tbGluZTpub25lO3RleHQtZGVjb3JhdGlvbi1zdHlsZTpzb2xpZDt0ZXh0LWluZGVudDowO3RleHQtdHJhbnNmb3JtOm5vbmUiIGQ9Ik0xNTEuMTMgMGMtMjguMzYzIDAtNTQuOTE1IDcuOTE1LTc3LjYxMyAyMS41MzdhMzYuNTc4IDM2LjU3OCAwIDAgMC0yMy4wNjctOC4xOTQgOC43NjYgOC43NjYgMCAwIDAtLjAwNCAwYy0yMC4xNTQuMDAxLTM2LjY3OSAxNi41MjgtMzYuNjc4IDM2LjY4MmE4Ljc2NiA4Ljc2NiAwIDAgMCAwIC4wMSAzNi42OSAzNi42OSAwIDAgMCA4LjEwNCAyMi45MjhjLTEzLjgzIDIyLjgzLTIxLjg3IDQ5LjU4LTIxLjg3IDc4LjE3YTguNzY2IDguNzY2IDAgMSAwIDE3LjUzIDBjMC0yNC43MDIgNi43Mi00Ny43NDggMTguMzc5LTY3LjU3NCA0LjU2NiAxLjk4NSA5LjQ3MiAzLjE1IDE0LjUxOSAzLjE1N2E4Ljc2NiA4Ljc2NiAwIDAgMCAuMDEyIDBjMjAuMTU1IDAgMzYuNjgzLTE2LjUyNyAzNi42ODItMzYuNjgyYTguNzY2IDguNzY2IDAgMCAwIDAtLjAwNGMtLjAwMS01LTEuMTM4LTkuODYzLTMuMDgzLTE0LjM5NyAxOS43MTctMTEuNDg0IDQyLjU4NS0xOC4wOTUgNjcuMDg1LTE4LjA5NWE4Ljc2NiA4Ljc2NiAwIDEgMCAwLTE3LjUzek01MC40NCAzMC44OGM1LjkxMy4wMDIgMTEuMTkxIDIuNTEyIDE0LjgzNiA3LjA3N2E4Ljc2NiA4Ljc2NiAwIDAgMCAuMTgzLjIxNCAxOS4xMzcgMTkuMTM3IDAgMCAxIDQuMTM0IDExLjg2M2MtLjAwMiAxMC42NzctOC40NjggMTkuMTQ0LTE5LjE0NCAxOS4xNDhhMTkuMTQ1IDE5LjE0NSAwIDAgMS0xMi00LjI1NCA4Ljc2NiA4Ljc2NiAwIDAgMC0uMDEzLS4wMSAxOS4xMzYgMTkuMTM2IDAgMCAxLTcuMTQ0LTE0Ljg5MmMuMDAzLTEwLjY3NyA4LjQ3LTE5LjE0NCAxOS4xNDgtMTkuMTQ2eiIvPjxwYXRoIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb24tY29sb3I6IzAwMDtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWw7YmxvY2stcHJvZ3Jlc3Npb246dGI7dGV4dC1kZWNvcmF0aW9uLWxpbmU6bm9uZTt0ZXh0LWRlY29yYXRpb24tc3R5bGU6c29saWQ7dGV4dC1pbmRlbnQ6MDt0ZXh0LXRyYW5zZm9ybTpub25lIiBkPSJNNjYuOTkyIDEwMi44M2E4LjE4NyA4LjE4NyAwIDAgMC0yLjI1OCA2LjA3MSA4LjYwNCA4LjYwNCAwIDAgMCAyLjMzOCA1LjUxOGM2LjgwNSA2Ljg1NiAyMC4yMjMgMjAuMjIzIDIwLjIyMyAyMC4yMjNsMTEuODQ0LTExLjgzcy0xMi45NzMtMTIuOTYxLTIwLjE3Ni0yMC4xNzFjLTEuNjA0LTEuNjMyLTMuNzUtMi4zMTQtNi4wMTItMi4zMjRhOC4xNSA4LjE1IDAgMCAwLTUuOTYgMi41MTJ6bTMyLjE0NyAxOS45ODNMNjIuNSAxNTkuNDUyYy0zLjk3NSAzLjk3Ni0zLjk3NSAxMC40MjEgMCAxNC4zOTdsMTguMTU2IDE4LjE1NiAzMS43NTMgMzEuNzUzIDMwLjQ3OCAzMC40NzhjMy45NzYgMy45NzYgMTAuNDIyIDMuOTc2IDE0LjM5OCAwbDI0Ljc5MS0yNC43OTEgMzcuOTE0LTM3LjkxNCAzNi42MzktMzYuNjM5YzMuOTc1LTMuOTc2IDMuOTc1LTEwLjQyMiAwLTE0LjM5OGwtMTguNjMtMTguNjMtMzEuNzUtMzEuNzYtMzAuMDEtMzBjLTMuOTc3LTMuOTc1LTEwLjQyMi0zLjk3NS0xNC4zOTggMGwtMjQuNzkgMjQuNzktMzcuOTEgMzcuOTF6bTM3LjkxMS0zNy45MXMtMTIuOTczLTEyLjk2MS0yMC4xNzYtMjAuMTcxYy0xLjYwNC0xLjYzMi0zLjc1LTIuMzE0LTYuMDEyLTIuMzI0LTQuNzE3LS4wMjMtOC40MzQgMy44NjEtOC4yMTcgOC41ODNhOC42MDQgOC42MDQgMCAwIDAgMi4zMzcgNS41MThjNi44MDUgNi44NTYgMjAuMjIzIDIwLjIyMyAyMC4yMjMgMjAuMjIzbDExLjg0NC0xMS44M3ptNjkuMTkzIDUuMjEzczEyLjk2MS0xMi45NzMgMjAuMTcxLTIwLjE3NmMxLjYzMy0xLjYwNCAyLjMxNC0zLjc1IDIuMzI0LTYuMDEyLjAyMy00LjcxNi0zLjg2MS04LjQzNC04LjU4My04LjIxN2E4LjYwNCA4LjYwNCAwIDAgMC01LjUxOCAyLjMzOGMtNi44NTYgNi44MDUtMjAuMjIzIDIwLjIyMy0yMC4yMjMgMjAuMjIzbDExLjgzIDExLjg0NHptMzEuNzUzIDMxLjc1M3MxMi45NjEtMTIuOTczIDIwLjE3MS0yMC4xNzZjMS42MzMtMS42MDQgMi4zMTQtMy43NSAyLjMyNC02LjAxMi4wMjMtNC43MTYtMy44NjEtOC40MzQtOC41ODMtOC4yMTdhOC42MDQgOC42MDQgMCAwIDAtNS41MTggMi4zMzhjLTYuODU2IDYuODA1LTIwLjIyMyAyMC4yMjMtMjAuMjIzIDIwLjIyM2wxMS44MyAxMS44NDR6bS0xOC4wMDkgNjkuNjY3czEyLjk3MyAxMi45NjEgMjAuMTc4IDIwLjE3YzEuNjA0IDEuNjMyIDMuNzUgMi4zMTMgNi4wMTIgMi4zMjQgNC43MTcuMDIyIDguNDM0LTMuODYyIDguMjE3LTguNTg0bC0uMDAyLjAwMmE4LjYwNiA4LjYwNiAwIDAgMC0yLjMzOC01LjUxOGMtNi44MDUtNi44NTYtMjAuMjIyLTIwLjIyMi0yMC4yMjItMjAuMjIybC0xMS44NDQgMTEuODN6bS0zNy45MTQgMzcuOTE0czEyLjk3MyAxMi45NjEgMjAuMTc4IDIwLjE3YzEuNjA0IDEuNjMyIDMuNzUgMi4zMTMgNi4wMTIgMi4zMjMgNC43MTcuMDIzIDguNDM0LTMuODYxIDguMjE3LTguNTgzaC0uMDAyYTguNjAzIDguNjAzIDAgMCAwLTIuMzM3LTUuNTE4Yy02LjgwNS02Ljg1Ni0yMC4yMjMtMjAuMjIzLTIwLjIyMy0yMC4yMjNsLTExLjg0NCAxMS44M3ptLTY5LjY2Ny01LjY4N3MtMTIuOTYxIDEyLjk3My0yMC4xNjkgMjAuMTc4Yy0xLjYzMiAxLjYwNC0yLjMxNCAzLjc1LTIuMzI0IDYuMDEyLS4wMjMgNC43MTcgMy44NjEgOC40MzQgOC41ODMgOC4yMTdoLS4wMDJhOC42MDIgOC42MDIgMCAwIDAgNS41MTgtMi4zMzdjNi44NTYtNi44MDUgMjAuMjIzLTIwLjIyMyAyMC4yMjMtMjAuMjIzbC0xMS44Mi0xMS44NHptLTMxLjc0My0zMS43NHMtMTIuOTYxIDEyLjk3My0yMC4xNjkgMjAuMTc4Yy0xLjYzMiAxLjYwNC0yLjMxNCAzLjc1LTIuMzI0IDYuMDEyLS4wMjMgNC43MTcgMy44NjEgOC40MzQgOC41ODMgOC4yMTdoLS4wMDJhOC42MDQgOC42MDQgMCAwIDAgNS41MTgtMi4zMzdjNi44NTYtNi44MDUgMjAuMjIzLTIwLjIyMyAyMC4yMjMtMjAuMjIzbC0xMS44My0xMS44NXpNMTY3LjkgMTAxLjQ3YzEuNjgtMS43MDYgMy45NjctMi42NiA2LjI5Ny0yLjYyNmE3Ljg5IDcuODkgMCAwIDEgNC41NjMgMS41MWwxNi40OTkgMTIuMWMzLjIgMi4yOTcgNC4xNDQgNi42NTkgMi4yMyAxMC4zMTItMS45MTMgMy42NTMtNi4xMjMgNS41MjQtOS45NSA0LjQyM2w2LjEyNCAyMy45NDhjMS4xMTMgNC4zNTEtMS41NjQgOC45NjctNS45ODQgMTAuMzE3bC00NC42NDIgMTMuNjMgOC4yNDYgMzEuODg0YzEuMTczIDQuMzctMS41MDIgOS4wNDQtNS45NTUgMTAuNDA3cy04Ljk3NS0xLjExMS0xMC4wNjgtNS41MDVsLTEwLjI4Mi0zOS43N2MtMS4xMjYtNC4zNTUgMS41NS04Ljk4NCA1Ljk3Ni0xMC4zMzdsNDQuNjYxLTEzLjYzNy00LjEyMi0xNi4xMThjLTIuNzYzIDMuMDY0LTcuMjMzIDMuODA4LTEwLjU4NiAxLjc2MS0zLjM1My0yLjA0Ny00LjYxNC02LjI5LTIuOTg2LTEwLjA0N2w4LjExNy0xOS40NTRhOC44NzIgOC44NzIgMCAwIDEgMS44NjMtMi43OTd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBzdHlsZT0idGV4dC1kZWNvcmF0aW9uLWNvbG9yOiMwMDA7aXNvbGF0aW9uOmF1dG87bWl4LWJsZW5kLW1vZGU6bm9ybWFsO2Jsb2NrLXByb2dyZXNzaW9uOnRiO3RleHQtZGVjb3JhdGlvbi1saW5lOm5vbmU7dGV4dC1kZWNvcmF0aW9uLXN0eWxlOnNvbGlkO3RleHQtaW5kZW50OjA7dGV4dC10cmFuc2Zvcm06bm9uZSIgZD0iTTE2OC44NyAzMjAuMDRjMjguMzYzIDAgNTQuOTE1LTcuOTE1IDc3LjYxNC0yMS41MzhhMzYuNTc4IDM2LjU3OCAwIDAgMCAyMy4wNjcgOC4xOTQgOC43NjYgOC43NjYgMCAwIDAgLjAwNCAwYzIwLjE1NSAwIDM2LjY4LTE2LjUyOCAzNi42NzktMzYuNjgyYTguNzY2IDguNzY2IDAgMCAwIDAtLjAxMSAzNi42ODggMzYuNjg4IDAgMCAwLTguMTAzLTIyLjkyN2MxMy44MjUtMjIuODIgMjEuODY2LTQ5LjU3MiAyMS44NjYtNzguMTYyYTguNzY2IDguNzY2IDAgMSAwLTE3LjUzMSAwYzAgMjQuNzAzLTYuNzIgNDcuNzQ5LTE4LjM3OCA2Ny41NzUtNC41NjctMS45ODUtOS40NzMtMy4xNS0xNC41Mi0zLjE1N2E4Ljc2NiA4Ljc2NiAwIDAgMC0uMDEyIDBjLTIwLjE1NS0uMDAxLTM2LjY4MyAxNi41MjctMzYuNjgyIDM2LjY4Mi4wMDIgNC45OTkgMS4xMzkgOS44NjIgMy4wODMgMTQuMzk3LTE5LjcxNyAxMS40ODQtNDIuNTg2IDE4LjA5NS02Ny4wODYgMTguMDk1YTguNzY2IDguNzY2IDAgMSAwIDAgMTcuNTN6bTEwMC42OS0zMC44NzVjLTUuOTEzIDAtMTEuMTkxLTIuNTEyLTE0LjgzNi03LjA3N2E4Ljc2NiA4Ljc2NiAwIDAgMC0uMTgzLS4yMTQgMTkuMTM2IDE5LjEzNiAwIDAgMS00LjEzNC0xMS44NjNjLjAwMi0xMC42NzcgOC40NjgtMTkuMTQ0IDE5LjE0NC0xOS4xNDhhMTkuMTQ1IDE5LjE0NSAwIDAgMSAxMiA0LjI1NCA4Ljc2NiA4Ljc2NiAwIDAgMCAuMDEzLjAxIDE5LjEzNiAxOS4xMzYgMCAwIDEgNy4xNDQgMTQuODkyYy0uMDAzIDEwLjY3Ny04LjQ3IDE5LjE0NS0xOS4xNDggMTkuMTQ2eiIvPjwvZz48L2c+PC9zdmc+\" />\r\n    </div>\r\n</div>",
              "cardCss" : ".card {\n   width: 100%;\n   height: 100%;\n   border: 2px solid #ccc;\n   box-sizing: border-box;\n}\n\n.card .content {\n   padding: 20px;\n   display: flex;\n   flex-direction: row;\n   align-items: center;\n   justify-content: space-around;\n   height: 100%;\n   box-sizing: border-box;\n}\n\n.card .content .column {\n   display: flex;\n   flex-direction: column;    \n   justify-content: space-around;\n   height: 100%;\n}\n\n.card h1 {\n    text-transform: uppercase;\n    color: #999;\n    font-size: 20px;\n    font-weight: bold;\n    margin: 0;\n    padding-bottom: 10px;\n    line-height: 32px;\n}\n\n.card .value {\n    font-size: 38px;\n    font-weight: 200;\n}\n\n.card .description {\n    font-size: 20px;\n    color: #999;\n}\n"
            },
            "title" : "HTML Value Card",
            "dropShadow" : false,
            "enableFullscreen" : true,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "useDashboardTimewindow" : true,
            "showLegend" : false,
            "actions" : {
              "headerButton" : [ {
                "name" : "Get Location",
                "buttonType" : "icon",
                "icon" : "pin_drop",
                "buttonColor" : "rgba(0, 0, 0, 0.87)",
                "customButtonStyle" : { },
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "// Geolocaliza y guarda en atributos de USUARIO (SERVER_SCOPE)\r\n(() => {\r\n  const SCOPE = 'SERVER_SCOPE'; // cambiá a 'SHARED_SCOPE' si querés shared attrs\r\n  const userRef = { entityType: 'USER', id: widgetContext.currentUser.userId };\r\n\r\n  const save = (key, value) => widgetContext.attributeService\r\n    .saveEntityAttributes(userRef, SCOPE, [{ key, value }])\r\n    .subscribe(\r\n      () => console.log(`OK ${key}=${value}`),\r\n      (e) => console.error(`ERR guardando ${key}`, e)\r\n    );\r\n\r\n  const onSuccess = (pos) => {\r\n    const { latitude, longitude } = pos.coords || {};\r\n    if (typeof latitude !== 'number' || typeof longitude !== 'number') {\r\n      return onError({ code: 'INVALID', message: 'Coordenadas inválidas' });\r\n    }\r\n    save('SearchLatitude', latitude);\r\n    save('SearchLongitude', longitude);\r\n    save('SearchGo', 1);\r\n  };\r\n\r\n  const onError = (err) => {\r\n    const msg = {\r\n      1: 'Permiso denegado',\r\n      2: 'Ubicación no disponible',\r\n      3: 'Timeout',\r\n      INVALID: 'Coordenadas inválidas',\r\n      NO_GEO: 'Geolocalización no soportada'\r\n    }[err.code] || 'Error desconocido';\r\n    console.warn('Geo error:', err, msg);\r\n  };\r\n\r\n  if (!navigator.geolocation) {\r\n    return onError({ code: 'NO_GEO' });\r\n  }\r\n\r\n  navigator.geolocation.getCurrentPosition(onSuccess, onError, {\r\n    enableHighAccuracy: false,\r\n    timeout: 8000,\r\n    maximumAge: 600000 // cache hasta 10 min\r\n  });\r\n})();\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "f80221e8-32a3-64b3-3d3e-6480dfcf8a5b"
              } ]
            },
            "displayTimewindow" : true
          },
          "row" : 0,
          "col" : 0,
          "id" : "42786926-b8ab-6eae-2685-003a1ab94240"
        },
        "0715df6d-0b1b-e8a0-3213-6153944ae4a0" : {
          "typeFullFqn" : "system.cards.entities_table",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 6.5,
          "config" : {
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 86400000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1748637797991,
                  "endTimeMs" : 1748724197991
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "NONE",
                "limit" : 200
              }
            },
            "showTitle" : true,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "4px",
            "settings" : {
              "entitiesTitle" : "Dispositivos",
              "enableSearch" : true,
              "enableSelectColumnDisplay" : true,
              "enableStickyHeader" : false,
              "enableStickyAction" : true,
              "showCellActionsMenu" : true,
              "reserveSpaceForHiddenAction" : "true",
              "displayEntityName" : false,
              "entityNameColumnTitle" : "",
              "displayEntityLabel" : false,
              "entityLabelColumnTitle" : "",
              "displayEntityType" : false,
              "displayPagination" : false,
              "defaultPageSize" : 10,
              "pageStepCount" : 3,
              "pageStepIncrement" : 10,
              "defaultSortOrder" : "name",
              "useRowStyleFunction" : false,
              "rowStyleFunction" : ""
            },
            "title" : "Entities table",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400,
              "padding" : "5px 10px 5px 10px"
            },
            "useDashboardTimewindow" : false,
            "showLegend" : false,
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "65a9e3f5-693c-b0fa-72a6-37c2b49e610d",
              "filterId" : null,
              "dataKeys" : [ {
                "name" : "label",
                "type" : "entityField",
                "label" : "Nombre",
                "color" : "#f44336",
                "settings" : { },
                "_hash" : 0.010070857757604412,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              }, {
                "name" : "active",
                "type" : "attribute",
                "label" : "Estado",
                "color" : "#4caf50",
                "settings" : {
                  "customTitle" : "",
                  "columnWidth" : "0px",
                  "useCellStyleFunction" : true,
                  "cellStyleFunction" : "var color;\nif (value === \"true\") {\n    color = 'rgb(39, 134, 34)';\n} else {\n    color = 'rgb(255, 0, 0)';\n}\nreturn {\n    color: color,\n    fontSize: '18px'\n};",
                  "useCellContentFunction" : true,
                  "cellContentFunction" : "value = '&#11044;';\nreturn value;",
                  "defaultColumnVisibility" : "visible",
                  "columnSelectionToDisplay" : "enabled",
                  "disableSorting" : false
                },
                "_hash" : 0.3661306593657292,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              }, {
                "name" : "battVal",
                "type" : "attribute",
                "label" : "Batería",
                "color" : "#f44336",
                "settings" : {
                  "customTitle" : "",
                  "columnWidth" : "0px",
                  "useCellStyleFunction" : false,
                  "cellStyleFunction" : "",
                  "useCellContentFunction" : true,
                  "cellContentFunction" : "if (value || value === 0) {\r\n    let progress = '39, 134, 34, 1'; // verde\r\n    let background = '234, 235, 255, 1';\r\n    let background2 = '240, 235, 255, 1';\r\n    let textColor = '#ffffff';\r\n\r\n    if (value < 25) {\r\n        progress = '209, 39, 48, 1'; // rojo\r\n        textColor = '#000000';\r\n    } else if (value < 70) {\r\n        progress = '255, 213, 102, 1'; // amarillo\r\n        textColor = '#000000';\r\n    }\r\n\r\n    const percent = value + '%';\r\n    const barHeight = '28px';\r\n    const barWidth = '60px';\r\n    const borderRadius = '6px';\r\n\r\n    return `\r\n    <div style=\"display: flex; align-items: center; gap: 6px;\">\r\n        <div style=\"position: relative; display: flex; align-items: center;\">\r\n            <!-- Batería -->\r\n            <div style=\"position: relative; width: ${barWidth}; height: ${barHeight}; background: rgba(${background}); border-radius: ${borderRadius}; overflow: hidden; box-shadow: inset 0 0 2px rgba(0,0,0,0.2);\">\r\n                <div style=\"position: absolute; top: 0; left: 0; width: ${value}%; height: 100%; background: rgba(${progress}); border-radius: ${borderRadius};\"></div>\r\n                <div style=\"position: absolute; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: ${textColor};\">\r\n                    ${parseFloat(value).toFixed(0)}%\r\n                </div>\r\n            </div>\r\n             <!-- Polo positivo (pegado) -->\r\n            <div style=\"width: 6px; height: 9px; background-color: rgba(${background2}); margin-left: 1px; border-radius: 2px;\"></div>\r\n        \r\n    </div>\r\n    `;\r\n} else {\r\n    return 'N/A';\r\n}\r\n",
                  "defaultColumnVisibility" : "visible",
                  "columnSelectionToDisplay" : "enabled",
                  "disableSorting" : false
                },
                "_hash" : 0.4036150317729671,
                "aggregationType" : null,
                "units" : null,
                "decimals" : null,
                "funcBody" : null,
                "usePostProcessing" : null,
                "postFuncBody" : null
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "displayTimewindow" : false,
            "configMode" : "advanced",
            "actions" : {
              "rowClick" : [ {
                "name" : "nav_devDetails",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "var deviceService = widgetContext.deviceService;\n\ndeviceService.getDevice(entityId.id, {\n    ignoreLoading: true\n}).subscribe(\n    function(device) {\n        var deviceType = device.type;\n        var params = {\n            entityId: entityId,\n            entityName: entityName,\n            entityLabel: entityLabel\n        };\n        var targetDashboardStateId;\n        switch (deviceType) {\n            case \"estMeteo\":\n                targetDashboardStateId =\n                    \"estMeteo_details\";\n                break;\n            case \"pozo\":\n                targetDashboardStateId = \"pozo_details\";\n                break;\n            case \"lanza\":\n                targetDashboardStateId =\n                \"lanza_details\";\n                break;\n            case \"comedero\":\n                targetDashboardStateId =\n                \"comedero_details\";\n                break;\n            case \"Freatimetro\":\n                targetDashboardStateId =\n                \"freatimetro_details\"; \n                break;\n            case \"Ultrasonico\":\n                targetDashboardStateId = \"pozo_details\";\n                break;\n\n        }\n        if (targetDashboardStateId) {\n            widgetContext.stateController.updateState(\n                targetDashboardStateId, params,\n                false);\n        }\n    }\n);",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "f69d6e48-030f-98cf-7c5d-2917e9f3dc66"
              } ],
              "actionCellButton" : [ {
                "name" : "Reporte CSV",
                "icon" : "mdi:file-download",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "customPretty",
                "customHtml" : "<form #reportForm=\"ngForm\" [formGroup]=\"reportFormGroup\"\r\n      (ngSubmit)=\"generateReport()\" class=\"edit-entity-form\">\r\n\r\n  <mat-toolbar color=\"primary\">\r\n    <h2>Generar reporte CSV</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\" [disabled]=\"(loading$ | async)\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <!-- Contenedor fijo para no mover layout -->\r\n  <div style=\"height: 4px;\">\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\"\r\n                      *ngIf=\"loading$ | async\"></mat-progress-bar>\r\n  </div>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-form-field fxFlex class=\"mat-block\">\r\n      <mat-label>Fecha inicio</mat-label>\r\n      <input matInput [matDatepicker]=\"startPicker\" formControlName=\"startDate\" required>\r\n      <mat-datepicker-toggle matSuffix [for]=\"startPicker\"></mat-datepicker-toggle>\r\n      <mat-datepicker #startPicker></mat-datepicker>\r\n    </mat-form-field>\r\n\r\n    <mat-form-field fxFlex class=\"mat-block\">\r\n      <mat-label>Fecha fin</mat-label>\r\n      <input matInput [matDatepicker]=\"endPicker\" formControlName=\"endDate\" required>\r\n      <mat-datepicker-toggle matSuffix [for]=\"endPicker\"></mat-datepicker-toggle>\r\n      <mat-datepicker #endPicker></mat-datepicker>\r\n    </mat-form-field>\r\n\r\n    <!-- Estado / Mensajes -->\r\n    <div style=\"min-height:24px;\">\r\n      <span *ngIf=\"status\" style=\"color:#d32f2f;\">{{status}}</span>\r\n      <span *ngIf=\"!status && success\" style=\"color:#2e7d32;\">\r\n        <mat-icon inline style=\"font-size:18px;vertical-align:middle;\">check_circle</mat-icon>\r\n        Reporte generado\r\n      </span>\r\n    </div>\r\n  </div>\r\n\r\n  <div mat-dialog-actions fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(loading$ | async)\"\r\n            (click)=\"cancel()\" cdkFocusInitial>\r\n      Cancelar\r\n    </button>\r\n    <button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(loading$ | async) || reportForm.invalid\">\r\n      <span *ngIf=\"!(loading$ | async)\">Generar reporte</span>\r\n      <span *ngIf=\"loading$ | async\">Generando…</span>\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss" : ".edit-entity-form {\r\n    width: 320px;\r\n}",
                "customFunction" : "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nopenReportDialog();\r\n\r\nfunction openReportDialog() {\r\n  customDialog.customDialog(htmlTemplate, ReportDialogController).subscribe();\r\n}\r\n\r\n/* ============ Config ============ */\r\nconst BUCKET_MS = 60_000;   // agrupar por minuto\r\nconst KEY_BATCH_SIZE = 10;  // cuántas keys por request (evita URLs gigantes)\r\nconst PER_KEY_LIMIT = 200_000; // puntos máximos por key (sobra para 1 año a 1/h)\r\n\r\n/* ============ Auth helpers ============ */\r\nfunction readLocalJwt() {\r\n  try {\r\n    for (const k of ['jwt_token','tb.auth_token','token']) {\r\n      const v = localStorage.getItem(k);\r\n      if (v && typeof v === 'string') return v.replace(/^Bearer\\s+/i,'');\r\n    }\r\n  } catch(_) {}\r\n  return null;\r\n}\r\nfunction isJwtExpired(jwt) {\r\n  try {\r\n    const p = JSON.parse(atob(jwt.split('.')[1].replace(/-/g,'+').replace(/_/g,'/')));\r\n    if (!p?.exp) return false;\r\n    return Math.floor(Date.now()/1000) >= p.exp;\r\n  } catch(_) { return false; }\r\n}\r\nasync function refreshJwtIfPossible() {\r\n  try {\r\n    const res = await fetch('/api/auth/token', { method:'POST', credentials:'include' });\r\n    if (!res.ok) return null;\r\n    const data = await res.json();\r\n    const t = data?.token || data?.jwtToken || null;\r\n    if (t) { try { localStorage.setItem('jwt_token', t); } catch(_) {} }\r\n    return t;\r\n  } catch(_) { return null; }\r\n}\r\nasync function getJwtToken() {\r\n  let t = readLocalJwt();\r\n  if (t && !isJwtExpired(t)) return t;\r\n  const r = await refreshJwtIfPossible();\r\n  return r || t || null;\r\n}\r\nasync function fetchWithAuth(url, options = {}) {\r\n  let jwt = await getJwtToken();\r\n  const headers = new Headers(options.headers || {});\r\n  if (jwt) headers.set('X-Authorization', 'Bearer ' + jwt);\r\n  headers.set('accept', headers.get('accept') || 'application/json');\r\n\r\n  let res = await fetch(url, { ...options, headers });\r\n  if (res.status === 401) {\r\n    const newJwt = await refreshJwtIfPossible();\r\n    if (newJwt) {\r\n      headers.set('X-Authorization', 'Bearer ' + newJwt);\r\n      res = await fetch(url, { ...options, headers });\r\n    }\r\n  }\r\n  console.log(jwt)\r\n  console.log(res)\r\n  return res;\r\n}\r\n\r\n/* ============ Device helpers ============ */\r\nfunction getDeviceId() {\r\n  try {\r\n    if (typeof entityId !== 'undefined' && entityId?.id) return entityId.id;\r\n    const a = widgetContext?.ctx?.stateController?.getEntityId?.();\r\n    if (a?.id) return a.id;\r\n    const b = widgetContext?.ctx?.defaultSubscription?.targetEntity?.id?.id;\r\n    if (b) return b;\r\n    const c = widgetContext?.ctx?.datasources?.[0]?.entity?.id?.id;\r\n    if (c) return c;\r\n  } catch(_) {}\r\n  return null;\r\n}\r\nasync function getDeviceLabelOrName(deviceId) {\r\n  try {\r\n    const res = await fetchWithAuth(`/api/device/${deviceId}`);\r\n    if (!res.ok) return 'dispositivo';\r\n    const dev = await res.json();\r\n    return (dev?.label && String(dev.label).trim()) || dev?.name || 'dispositivo';\r\n  } catch(_) { return 'dispositivo'; }\r\n}\r\n\r\n/* ============ Fechas ============ */\r\nfunction getDateString(v) {\r\n  if (typeof v === 'string') return v;\r\n  if (v instanceof Date) return v.toISOString().slice(0,10);\r\n  return '';\r\n}\r\nfunction normalizeDateString(input) {\r\n  if (!input) return '';\r\n  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(input)) return input; // YYYY-MM-DD\r\n  const m = String(input).match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/); // DD/MM/YYYY\r\n  if (m) return `${m[3]}-${m[2]}-${m[1]}`;\r\n  const d = new Date(input);\r\n  return isNaN(d) ? '' : d.toISOString().slice(0,10);\r\n}\r\nfunction toDDMMYYYY(iso) { // 'YYYY-MM-DD' -> 'dd-mm-aaaa'\r\n  const [y,m,d] = iso.split('-');\r\n  return `${d}-${m}-${y}`;\r\n}\r\nfunction pad2(n){ return String(n).padStart(2,'0'); }\r\nfunction fmtIsoLocalMinute(ts) { // 'YYYY-MM-DD HH:mm'\r\n  const d = new Date(ts);\r\n  return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())} `\r\n       + `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;\r\n}\r\n\r\n/* ============ visibleKeys SOLO SERVER_SCOPE ============ */\r\nasync function getServerVisibleKeys(deviceId) {\r\n  const url = `/api/plugins/telemetry/DEVICE/${deviceId}/values/attributes?serverKeys=visibleKeys`;\r\n  const res = await fetchWithAuth(url);\r\n  if (!res.ok) throw new Error('No se pudo leer visibleKeys (SERVER_SCOPE)');\r\n  const data = await res.json();\r\n\r\n  let items = [];\r\n  if (Array.isArray(data)) items = data;\r\n  else if (Array.isArray(data.server)) items = data.server;\r\n\r\n  const it = items.find(x => x?.key === 'visibleKeys' && x?.value);\r\n  if (!it) throw new Error('visibleKeys no existe en SERVER_SCOPE');\r\n  let vk = typeof it.value === 'string' ? JSON.parse(it.value) : it.value;\r\n  if (!vk || typeof vk !== 'object' || !Object.keys(vk).length) {\r\n    throw new Error('visibleKeys (SERVER_SCOPE) está vacío');\r\n  }\r\n\r\n  const keys = Object.keys(vk);\r\n  const meta = {};\r\n  keys.forEach(k => {\r\n    const o = vk[k] || {};\r\n    meta[k] = { label: o.label || k, unit: o.unit || '' };\r\n  });\r\n  return { keys, meta };\r\n}\r\n\r\n/* ============ Fetch único por key (o lote), SIN interval ni agg ============ */\r\n/**\r\n * Devuelve series crudas dentro del rango, en lotes de keys, con limit alto.\r\n * { key1:[{ts,value},...], key2:[...], ... }\r\n */\r\nasync function fetchTimeseriesRaw(deviceId, keys, startTs, endTs, keyBatchSize = KEY_BATCH_SIZE, perKeyLimit = PER_KEY_LIMIT) {\r\n  const out = {};\r\n  keys.forEach(k => out[k] = []);\r\n\r\n  for (let i = 0; i < keys.length; i += keyBatchSize) {\r\n    const group = keys.slice(i, i + keyBatchSize);\r\n\r\n    const url = `/api/plugins/telemetry/DEVICE/${deviceId}/values/timeseries`\r\n      + `?keys=${encodeURIComponent(group.join(','))}`\r\n      + `&startTs=${startTs}&endTs=${endTs}`\r\n      + `&limit=${perKeyLimit}`   // trae TODO en un solo tiro por key\r\n      + `&useStrictDataTypes=false`;\r\n\r\n    const res = await fetchWithAuth(url);\r\n   \r\n    if (!res.ok) {\r\n      const txt = await res.text();\r\n      throw new Error(txt || `Error ${res.status} en Telemetry`);\r\n    }\r\n    const chunk = await res.json();\r\n\r\n    for (const k of group) {\r\n      const arr = Array.isArray(chunk?.[k]) ? chunk[k] : [];\r\n      if (arr.length) out[k] = out[k].concat(arr);\r\n    }\r\n  }\r\n\r\n  // ordenar por ts\r\n  for (const k of keys) out[k].sort((a,b)=>a.ts - b.ts);\r\n  return out;\r\n}\r\n\r\n/* ============ Bucket por minuto y CSV ============ */\r\nfunction bucketTsMin(ts) {\r\n  return Math.floor(ts / BUCKET_MS) * BUCKET_MS;\r\n}\r\n\r\nfunction buildCsvBucketed(seriesByKey, keys, meta) {\r\n  const headers = [\r\n    'fecha',\r\n    'hora',\r\n    'fecha hora', // YYYY-MM-DD HH:mm\r\n    ...keys.map(k => {\r\n      const {label, unit} = meta[k] || {label:k, unit:''};\r\n      return unit ? `${label} (${unit})` : label;\r\n    })\r\n  ];\r\n\r\n  // mapear último valor por minuto\r\n  const maps = {};\r\n  const bucketSet = new Set();\r\n\r\n  for (const k of keys) {\r\n    const m = new Map();\r\n    for (const p of (seriesByKey[k] || [])) {\r\n      const b = bucketTsMin(p.ts);\r\n      m.set(b, p.value);      // queda el último del minuto\r\n      bucketSet.add(b);\r\n    }\r\n    maps[k] = m;\r\n  }\r\n\r\n  const buckets = Array.from(bucketSet).sort((a,b)=>a-b);\r\n\r\n  let csv = headers.join(',') + '\\n';\r\n  for (const b of buckets) {\r\n    const d = new Date(b);\r\n    const fecha = d.toLocaleDateString();\r\n    const hora  = `${pad2(d.getHours())}:${pad2(d.getMinutes())}`; // estable para gráficos\r\n    const fh    = fmtIsoLocalMinute(b);\r\n    const row = [\r\n      fecha,\r\n      hora,\r\n      fh,\r\n      ...keys.map(k => maps[k].has(b) ? maps[k].get(b) : '')\r\n    ];\r\n    csv += row.join(',') + '\\n';\r\n  }\r\n  return csv;\r\n}\r\n\r\n/* ============ Dialog Controller ============ */\r\nfunction ReportDialogController(instance) {\r\n  const vm = instance;\r\n\r\n  // Loading reactivo y flags de UI\r\n  vm.loading$ = new widgetContext.rxjs.BehaviorSubject(false);\r\n  vm.status = '';\r\n  vm.success = false;\r\n\r\n  vm.reportFormGroup = vm.fb.group({\r\n    startDate: [null, vm.validators.required],\r\n    endDate:   [null, vm.validators.required]\r\n  });\r\n\r\n  vm.cancel = () => vm.dialogRef.close(null);\r\n\r\n  vm.generateReport = async function () {\r\n    vm.status = '';\r\n    vm.success = false;\r\n    vm.loading$.next(true);\r\n\r\n    try {\r\n      if (vm.reportFormGroup.invalid) {\r\n        vm.status = 'Selecciona ambas fechas.';\r\n        return;\r\n      }\r\n\r\n      // === Fechas ===\r\n      const startRaw  = vm.reportFormGroup.get('startDate').value;\r\n      const endRaw    = vm.reportFormGroup.get('endDate').value;\r\n      const startDate = getDateString(startRaw) || normalizeDateString(String(startRaw||''));\r\n      const endDate   = getDateString(endRaw)   || normalizeDateString(String(endRaw||''));\r\n      if (!startDate || !endDate) {\r\n        vm.status = 'Selecciona ambas fechas.';\r\n        return;\r\n      }\r\n      const startTs = new Date(`${startDate}T00:00:00`).getTime();\r\n      const endTs   = new Date(`${endDate}T23:59:59`).getTime();\r\n      if (isNaN(startTs) || isNaN(endTs)) {\r\n        vm.status = 'Formato de fecha inválido.';\r\n        return;\r\n      }\r\n\r\n      // === Device & visibleKeys (SERVER_SCOPE) ===\r\n      const deviceId    = getDeviceId();\r\n      if (!deviceId) { vm.status = 'No se pudo resolver el Device ID.'; return; }\r\n      const deviceLabel = await getDeviceLabelOrName(deviceId);\r\n      const { keys, meta } = await getServerVisibleKeys(deviceId);\r\n\r\n      // === Telemetría cruda en lotes (rápido) ===\r\n      const seriesByKey = await fetchTimeseriesRaw(deviceId, keys, startTs, endTs, KEY_BATCH_SIZE, PER_KEY_LIMIT);\r\n      const hasAny = keys.some(k => (seriesByKey[k]||[]).length > 0);\r\n      if (!hasAny) { vm.status = 'No hay datos en ese rango.'; return; }\r\n\r\n      // === CSV bucketizado por minuto + columna \"fecha hora\" ===\r\n      const csvCore = buildCsvBucketed(seriesByKey, keys, meta);\r\n\r\n      // === Blob y nombre de archivo (¡definidos acá!)\r\n      const BOM = '\\uFEFF';\r\n      const blob = new Blob([BOM + csvCore], { type: 'text/csv;charset=utf-8' });\r\n      const prettyStart = toDDMMYYYY(startDate); // dd-mm-aaaa\r\n      const prettyEnd   = toDDMMYYYY(endDate);\r\n      const safeLabel   = String(deviceLabel).trim().replace(/[^\\w\\s\\-\\.]/g, '').replace(/\\s+/g,'_');\r\n      const fileName    = `${safeLabel}_reporte_${prettyStart}_a_${prettyEnd}.csv`;\r\n\r\n      // === Apagar loading ANTES del click, mostrar éxito y refrescar UI ===\r\n      vm.loading$.next(false);\r\n      vm.success = true;\r\n      instance.$scope?.$applyAsync?.();\r\n      await Promise.resolve(); // yieldea 1 tick para que Angular pinte\r\n\r\n      // === Disparar descarga ===\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = fileName;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n\r\n      // Limpieza y cierre (deja que el click salga primero)\r\n      setTimeout(() => {\r\n        try { URL.revokeObjectURL(url); } catch(_) {}\r\n        try { document.body.removeChild(a); } catch(_) {}\r\n        // cerrar el diálogo automáticamente\r\n        vm.dialogRef.close({ ok: true, fileName });\r\n      }, 2000);\r\n\r\n    } catch (err) {\r\n      vm.status = 'Error: ' + (err?.message || err);\r\n    } finally {\r\n      // asegurar que quede apagado si hubo early return con error\r\n      if (vm.loading$.getValue()) vm.loading$.next(false);\r\n      instance.$scope?.$applyAsync?.();\r\n    }\r\n  };\r\n}\r\n\r\n",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "6cb03410-b1ae-35bc-1273-9f0836c96bf3"
              } ]
            },
            "showTitleIcon" : false,
            "titleIcon" : "list",
            "iconColor" : null,
            "titleFont" : null,
            "titleColor" : null
          },
          "row" : 0,
          "col" : 0,
          "id" : "0715df6d-0b1b-e8a0-3213-6153944ae4a0"
        },
        "37e61454-97b3-a8cd-bf64-85788b76efb5" : {
          "typeFullFqn" : "system.cards.markdown_card",
          "type" : "latest",
          "sizeX" : 5,
          "sizeY" : 3.5,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "db7ff95c-2c8c-be42-7d04-db503c8c356d",
              "dataKeys" : [ {
                "name" : "title",
                "type" : "entityField",
                "label" : "Title",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.23278673876621192
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1724146213845,
                  "endTimeMs" : 1724232613845
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#FFFFFF",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "",
            "settings" : {
              "useMarkdownTextFunction" : false,
              "markdownTextPattern" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Sidebar Menu</title>\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap\" rel=\"stylesheet\">\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\">\r\n</head>\r\n\r\n<body>\r\n    <div class=\"logo-container\">\r\n        <img src=\"/api/images/public/eccgkajobndCxIy5sq6CzrRsqVljRfM\" alt=\"Logo\" class=\"logo\">\r\n    </div>\r\n    <div id=\"customerTitle\" style=\"display:none;\" >${entityName}</div>\r\n    <div class=\"sidebar\">\r\n        <a class=\"menu-item\" id=\"liveApp\">\r\n            <i class=\"fa-solid fa-map\"></i> Mapa\r\n        </a>\r\n        <div class=\"menu-item\" id=\"Devices\">\r\n            <i class=\"fas fa-wifi\"></i> Dispositivos\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Reports\" data-action=\"click\">\r\n            <i class=\"fas fa-book\"></i> Reports\r\n            <i class=\"fas fa-chevron-down\" id=\"reportsArrow\" style=\"margin-left:auto;\"></i>\r\n        </div>\r\n        <div class=\"submenu\" id=\"reportsSubmenu\">\r\n            <a id=\"WaterReport\"><i class=\"fa-solid fa-droplet\"></i>Water Salinity Reports</a>\r\n            <a id=\"EnergyReport\"><i class=\"fa-solid fa-bolt\"></i>Energy Reports</a>\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Automated\">\r\n            <i class=\"fa-solid fa-file\"></i> Automated Reports\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Alerts\">\r\n            <i class=\"fas fa-bell\"></i> Alertas\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Settings\">\r\n            <i class=\"fas fa-gear\"></i> Ajustes\r\n        </div>\r\n        <div class=\"menu-item\" id=\"Contact\">\r\n            <i class=\"fas fa-question-circle\"></i> Contacto\r\n        </div>\r\n    </div>\r\n</body>\r\n</html>\r\n",
              "markdownTextFunction" : "// === Mapeo itemId → stateId (AJUSTAR A TU DASHBOARD) ===\r\nconst stateMap = {\r\n  liveApp:     'default',\r\n  Devices:     'devices',\r\n  Reports:     null, // solo expande submenú\r\n  WaterReport: 'water_report_state',\r\n  EnergyReport:'energy_report_state',\r\n  Automated:   'automated_reports_state',\r\n  Alerts:      'alarms',\r\n  Contact:     'contact_state'\r\n};\r\n\r\n// ID único para este render (evita choques si hay varios widgets)\r\nconst uid = 'sb_' + Math.random().toString(36).slice(2);\r\n\r\n// HTML (sin <script> y sin href que cambie la URL)\r\nconst html =\r\n  '<div id=\"'+uid+'\" class=\"sidebar\">' +\r\n\r\n    '<a class=\"menu-item\" data-item=\"liveApp\">' +\r\n      '<i class=\"fa-solid fa-map\"></i> Mapa' +\r\n    '</a>' +\r\n\r\n    '<div class=\"menu-item\" data-item=\"Devices\">' +\r\n      '<i class=\"fas fa-wifi\"></i> Devices' +\r\n    '</div>' +\r\n\r\n    '<div class=\"menu-item\" data-item=\"Reports\" data-expand=\"reportsSubmenu\">' +\r\n      '<i class=\"fas fa-book\"></i> Reports' +\r\n      '<i class=\"fas fa-chevron-down\" style=\"margin-left:auto;\"></i>' +\r\n    '</div>' +\r\n\r\n    '<div class=\"submenu\" id=\"reportsSubmenu\">' +\r\n      '<a data-item=\"WaterReport\"><i class=\"fa-solid fa-droplet\"></i> Water Salinity Reports</a>' +\r\n      '<a data-item=\"EnergyReport\"><i class=\"fa-solid fa-bolt\"></i> Energy Reports</a>' +\r\n    '</div>' +\r\n\r\n    '<div class=\"menu-item\" data-item=\"Automated\">' +\r\n      '<i class=\"fa-solid fa-file\"></i> Automated Reports' +\r\n    '</div>' +\r\n\r\n    '<div class=\"menu-item\" data-item=\"Alerts\">' +\r\n      '<i class=\"fas fa-bell\"></i> Alerts' +\r\n    '</div>' +\r\n\r\n    '<div class=\"menu-item\" data-item=\"Contact\">' +\r\n      '<i class=\"fas fa-question-circle\"></i> Contact' +\r\n    '</div>' +\r\n\r\n  '</div>';\r\n\r\n// Bind de eventos después de que TB inserta el HTML\r\nsetTimeout(function () {\r\n  const root = document.getElementById(uid);\r\n  if (!root || root.__bound) return;\r\n  root.__bound = true;\r\n\r\n  const submenu = root.querySelector('#reportsSubmenu');\r\n\r\n  function clearActive() {\r\n    root.querySelectorAll('.active').forEach(n => {\r\n      n.classList.remove('active');\r\n      n.setAttribute('aria-disabled', 'false');\r\n    });\r\n  }\r\n  function setActive(el) {\r\n    clearActive();\r\n    el.classList.add('active');\r\n    el.setAttribute('aria-disabled', 'true');\r\n  }\r\n  function openStateFor(itemId) {\r\n    const stateId = stateMap[itemId];\r\n    if (!stateId) return; // p.ej. Reports\r\n    try {\r\n      // usa ctx del scope de la función de valor\r\n      if (ctx && ctx.stateController && typeof ctx.stateController.openState === 'function') {\r\n        ctx.stateController.openState(stateId);\r\n        return;\r\n      }\r\n      if (ctx && ctx.actionsApi && typeof ctx.actionsApi.openDashboard === 'function') {\r\n        ctx.actionsApi.openDashboard(null, { stateId }, { openInDialog: false });\r\n      }\r\n    } catch (e) { /* silencioso */ }\r\n  }\r\n\r\n  // Delegación de clicks (sin cambiar la URL)\r\n  root.addEventListener('click', function (e) {\r\n    const item = e.target.closest('[data-item]');\r\n    if (!item || !root.contains(item)) return;\r\n    const id = item.getAttribute('data-item');\r\n\r\n    // Toggle Reports (expansor)\r\n    if (id === 'Reports') {\r\n      e.preventDefault();\r\n      submenu && submenu.classList.toggle('open');\r\n      setActive(item);\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    setActive(item);\r\n    openStateFor(id);\r\n  });\r\n\r\n  // Activo inicial (opcional)\r\n  const initial = root.querySelector('[data-item=\"Devices\"]');\r\n  if (initial) {\r\n    setActive(initial);\r\n    // openStateFor('Devices'); // descomentá si querés abrir al cargar\r\n  }\r\n}, 0);\r\n\r\n// devolver el HTML al widget\r\nreturn html;\r\n",
              "applyDefaultMarkdownStyle" : false,
              "markdownCss" : "/* Mantener oculto el logo */\r\n.logo-container { display:none !important; margin:0 !important; padding:0 !important; }\r\n\r\n/* Base */\r\nbody {\r\n    font-family: 'Roboto', sans-serif;\r\n    margin: 0;\r\n    padding: 0;\r\n    background-color: #fff;\r\n}\r\n\r\n/* (Tu bloque extra de logo no es necesario si está oculto) */\r\n/* .logo-container { ... }  — eliminado */\r\n\r\n/* .logo { ... } — innecesario si no se muestra el logo */\r\n/* .logo { width:auto; max-width:100%; } */\r\n\r\n.sidebar {\r\n    width: 100%;\r\n    height: 100vh;\r\n    background-color: #ffffff;\r\n    padding: 0;\r\n}\r\n\r\n/* Ítems de menú */\r\n.menu-item, .submenu a {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n    height: 60px;              /* 50px en submenú abajo */\r\n    padding: 0 20px;\r\n    width: 100%;\r\n    color: #333;\r\n    text-decoration: none;\r\n    font-size: 16px;           /* 14px en submenú abajo */\r\n    cursor: pointer;\r\n    transition: background-color 0.3s ease, color .2s ease;\r\n    box-sizing: border-box;\r\n}\r\n\r\n.menu-item:hover,\r\n.submenu a:hover {\r\n    background-color: rgba(235, 235, 235, 0.5); /* 50% opacity */\r\n}\r\n\r\n.menu-item i,\r\n.submenu a i {\r\n    margin-right: 10px;\r\n}\r\n\r\n/* Submenú */\r\n.submenu {\r\n    padding-left: 0;\r\n    display: none;             /* oculto por defecto */\r\n    user-select: none;\r\n    flex-direction: column;\r\n}\r\n\r\n.submenu a {\r\n    height: 50px;\r\n    font-size: 14px;\r\n    background-color: #eee;\r\n    transition: background-color 0.3s ease, color .2s ease;\r\n}\r\n\r\n.submenu a:hover {\r\n    background-color: rgba(235, 96, 96, 0.7); /* 70% opacity */\r\n}\r\n\r\n/* Flecha rotada cuando Reports está activo (si usás el ícono con ese id) */\r\n#Reports:target + #reportsSubmenu + .menu-item .fa-chevron-down,\r\n#Reports:target .fa-chevron-down {\r\n    transform: rotate(180deg);\r\n}\r\n\r\n/* Abrir submenú cuando \"Reports\" es el :target */\r\n#Reports:target + #reportsSubmenu {\r\n    display: flex;\r\n}\r\n\r\n/* Estado ACTIVO usando :target (hash) */\r\n.menu-item:target,\r\n.submenu a:target {\r\n    background: #1f6feb;\r\n    color: #fff;\r\n}\r\n\r\n/* Deshabilitado visual mientras está activo */\r\n.menu-item:target,\r\n.submenu a:target {\r\n    pointer-events: none;      /* no clickeable mientras activo */\r\n    cursor: default;\r\n}\r\n\r\n/* Borde superior en Contact (lo mantenemos) */\r\n#Settings{\r\n    border-top: solid #b8bfd4 1px;\r\n}\r\n"
            },
            "title" : "Markdown/HTML Card",
            "showTitleIcon" : false,
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "24px",
            "titleTooltip" : "",
            "dropShadow" : false,
            "enableFullscreen" : false,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "showLegend" : false,
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true,
            "actions" : {
              "elementClick" : [ {
                "name" : "liveApp",
                "icon" : "map",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "default",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : false,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "7ae4f14c-e248-b709-2194-e251d4fb4def"
              }, {
                "name" : "Devices",
                "icon" : "wifi",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "devices",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : false,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "d1499cfd-7409-e619-b835-ff1edac50622"
              }, {
                "name" : "Automated",
                "icon" : "description",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "Automated Reports",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "011cac58-e56e-b396-d969-94361e3d8f5a"
              }, {
                "name" : "Alerts",
                "icon" : "notifications",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "alarms",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "24e6e7a0-0adc-b860-7c12-6be7d528142e"
              }, {
                "name" : "Contact",
                "icon" : "help",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "openURL",
                "openNewBrowserTab" : true,
                "url" : "https://www.google.com",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "52b5652f-de35-1ce5-b83e-63bde7f86f51"
              }, {
                "name" : "Reports",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "custom",
                "customFunction" : "// Arrays for categorizing customers\r\nvar OnlyWater = [\"Customer A\",];\r\nvar OnlyEnergy = [\"Customer B\", \"Customer C\"];\r\nvar AllReports = [\"Customer D\"];\r\n\r\n// Retrieve the customer_title from the hidden div\r\nvar customerTitle = widgetContext.$container.find('#customerTitle').text().trim();\r\n\r\n// Find the submenu elements\r\nvar waterReport = widgetContext.$container.find('#WaterReport');\r\nvar energyReport = widgetContext.$container.find('#EnergyReport');\r\n\r\n// Find the Reports submenu and arrow\r\nvar reportsSubmenu = widgetContext.$container.find('#reportsSubmenu');\r\nvar reportsArrow = widgetContext.$container.find('#reportsArrow');\r\n\r\n// Toggle the visibility of the submenu directly based on the current state\r\nif (reportsSubmenu.is(':visible')) {\r\n    reportsSubmenu.hide();\r\n    reportsArrow.removeClass('rotate');\r\n} else {\r\n    reportsSubmenu.show();\r\n    reportsArrow.addClass('rotate');\r\n}\r\n\r\n// Determine which report options to show based on the customer title\r\nif (OnlyWater.includes(customerTitle)) {\r\n    waterReport.show();\r\n    energyReport.hide();\r\n} else if (OnlyEnergy.includes(customerTitle)) {\r\n    waterReport.hide();\r\n    energyReport.show();\r\n} else if (AllReports.includes(customerTitle)) {\r\n    waterReport.show();\r\n    energyReport.show();\r\n} else {\r\n    // Default behavior: Show all reports if the customer is not listed in any array\r\n    waterReport.show();\r\n    energyReport.show();\r\n}\r\n",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "d5c95e9f-c076-8c41-6b8a-edd6a750070a"
              }, {
                "name" : "WaterReport",
                "icon" : "water_drop",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "reports",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "f9505310-c43c-e0e0-4706-497157b80574"
              }, {
                "name" : "EnergyReport",
                "icon" : "bolt",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "Energy Reports",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : true,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "7c95a652-62a4-f26e-3631-5477d63c6c3b"
              }, {
                "name" : "Settings",
                "icon" : "settings",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "updateDashboardState",
                "targetDashboardStateId" : "settings",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openRightLayout" : false,
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "e2df470d-2e7b-2607-6316-9159a05bc1fd"
              } ]
            },
            "enableDataExport" : false,
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : "",
            "margin" : "0px"
          },
          "row" : 0,
          "col" : 0,
          "id" : "37e61454-97b3-a8cd-bf64-85788b76efb5"
        },
        "8d95af08-7386-b320-a65c-149c240e9bfd" : {
          "typeFullFqn" : "system.cards.html_card",
          "type" : "static",
          "sizeX" : 7.5,
          "sizeY" : 3,
          "config" : {
            "datasources" : [ {
              "type" : "static",
              "name" : "function",
              "dataKeys" : [ {
                "name" : "f(x)",
                "type" : "function",
                "label" : "Random",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.15479322438769105,
                "funcBody" : "var value = prevValue + Math.random() * 100 - 50;\nvar multiplier = Math.pow(10, 2 || 0);\nvar value = Math.round(value * multiplier) / multiplier;\nif (value < -1000) {\n\tvalue = -1000;\n} else if (value > 1000) {\n\tvalue = 1000;\n}\nreturn value;"
              } ]
            } ],
            "timewindow" : {
              "realtime" : {
                "timewindowMs" : 60000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "rgba(255, 255, 255, 0.97)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0",
            "settings" : {
              "cardHtml" : "CHATBOT\r\n<!-- Raíz opcional (no se usa para incrustar, la burbuja flota) -->\r\n<div id=\"n8n-chat-root\"></div>\r\n\r\n<script type=\"module\">\r\n  // --- CONFIG ---\r\n  const WEBHOOK_URL = 'https://backend.nexoragro.com/webhook/67044a01-2acb-4377-9a32-8c090b67939d/chat';\r\n  const CHAT_SESSION_KEY = 'sessionId'; // n8n espera \"sessionId\"\r\n\r\n  // --- Obtener userId de ThingsBoard ---\r\n  function getTbUserId() {\r\n    try {\r\n      const u = JSON.parse(localStorage.getItem('user') || 'null');\r\n      const idFromUser = u?.userId?.id || u?.user?.id?.id;\r\n      if (idFromUser) return idFromUser;\r\n\r\n      const tok =\r\n        localStorage.getItem('jwt_token') ||\r\n        localStorage.getItem('tb.auth_token') ||\r\n        localStorage.getItem('token');\r\n      if (tok) {\r\n        const base64 = (tok.split('.')[1] || '').replace(/-/g, '+').replace(/_/g, '/');\r\n        const payload = JSON.parse(atob(base64));\r\n        return payload.userId || payload.sub || null;\r\n      }\r\n    } catch (_) {}\r\n    return null;\r\n  }\r\n  \r\n  \r\nfunction injectStyle(css) {\r\n  const id = 'n8n-chat-custom-style';\r\n  if (document.getElementById(id)) return;\r\n  const s = document.createElement('style');\r\n  s.id = id;\r\n  s.textContent = css;\r\n  document.head.appendChild(s);\r\n}\r\n\r\n  const sessionId = getTbUserId() || 'anon';\r\n\r\n  // --- 1) Cargar CSS y esperar a que esté listo ---\r\n  function loadCss(href) {\r\n    return new Promise((resolve, reject) => {\r\n      const id = 'n8n-chat-style';\r\n      if (document.getElementById(id)) return resolve();\r\n      const link = document.createElement('link');\r\n      link.id = id;\r\n      link.rel = 'stylesheet';\r\n      link.href = href + '?v=' + Date.now(); // cache-busting\r\n      link.onload = resolve;\r\n      link.onerror = reject;\r\n      document.head.appendChild(link);\r\n    });\r\n  }\r\n\r\n  // --- 2) Importar el módulo y crear la burbuja ---\r\n  async function boot() {\r\n    // Asegurar estilos cargados (evita el \"texto pelado\")\r\n    await loadCss('https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css');\r\n\r\n\r\n// Estilos personalizados (después del CSS oficial)\r\n\r\ninjectStyle(`\r\n  :root {\r\n    /* Colores (tu tema) */\r\n    --chat--color-primary: #0a2342;\r\n    --chat--color-primary-shade-50: #092037;\r\n    --chat--color-primary-shade-100: #071a2d;\r\n    --chat--color-secondary: #0a2342;\r\n\r\n    /* Header compacto */\r\n    --chat--header-height: auto;\r\n    --chat--header--padding: 0.6rem;\r\n    --chat--heading--font-size: clamp(1rem, 0.9rem + 0.6vw, 1.15rem);\r\n    --chat--subtitle--font-size: clamp(0.85rem, 0.8rem + 0.2vw, 0.95rem);\r\n    --chat--subtitle--line-height: 1.3;\r\n\r\n    /* Tipografía de mensajes (clamp) */\r\n    --chat--message--font-size:  10px !important;\r\n    --chat--message-line-height: 1;\r\n\r\n    /* Ventana y toggle (responsive) */\r\n    --chat--window--width: min(80vw, 600px);\r\n    --chat--window--height: min(80vh, 620px);\r\n    --chat--toggle--size: clamp(56px, 12vw, 72px);\r\n\r\n    /* Input más bajo */\r\n    --chat--textarea--height: 44px;\r\n\r\n    /* Bordes suaves */\r\n    .n8n-chat, .n8n-chat * { font-size:1rem !important; line-height:1.35 !important; }\r\n    --chat--border-radius: 14px;\r\n\r\n    /* Header y burbuja usuario en azul marino */\r\n    --chat--header--background: var(--chat--color-primary);\r\n    --chat--header--color: #fff;\r\n    --chat--message--user--background: var(--chat--color-primary);\r\n    --chat--message--user--color: #fff;\r\n  }\r\n`);\r\n\r\n\r\n    // Import ESM oficial\r\n    const { createChat } = await import('https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js');\r\n\r\n    // ¡No pasamos un contenedor de embedding! (así no ocupa fullscreen)\r\n    createChat({\r\n      webhookUrl: WEBHOOK_URL,\r\n      chatSessionKey: CHAT_SESSION_KEY,\r\n      loadPreviousSession: true,\r\n      metadata: { sessionId },\r\n\r\n      // UX mínima de burbuja\r\n      position: 'bottom-right',\r\n      launcherTitle: 'Asistente',\r\n      initialMessages: ['Hola 👋 ¿en qué te ayudo?'],\r\n      i18n: {\r\n\t\ten: {\r\n\t\t\ttitle: 'Asistente',\r\n\t\t\tsubtitle: \"\",\r\n\t\t\tfooter: '',\r\n\t\t\tgetStarted: '',\r\n\t\t\tinputPlaceholder: 'Escribí tu consulta...',\r\n\t\t},\r\n      },\r\n      \r\n\r\n      // Si tu versión soporta theme, descomenta:\r\n       theme: { primary: '#111827' }\r\n    });\r\n  }\r\n\r\n  boot().catch(err => {\r\n    console.error('n8n chat error:', err);\r\n    // Fallback visual mínimo por si CSP bloquea el CSS\r\n    const warn = document.createElement('div');\r\n    warn.style.cssText = 'position:fixed;bottom:12px;right:12px;padding:8px 12px;background:#111;color:#fff;border-radius:8px;font:14px/1.2 system-ui;';\r\n    warn.textContent = 'No se pudo cargar el CSS de @n8n/chat (revisar CSP).';\r\n    document.body.appendChild(warn);\r\n  });\r\n</script>\r\n\r\n",
              "cardCss" : ""
            },
            "title" : "HTML Card",
            "dropShadow" : false,
            "enableFullscreen" : false,
            "widgetStyle" : { },
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : ""
          },
          "row" : 0,
          "col" : 0,
          "id" : "8d95af08-7386-b320-a65c-149c240e9bfd"
        }
      },
      "states" : {
        "default" : {
          "name" : "Administrador de Notificaciones",
          "root" : true,
          "layouts" : {
            "main" : {
              "widgets" : {
                "e3fea6ac-e577-b3b9-7352-996ccd634cf5" : {
                  "sizeX" : 5,
                  "sizeY" : 3,
                  "row" : 0,
                  "col" : 0
                },
                "eacd4f17-e502-99ac-f9fc-930c1f29eeca" : {
                  "sizeX" : 3,
                  "sizeY" : 2,
                  "row" : 0,
                  "col" : 5
                },
                "149e7b15-dffb-2cc4-6196-1a60ac42e51f" : {
                  "sizeX" : 3,
                  "sizeY" : 3,
                  "row" : 0,
                  "col" : 8
                },
                "b251de93-f0c3-93cf-d2d0-345fd99be8b8" : {
                  "sizeX" : 8,
                  "sizeY" : 8,
                  "mobileHeight" : null,
                  "row" : 0,
                  "col" : 15
                },
                "b9f932d5-a9cc-d56d-7e05-04539206d364" : {
                  "sizeX" : 11,
                  "sizeY" : 10,
                  "row" : 3,
                  "col" : 0
                },
                "c97cf698-6801-a9a3-c140-f41f767a01eb" : {
                  "sizeX" : 3,
                  "sizeY" : 4,
                  "row" : 4,
                  "col" : 11
                },
                "42786926-b8ab-6eae-2685-003a1ab94240" : {
                  "sizeX" : 7,
                  "sizeY" : 3,
                  "row" : 13,
                  "col" : 0
                },
                "0715df6d-0b1b-e8a0-3213-6153944ae4a0" : {
                  "sizeX" : 11,
                  "sizeY" : 4,
                  "resizable" : true,
                  "row" : 8,
                  "col" : 11
                },
                "37e61454-97b3-a8cd-bf64-85788b76efb5" : {
                  "sizeX" : 4,
                  "sizeY" : 4,
                  "row" : 0,
                  "col" : 11
                },
                "8d95af08-7386-b320-a65c-149c240e9bfd" : {
                  "sizeX" : 2,
                  "sizeY" : 1,
                  "resizable" : true,
                  "row" : 2,
                  "col" : 5
                }
              },
              "gridSettings" : {
                "layoutType" : "default",
                "backgroundColor" : "#eeeeee",
                "columns" : 24,
                "margin" : 10,
                "outerMargin" : true,
                "backgroundSizeMode" : "100%"
              },
              "breakpoints" : {
                "xs" : {
                  "gridSettings" : {
                    "layoutType" : "default",
                    "backgroundColor" : "#eeeeee",
                    "columns" : 24,
                    "margin" : 10,
                    "outerMargin" : true,
                    "backgroundSizeMode" : "100%",
                    "viewFormat" : "list"
                  },
                  "widgets" : {
                    "e3fea6ac-e577-b3b9-7352-996ccd634cf5" : {
                      "sizeX" : 5,
                      "sizeY" : 4,
                      "row" : 0,
                      "col" : 0
                    },
                    "eacd4f17-e502-99ac-f9fc-930c1f29eeca" : {
                      "sizeX" : 6,
                      "sizeY" : 5,
                      "row" : 0,
                      "col" : 5
                    },
                    "81cd62eb-2713-c805-9597-000101379690" : {
                      "sizeX" : 4,
                      "sizeY" : 4,
                      "row" : 0,
                      "col" : 11
                    },
                    "b2b1869a-779c-c2d6-83e0-13409f64395c" : {
                      "sizeX" : 7,
                      "sizeY" : 3,
                      "row" : 5,
                      "col" : 0
                    },
                    "149e7b15-dffb-2cc4-6196-1a60ac42e51f" : {
                      "sizeX" : 6,
                      "sizeY" : 3,
                      "row" : 5,
                      "col" : 8
                    },
                    "b251de93-f0c3-93cf-d2d0-345fd99be8b8" : {
                      "sizeX" : 8,
                      "sizeY" : 8,
                      "mobileHeight" : null,
                      "row" : 0,
                      "col" : 15,
                      "resizable" : true,
                      "mobileOrder" : 1
                    }
                  }
                }
              }
            }
          }
        },
        "test" : {
          "name" : "test",
          "root" : false,
          "layouts" : {
            "main" : {
              "widgets" : { },
              "gridSettings" : {
                "layoutType" : "default",
                "backgroundColor" : "#eeeeee",
                "columns" : 24,
                "margin" : 10,
                "outerMargin" : true,
                "backgroundSizeMode" : "100%"
              }
            }
          }
        },
        "devices" : {
          "name" : "devices",
          "root" : false,
          "layouts" : {
            "main" : {
              "widgets" : { },
              "gridSettings" : {
                "layoutType" : "default",
                "backgroundColor" : "#eeeeee",
                "columns" : 24,
                "margin" : 10,
                "outerMargin" : true,
                "backgroundSizeMode" : "100%"
              }
            }
          }
        }
      },
      "entityAliases" : {
        "65a9e3f5-693c-b0fa-72a6-37c2b49e610d" : {
          "id" : "65a9e3f5-693c-b0fa-72a6-37c2b49e610d",
          "alias" : "customerDevices",
          "filter" : {
            "type" : "entityType",
            "resolveMultiple" : true,
            "entityType" : "DEVICE"
          }
        },
        "b2917daf-99e3-6211-135d-47e39b87d5cc" : {
          "id" : "b2917daf-99e3-6211-135d-47e39b87d5cc",
          "alias" : "customerUsers",
          "filter" : {
            "type" : "entityType",
            "resolveMultiple" : true,
            "entityType" : "USER"
          }
        },
        "3112c4b4-7cf9-0f29-c31c-834ff76f90f7" : {
          "id" : "3112c4b4-7cf9-0f29-c31c-834ff76f90f7",
          "alias" : "devActual",
          "filter" : {
            "type" : "stateEntity",
            "resolveMultiple" : false,
            "stateEntityParamName" : null,
            "defaultStateEntity" : null
          }
        },
        "2209fa3c-bd68-8dad-c129-aa2cd2a75d20" : {
          "id" : "2209fa3c-bd68-8dad-c129-aa2cd2a75d20",
          "alias" : "Current Customer",
          "filter" : {
            "type" : "singleEntity",
            "resolveMultiple" : true,
            "singleEntity" : {
              "entityType" : "CURRENT_CUSTOMER",
              "id" : "720267d0-9eba-11ee-a2ed-6fdb8aa7c38e"
            }
          }
        },
        "d61165fd-70e9-f3b7-c538-c902295ef146" : {
          "id" : "d61165fd-70e9-f3b7-c538-c902295ef146",
          "alias" : "Current User",
          "filter" : {
            "type" : "singleEntity",
            "resolveMultiple" : true,
            "singleEntity" : {
              "entityType" : "CURRENT_USER",
              "id" : "13814000-1dd2-11b2-8080-808080808080"
            }
          }
        },
        "92578e81-0ee0-ba23-ab10-e60de4ed430c" : {
          "id" : "92578e81-0ee0-ba23-ab10-e60de4ed430c",
          "alias" : "PRESSURE SENSORS",
          "filter" : {
            "type" : "deviceSearchQuery",
            "resolveMultiple" : true,
            "rootStateEntity" : false,
            "stateEntityParamName" : null,
            "defaultStateEntity" : null,
            "rootEntity" : {
              "entityType" : "CURRENT_CUSTOMER",
              "id" : "720267d0-9eba-11ee-a2ed-6fdb8aa7c38e"
            },
            "direction" : "FROM",
            "maxLevel" : 10,
            "fetchLastLevelOnly" : false,
            "relationType" : "deviceToMachine",
            "deviceTypes" : [ "Pressure Sensor" ]
          }
        },
        "db7ff95c-2c8c-be42-7d04-db503c8c356d" : {
          "id" : "db7ff95c-2c8c-be42-7d04-db503c8c356d",
          "alias" : "Customers",
          "filter" : {
            "type" : "singleEntity",
            "resolveMultiple" : false,
            "singleEntity" : {
              "entityType" : "CURRENT_CUSTOMER",
              "id" : "7810e4c0-45cd-11ef-bcb7-976e94e2a809"
            }
          }
        }
      },
      "filters" : {
        "3315a7b2-cdcd-aafa-2e3b-1756ce0c92b1" : {
          "id" : "3315a7b2-cdcd-aafa-2e3b-1756ce0c92b1",
          "filter" : "Filter By Current User",
          "keyFilters" : [ {
            "key" : {
              "type" : "ATTRIBUTE",
              "key" : "access_users"
            },
            "valueType" : "STRING",
            "predicates" : [ {
              "keyFilterPredicate" : {
                "operation" : "CONTAINS",
                "value" : {
                  "defaultValue" : "",
                  "dynamicValue" : {
                    "sourceType" : "CURRENT_USER",
                    "sourceAttribute" : "email",
                    "inherit" : false
                  }
                },
                "ignoreCase" : false,
                "type" : "STRING"
              },
              "userInfo" : {
                "editable" : true,
                "label" : "",
                "autogeneratedLabel" : true,
                "order" : 0
              }
            } ]
          } ],
          "editable" : true
        }
      },
      "timewindow" : {
        "hideAggregation" : false,
        "hideAggInterval" : false,
        "hideTimezone" : false,
        "selectedTab" : 0,
        "realtime" : {
          "realtimeType" : 0,
          "interval" : 5000,
          "timewindowMs" : 900000,
          "quickInterval" : "CURRENT_DAY",
          "hideInterval" : false,
          "hideLastInterval" : false,
          "hideQuickInterval" : false
        },
        "history" : {
          "historyType" : 0,
          "interval" : 1000,
          "timewindowMs" : 60000,
          "fixedTimewindow" : null,
          "quickInterval" : "CURRENT_DAY",
          "hideInterval" : false,
          "hideLastInterval" : false,
          "hideFixedInterval" : false,
          "hideQuickInterval" : false
        },
        "aggregation" : {
          "type" : "AVG",
          "limit" : 25000
        },
        "timezone" : null
      },
      "settings" : {
        "stateControllerId" : "entity",
        "showTitle" : false,
        "showDashboardsSelect" : true,
        "showEntitiesSelect" : true,
        "showDashboardTimewindow" : true,
        "showDashboardExport" : true,
        "toolbarAlwaysOpen" : true
      }
    },
    "name" : "Widget Test",
    "resources" : null,
    "assignedCustomers" : [ ],
    "externalId" : null,
    "id" : {
      "entityType" : "DASHBOARD",
      "id" : "705fb1d0-85e5-11f0-bbbd-d5b23296cf03"
    }
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}