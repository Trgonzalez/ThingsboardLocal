{
  "entityType" : "DEVICE",
  "entity" : {
    "additionalInfo" : {
      "lastConnectedGateway" : "f451d870-0762-11f1-aaec-896783e71c4d"
    },
    "customerId" : {
      "entityType" : "CUSTOMER",
      "id" : "13814000-1dd2-11b2-8080-808080808080"
    },
    "deviceData" : {
      "configuration" : {
        "type" : "DEFAULT"
      },
      "transportConfiguration" : {
        "type" : "DEFAULT"
      }
    },
    "deviceProfileId" : {
      "entityType" : "DEVICE_PROFILE",
      "id" : "d4120680-3a93-11f0-96f4-672ec1447afa"
    },
    "externalId" : null,
    "firmwareId" : null,
    "id" : {
      "entityType" : "DEVICE",
      "id" : "3cebd7e0-0ba3-11f1-8fce-55f815a3848a"
    },
    "label" : null,
    "name" : "tasmota_EDE178",
    "softwareId" : null,
    "type" : "default"
  },
  "credentials" : {
    "credentialsId" : "oDcJZFxFO9DFwq39QbKG",
    "credentialsType" : "ACCESS_TOKEN",
    "credentialsValue" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "DEVICE",
      "id" : "f451d870-0762-11f1-aaec-896783e71c4d"
    },
    "to" : {
      "entityType" : "DEVICE",
      "id" : "3cebd7e0-0ba3-11f1-8fce-55f815a3848a"
    },
    "type" : "Created",
    "typeGroup" : "COMMON",
    "version" : 24545
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ {
      "booleanValue" : true,
      "doubleValue" : null,
      "jsonValue" : null,
      "key" : "active",
      "lastUpdateTs" : 1771498539656,
      "longValue" : null,
      "strValue" : null
    }, {
      "booleanValue" : null,
      "doubleValue" : 3.6,
      "jsonValue" : null,
      "key" : "battery_nominal",
      "lastUpdateTs" : 1771293115757,
      "longValue" : null,
      "strValue" : null
    }, {
      "booleanValue" : null,
      "doubleValue" : null,
      "jsonValue" : null,
      "key" : "inactivityAlarmTime",
      "lastUpdateTs" : 1771455181732,
      "longValue" : 1771455181732,
      "strValue" : null
    }, {
      "booleanValue" : null,
      "doubleValue" : null,
      "jsonValue" : null,
      "key" : "lastActivityTime",
      "lastUpdateTs" : 1771519854090,
      "longValue" : 1771519851750,
      "strValue" : null
    }, {
      "booleanValue" : null,
      "doubleValue" : null,
      "jsonValue" : null,
      "key" : "lastConnectTime",
      "lastUpdateTs" : 1771498539655,
      "longValue" : 1771498539655,
      "strValue" : null
    }, {
      "booleanValue" : null,
      "doubleValue" : null,
      "jsonValue" : null,
      "key" : "lastDisconnectTime",
      "lastUpdateTs" : 1771454529080,
      "longValue" : 1771454529080,
      "strValue" : null
    } ],
    "SHARED_SCOPE" : [ ]
  },
  "calculatedFields" : [ {
    "configuration" : {
      "type" : "SCRIPT",
      "arguments" : {
        "energy_total_kwh" : {
          "limit" : 2,
          "refEntityKey" : {
            "key" : "energy_total_kwh",
            "type" : "TS_ROLLING"
          },
          "timeWindow" : 86400000
        }
      },
      "expression" : "var delta = 0.0;\r\nvar lastTs = null;\r\n\r\nif (energy_total_kwh.values.size() >= 2) {\r\n    var firstPoint = energy_total_kwh.values.get(0);\r\n    var lastPoint  = energy_total_kwh.values.get(energy_total_kwh.values.size() - 1);\r\n\r\n    var first = firstPoint.value;\r\n    var last  = lastPoint.value;\r\n\r\n    lastTs = lastPoint.ts;\r\n\r\n    // Anti-reset: si el contador baja, ignoramos el intervalo\r\n    if (last >= first) {\r\n        delta = last - first;\r\n    } else {\r\n        delta = 0.0;\r\n    }\r\n}\r\n\r\n// 5 decimales\r\ndelta = Math.round(delta * 100000.0) / 100000.0;\r\n\r\n// Time Series Output con timestamp expl√≠cito\r\nreturn {\r\n    ts: lastTs,\r\n    values: {\r\n        deltaEnergy_kWh: delta\r\n    }\r\n};",
      "output" : {
        "name" : "",
        "type" : "TIME_SERIES"
      }
    },
    "configurationVersion" : 0,
    "debugSettings" : {
      "allEnabled" : false,
      "allEnabledUntil" : 1771418925458,
      "failuresEnabled" : true
    },
    "name" : "Telemetry delta calculation",
    "tenantId" : {
      "entityType" : "TENANT",
      "id" : "d3e3a380-3a93-11f0-96f4-672ec1447afa"
    },
    "type" : "SCRIPT"
  } ]
}